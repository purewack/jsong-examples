<!DOCTYPE html><html><head><title>JSONg Compact-Streamer</title><meta charset="utf-8"></head><body> <div style="width:100%"> <h1 class="heading">JSONg Compact-Streamer</h1> <div class="content"> <section class="text"> <p>JSONg audio can be used to save space while also streaming high quality audio.</p> <p>This is achieved by preparing a single stereo track and removing any repeating blocks which could be represented as loops within the .jsong file.</p> <p>As an example, we have a song playing that is ~600KB big and another ~700KB for the .jsong</p> <p>If the song was originally 4 minutes long, that could be +9MB for .mp3 and +40MB for .wav !</p> <p>With a simple .jsong structure, this is reduced tenfold</p> <p>There are limitations, the main one being that the music must be designed to be looped, and preferably contain no lyrics / vocals, however for simple demonstrations and space savings JSONg is very much suitable.</p> </section> <section class="controls-container"> <button id="btn-play" class="controls">Play</button> <button id="btn-stop" class="controls">Stop</button> </section> </div> <section class="playback"> <div class="prog"><h2 class="prog-title">Intro</h2> <span id="prog-intro" class="prog-bar"></span></div> <div class="prog"><h2 class="prog-title">Verse 1</h2><span id="prog-verse1" class="prog-bar"></span></div> <div class="prog"><h2 class="prog-title">Verse 2</h2><span id="prog-verse2" class="prog-bar"></span></div> <div class="prog"><h2 class="prog-title">Bridge</h2> <span id="prog-bridge" class="prog-bar"></span></div> <div class="prog"><h2 class="prog-title">Chorus</h2> <span id="prog-chorus" class="prog-bar"></span></div> </section> </div> </body><script>!function(){var i,s,r,o,a,l,h,u,c,d;let p,m,f,_,g,v,y,b,T,w,x,C,S,A,k,O,M,E,I,D,R,P,N,V,q,L,F,j,B,W,U,z,G,X,Y,Z,$,H,J,Q,K,tt,te,tn,ti,ts,tr,to,ta,tl,th,tu,tc,td,tp,tm,tf,t_,tg,tv,ty,tb,tT,tw,tx,tC,tS,tA,tk,tO,tM,tE,tI,tD,tR,tP,tN,tV,tq,tL,tF,tj,tB,tW,tU,tz,tG,tX,tY,tZ,t$,tH,tJ,tQ,tK,t0,t1,t2,t3;function t8(i,s,r,o){var a,l=arguments.length,h=l<3?s:null===o?o=Object.getOwnPropertyDescriptor(s,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(i,s,r,o);else for(var u=i.length-1;u>=0;u--)(a=i[u])&&(h=(l<3?a(h):l>3?a(s,r,h):a(s,r))||h);return l>3&&h&&Object.defineProperty(s,r,h),h}function t4(i,s,r,o){return new(r||(r=Promise))(function(a,l){function h(i){try{c(o.next(i))}catch(i){l(i)}}function u(i){try{c(o.throw(i))}catch(i){l(i)}}function c(i){var s;i.done?a(i.value):((s=i.value)instanceof r?s:new r(function(i){i(s)})).then(h,u)}c((o=o.apply(i,s||[])).next())})}function t6(i,s=4,r=[4,4],o){let a=i=>i.split(":").map(i=>parseInt(i)),l=(i,s)=>Math.trunc((i+s)/s)*s,h=r[0]/(r[1]/4),[u,c]=a(i);if((s/=r[1]/4)<h){let i=l(c,s);return`${u+Math.trunc(i/h)}:${i%h}:0`}{let i=s/h;if(null!=o){if("string"==typeof o){let s=a(o)[0];for(;s<=u;)s+=i;return`${s}:0:0`}return`${l(u,i)+o}:0:0`}return`${u+i}:0:0`}}function t5(i,s,r){let o=r[1]/4,a=r[0]/o,[l,h,u]=i.split(":").map(Number),[c,d,p]=s.split(":").map(Number);return Math.round((c*a+d+p/(16/o)-(l*a+h+u/(16/o)))*o)}function t7(i,s){return function i(r,o,a){let l=s[o];return a[o]=l,a+""==s+""?r[l]:r[l]?i(r[l],o+1,a):void 0}(i,0,[...Array(s.length)])}function t9(i,s){if(void 0===t7(i,s))return;let r=[],o=[],a=s=>{let r=t7(i,s);return(null==r?void 0:r.name)?s:a([...s,0])},l=(s,h=0)=>{let u=[...s.slice(0,-1)],c=et(i,0===h&&s.length>1?s:u),d=s.at(-1)+1>=c.sectionCount,p=c.loopCurrent+1>=c.loopLimit;if(d&&r.push(u),!d||!p)return d?void(o=a([...u,0])):void(o=a([...u,s.at(-1)+1]));l(u,h+1)};return l(s),{next:o,increments:r}}function et(i,s){let r=t7(i,s);return s.length&&r?(null==r?void 0:r.name)?Object.assign({},t7(i,s.slice(0,-1))):Object.assign({},r):Object.assign({},i)}function ee(i){let s=i.split("-"),r=s.length>1,o=r?s.includes("X")||s.includes("x"):void 0;return{name:s[0],fade:o,once:r?s.includes(">"):void 0,legato:r?s.includes("|")&&!o:void 0,sync:r?s.includes("@"):void 0}}function en(i){try{return new URL(i)}catch(s){return new URL(window.location.origin+(i?"/"+i:""))}}function ei(i){return"jsong"===(null==i?void 0:i.type)}"function"==typeof SuppressedError&&SuppressedError;class es extends Event{constructor(i){super("click"),this.current=i}}class er extends Event{constructor(i,s,r){super("transport"),this.progress=i,this.countdown=r,this.beat=s}}class eo extends Event{constructor(i,s,r,o,a){super("queue"),this.to=i,this.from=s,this.breakout=r,this.countdown=o,this.timeUntil=a}}class ea extends Event{constructor(i,s){super("cancel"),this.to=i,this.from=s}}class el extends Event{constructor(i,s,r,o){super("change"),this.from=s,this.to=i,this.breakout=r,this.automatic=o}}class eh extends Event{constructor(i,s){super("repeat"),this.group=s,this.counter=i}}class eu extends Event{constructor(i){super("loop"),this.group=i}}class ec extends Event{constructor(i){super("state"),this.stateOld=i.prev,this.stateNow=i.now}}class ed extends Event{constructor(i){super("parse"),this.phasePrev=i.prev,this.phase=i.now}}let ep="14.9.17",em=(i,s)=>({startTime:s,type:"setValue",value:i}),ef=(i,s,r)=>({duration:r,startTime:s,type:"setValueCurve",values:i}),e_=new WeakSet,eg=new WeakMap,ev=new WeakMap,ey=new WeakMap,eb=new WeakMap,eT=new WeakMap,ew=new WeakMap,ex=new WeakMap,eC=new WeakMap,eS=new WeakMap,eA={construct:()=>eA},ek=i=>{try{new new Proxy(i,eA)}catch{return!1}return!0},eO=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,eM=(i,s)=>{let r=[],o=i.replace(/^[\s]+/,""),a=o.match(eO);for(;null!==a;){let i=a[1].slice(1,-1),l=a[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,s).toString());r.push(l),a=(o=o.slice(a[0].length).replace(/^[\s]+/,"")).match(eO)}return[r.join(";"),o]},eE=i=>{if(void 0!==i&&!Array.isArray(i))throw TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},eI=i=>{if(!ek(i))throw TypeError("The given value for processorCtor should be a constructor.");if(null===i.prototype||"object"!=typeof i.prototype)throw TypeError("The given value for processorCtor should have a prototype.")},eD=(i,s)=>{let r=i.get(s);if(void 0===r)throw Error("A value with the given key could not be found.");return r},eR=(i,s)=>{let r=Array.from(i).filter(s);if(r.length>1)throw Error("More than one element was found.");if(0===r.length)throw Error("No element was found.");let[o]=r;return i.delete(o),o},eP=(i,s,r,o)=>{let a=eD(i,s),l=eR(a,i=>i[0]===r&&i[1]===o);return 0===a.size&&i.delete(s),l},eN=i=>eD(ew,i),eV=i=>{if(e_.has(i))throw Error("The AudioNode is already stored.");e_.add(i),eN(i).forEach(i=>i(!0))},eq=i=>"port"in i,eL=i=>{if(!e_.has(i))throw Error("The AudioNode is not stored.");e_.delete(i),eN(i).forEach(i=>i(!1))},eF=(i,s)=>{!eq(i)&&s.every(i=>0===i.size)&&eL(i)},ej={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},eB=(i,s)=>i.context===s,eW=i=>{try{i.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},eU=()=>new DOMException("","IndexSizeError"),ez=i=>{var s;i.getChannelData=(s=i.getChannelData,r=>{try{return s.call(i,r)}catch(i){if(12===i.code)throw eU();throw i}})},eG={numberOfChannels:1},eX=i=>e_.has(i),eY={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},eZ=i=>"playbackRate"in i,e$=i=>"frequency"in i&&"gain"in i,eH=i=>"offset"in i,eJ=i=>!("frequency"in i)&&"gain"in i,eQ=i=>"detune"in i&&"frequency"in i&&!("gain"in i),eK=i=>"pan"in i,e0=i=>eD(eg,i),e1=i=>eD(ey,i),e2=(i,s)=>{let{activeInputs:r}=e0(i);for(let o of(r.forEach(r=>r.forEach(([r])=>{s.includes(i)||e2(r,[...s,i])})),eZ(i)?[i.playbackRate]:eq(i)?Array.from(i.parameters.values()):e$(i)?[i.Q,i.detune,i.frequency,i.gain]:eH(i)?[i.offset]:eJ(i)?[i.gain]:eQ(i)?[i.detune,i.frequency]:eK(i)?[i.pan]:[])){let i=e1(o);void 0!==i&&i.activeInputs.forEach(([i])=>e2(i,s))}eX(i)&&eL(i)},e3=i=>{e2(i.destination,[])},e8=i=>void 0===i||"number"==typeof i||"string"==typeof i&&("balanced"===i||"interactive"===i||"playback"===i),e4=i=>"context"in i,e6=i=>e4(i[0]),e5=(i,s,r,o)=>{for(let s of i)if(r(s)){if(o)return!1;throw Error("The set contains at least one similar element.")}return i.add(s),!0},e7=(i,s,[r,o],a)=>{e5(i,[s,r,o],i=>i[0]===s&&i[1]===r,a)},e9=(i,[s,r,o],a)=>{let l=i.get(s);void 0===l?i.set(s,new Set([[r,o]])):e5(l,[r,o],i=>i[0]===r,a)},nt=i=>"inputs"in i,ne=(i,s,r,o)=>{if(nt(s)){let a=s.inputs[o];return i.connect(a,r,0),[a,r,0]}return i.connect(s,r,o),[s,r,o]},nn=(i,s,r)=>{for(let o of i)if(o[0]===s&&o[1]===r)return i.delete(o),o;return null},ni=(i,s,r)=>eR(i,i=>i[0]===s&&i[1]===r),ns=(i,s)=>{if(!eN(i).delete(s))throw Error("Missing the expected event listener.")},nr=(i,s,r)=>{let o=eD(i,s),a=eR(o,i=>i[0]===r);return 0===o.size&&i.delete(s),a},no=(i,s,r,o)=>{nt(s)?i.disconnect(s.inputs[o],r,0):i.disconnect(s,r,o)},na=i=>eD(ev,i),nl=i=>eD(eb,i),nh=i=>ex.has(i),nu=i=>!e_.has(i),nc=(i,s)=>new Promise(r=>{if(null!==s)r(!0);else{let s=i.createScriptProcessor(256,1,1),o=i.createGain(),a=i.createBuffer(1,2,44100),l=a.getChannelData(0);l[0]=1,l[1]=1;let h=i.createBufferSource();h.buffer=a,h.loop=!0,h.connect(s).connect(i.destination),h.connect(o),h.disconnect(o),s.onaudioprocess=o=>{let a=o.inputBuffer.getChannelData(0);Array.prototype.some.call(a,i=>1===i)?r(!0):r(!1),h.stop(),s.onaudioprocess=null,h.disconnect(s),s.disconnect(i.destination)},h.start()}}),nd=(i,s)=>{let r=new Map;for(let s of i)for(let i of s){let s=r.get(i);r.set(i,void 0===s?1:s+1)}r.forEach((i,r)=>s(r,i))},np=i=>"context"in i,nm=i=>{var s,r;let o=new Map;i.connect=(s=i.connect.bind(i),(i,r=0,a=0)=>{let l=np(i)?s(i,r,a):s(i,r),h=o.get(i);return void 0===h?o.set(i,[{input:a,output:r}]):h.every(i=>i.input!==a||i.output!==r)&&h.push({input:a,output:r}),l}),i.disconnect=(r=i.disconnect,(s,a,l)=>{if(r.apply(i),void 0===s)o.clear();else if("number"==typeof s)for(let[i,r]of o){let a=r.filter(i=>i.output!==s);0===a.length?o.delete(i):o.set(i,a)}else if(o.has(s)){if(void 0===a)o.delete(s);else{let i=o.get(s);if(void 0!==i){let r=i.filter(i=>i.output!==a&&(i.input!==l||void 0===l));0===r.length?o.delete(s):o.set(s,r)}}}for(let[s,r]of o)r.forEach(r=>{np(s)?i.connect(s,r.output,r.input):i.connect(s,r.output)})})},nf=(i,s,r,o,a)=>{let[l,h]=((i,s,r,o)=>{let{activeInputs:a,passiveInputs:l}=e0(s),h=nn(a[o],i,r);return null===h?[eP(l,i,r,o)[2],!1]:[h[2],!0]})(i,r,o,a);if(null!==l&&(ns(i,l),!h||s||nh(i)||no(na(i),na(r),o,a)),eX(r)){let{activeInputs:i}=e0(r);eF(r,i)}},n_=(i,s,r,o)=>{let[a,l]=((i,s,r)=>{let{activeInputs:o,passiveInputs:a}=e1(s),l=nn(o,i,r);return null===l?[nr(a,i,r)[1],!1]:[l[2],!0]})(i,r,o);null!==a&&(ns(i,a),!l||s||nh(i)||na(i).disconnect(nl(r),o))},ng=(i,s,r)=>({endTime:s,insertTime:r,type:"exponentialRampToValue",value:i}),nv=(i,s,r)=>({endTime:s,insertTime:r,type:"linearRampToValue",value:i}),ny=(i,s,{startTime:r,target:o,timeConstant:a})=>o+(s-o)*Math.exp((r-i)/a),nb=i=>"exponentialRampToValue"===i.type,nT=i=>"linearRampToValue"===i.type,nw=i=>nb(i)||nT(i),nx=i=>"setValue"===i.type,nC=i=>"setValueCurve"===i.type,nS=(i,s,r,o)=>{let a=i[s];return void 0===a?o:nw(a)||nx(a)?a.value:nC(a)?a.values[a.values.length-1]:ny(r,nS(i,s-1,a.startTime,o),a)},nA=(i,s,r,o,a)=>void 0===r?[o.insertTime,a]:nw(r)?[r.endTime,r.value]:nx(r)?[r.startTime,r.value]:nC(r)?[r.startTime+r.duration,r.values[r.values.length-1]]:[r.startTime,nS(i,s-1,r.startTime,a)],nk=i=>"cancelAndHold"===i.type,nO=i=>"cancelScheduledValues"===i.type,nM=i=>nk(i)||nO(i)?i.cancelTime:nb(i)||nT(i)?i.endTime:i.startTime,nE=(i,s,r,{endTime:o,value:a})=>r===a?a:0<r&&0<a||r<0&&a<0?r*(a/r)**((i-s)/(o-s)):0,nI=(i,s,r,{endTime:o,value:a})=>r+(i-s)/(o-s)*(a-r),nD=(i,s)=>{let r=Math.floor(s),o=Math.ceil(s);return r===o?i[r]:(1-(s-r))*i[r]+(1-(o-s))*i[o]},nR=(i,{duration:s,startTime:r,values:o})=>{let a=(i-r)/s*(o.length-1);return nD(o,a)},nP=i=>"setTarget"===i.type;class nN{constructor(i){this._automationEvents=[],this._currenTime=0,this._defaultValue=i}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(i){let s=nM(i);if(nk(i)||nO(i)){let r=this._automationEvents.findIndex(r=>nO(i)&&nC(r)?r.startTime+r.duration>=s:nM(r)>=s),o=this._automationEvents[r];if(-1!==r&&(this._automationEvents=this._automationEvents.slice(0,r)),nk(i)){let i=this._automationEvents[this._automationEvents.length-1];if(void 0!==o&&nw(o)){if(void 0!==i&&nP(i))throw Error("The internal list is malformed.");let r=void 0===i?o.insertTime:nC(i)?i.startTime+i.duration:nM(i),a=void 0===i?this._defaultValue:nC(i)?i.values[i.values.length-1]:i.value,l=nb(o)?nE(s,r,a,o):nI(s,r,a,o),h=nb(o)?ng(l,s,this._currenTime):nv(l,s,this._currenTime);this._automationEvents.push(h)}if(void 0!==i&&nP(i)&&this._automationEvents.push(em(this.getValue(s),s)),void 0!==i&&nC(i)&&i.startTime+i.duration>s){let r=s-i.startTime,o=(i.values.length-1)/i.duration,a=Math.max(2,1+Math.ceil(r*o)),l=r/(a-1)*o,h=i.values.slice(0,a);if(l<1)for(let s=1;s<a;s+=1){let r=l*s%1;h[s]=i.values[s-1]*(1-r)+i.values[s]*r}this._automationEvents[this._automationEvents.length-1]=ef(h,i.startTime,r)}}}else{let r=this._automationEvents.findIndex(i=>nM(i)>s),o=-1===r?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(void 0!==o&&nC(o)&&nM(o)+o.duration>s)return!1;let a=nb(i)?ng(i.value,i.endTime,this._currenTime):nT(i)?nv(i.value,s,this._currenTime):i;if(-1===r)this._automationEvents.push(a);else{if(nC(i)&&s+i.duration>nM(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,a)}}return!0}flush(i){let s=this._automationEvents.findIndex(s=>nM(s)>i);if(s>1){let i=this._automationEvents.slice(s-1),r=i[0];nP(r)&&i.unshift(em(nS(this._automationEvents,s-2,r.startTime,this._defaultValue),r.startTime)),this._automationEvents=i}}getValue(i){if(0===this._automationEvents.length)return this._defaultValue;let s=this._automationEvents.findIndex(s=>nM(s)>i),r=this._automationEvents[s],o=(-1===s?this._automationEvents.length:s)-1,a=this._automationEvents[o];if(void 0!==a&&nP(a)&&(void 0===r||!nw(r)||r.insertTime>i))return ny(i,nS(this._automationEvents,o-1,a.startTime,this._defaultValue),a);if(void 0!==a&&nx(a)&&(void 0===r||!nw(r)))return a.value;if(void 0!==a&&nC(a)&&(void 0===r||!nw(r)||a.startTime+a.duration>i))return i<a.startTime+a.duration?nR(i,a):a.values[a.values.length-1];if(void 0!==a&&nw(a)&&(void 0===r||!nw(r)))return a.value;if(void 0!==r&&nb(r)){let[s,l]=nA(this._automationEvents,o,a,r,this._defaultValue);return nE(i,s,l,r)}if(void 0!==r&&nT(r)){let[s,l]=nA(this._automationEvents,o,a,r,this._defaultValue);return nI(i,s,l,r)}return this._defaultValue}}class nV{constructor(i){this._map=new Map(i)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(i,s=null){return this._map.forEach((r,o)=>i.call(s,r,o,this))}get(i){return this._map.get(i)}has(i){return this._map.has(i)}keys(){return this._map.keys()}values(){return this._map.values()}}let nq={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function nL(i,s,r,o,a){if("function"==typeof i.copyFromChannel)0===s[r].byteLength&&(s[r]=new Float32Array(128)),i.copyFromChannel(s[r],o,a);else{let l=i.getChannelData(o);if(0===s[r].byteLength)s[r]=l.slice(a,a+128);else{let i=new Float32Array(l.buffer,a*Float32Array.BYTES_PER_ELEMENT,128);s[r].set(i)}}}let nF=(i,s,r,o,a)=>{"function"==typeof i.copyToChannel?0!==s[r].byteLength&&i.copyToChannel(s[r],o,a):0!==s[r].byteLength&&i.getChannelData(o).set(s[r],a)},nj=(i,s)=>{let r=[];for(let o=0;o<i;o+=1){let i=[],a="number"==typeof s?s:s[o];for(let s=0;s<a;s+=1)i.push(new Float32Array(128));r.push(i)}return r},nB=(i,s)=>{let r=eD(eS,i);return eD(r,na(s))},nW={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},nU={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},nz={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},nG={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},nX={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},nY=i=>{let{port1:s,port2:r}=new MessageChannel;return new Promise(o=>{let a=()=>{r.onmessage=null,s.close(),r.close(),o()};r.onmessage=()=>a();try{s.postMessage(i,[i])}catch{}finally{a()}})},nZ={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},n$=i=>"delayTime"in i,nH=(i,s,r)=>{let o=s[r];if(void 0===o)throw i();return o},nJ={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},nQ={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},nK=()=>new DOMException("","InvalidStateError"),n0=()=>new DOMException("","InvalidAccessError"),n1=i=>{var s;i.getFrequencyResponse=(s=i.getFrequencyResponse,(r,o,a)=>{if(r.length!==o.length||o.length!==a.length)throw n0();return s.call(i,r,o,a)})},n2={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},n3=(i,s,r,o,a,l,h,u,c,d,p)=>{let m=d.length,f=u;for(let u=0;u<m;u+=1){let m=r[0]*d[u];for(let s=1;s<a;s+=1){let o=f-s&c-1;m+=r[s]*l[o],m-=i[s]*h[o]}for(let i=a;i<o;i+=1)m+=r[i]*l[f-i&c-1];for(let r=a;r<s;r+=1)m-=i[r]*h[f-r&c-1];l[f]=d[u],h[f]=m,f=f+1&c-1,p[u]=m}return f},n8={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},n4=i=>{let s=new Uint32Array([0x46464952,40,0x45564157,0x20746d66,16,131073,44100,176400,1048580,0x61746164,4,0]);try{let r=i.decodeAudioData(s.buffer,()=>{});return void 0!==r&&(r.catch(()=>{}),!0)}catch{}return!1},n6=(i,s,r)=>{let o=s[r];void 0!==o&&o!==i[r]&&(i[r]=o)},n5=(i,s)=>{n6(i,s,"channelCount"),n6(i,s,"channelCountMode"),n6(i,s,"channelInterpretation")},n7=i=>"function"==typeof i.getFloatTimeDomainData,n9=i=>{i.getFloatTimeDomainData=s=>{let r=new Uint8Array(s.length);i.getByteTimeDomainData(r);let o=Math.max(r.length,i.fftSize);for(let i=0;i<o;i+=1)s[i]=.0078125*(r[i]-128);return s}},it=(i,s,r)=>{let o=s[r];void 0!==o&&o!==i[r].value&&(i[r].value=o)},ie=i=>{var s;let r;i.start=(s=i.start,r=!1,(o=0,a=0,l)=>{if(r)throw nK();s.call(i,o,a,l),r=!0})},ii=i=>{var s;i.start=(s=i.start,(r=0,o=0,a)=>{if("number"==typeof a&&a<0||o<0||r<0)throw RangeError("The parameters can't be negative.");s.call(i,r,o,a)})},is=i=>{var s;i.stop=(s=i.stop,(r=0)=>{if(r<0)throw RangeError("The parameter can't be negative.");s.call(i,r)})},ir=i=>{let{port1:s}=new MessageChannel;try{s.postMessage(i)}finally{s.close()}},io=(i,s)=>null===i?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(i*s))))),ia=i=>new Promise((s,r)=>{let{port1:o,port2:a}=new MessageChannel;o.onmessage=({data:i})=>{o.close(),a.close(),s(i)},o.onmessageerror=({data:i})=>{o.close(),a.close(),r(i)},a.postMessage(i)}),il=async(i,s)=>new i(await ia(s)),ih=(i,s,r,o)=>{let a=eS.get(i);void 0===a&&(a=new WeakMap,eS.set(i,a));let l=il(r,o);return a.set(s,l),l},iu=(i,s)=>{let r=i.createBiquadFilter();return n5(r,s),it(r,s,"Q"),it(r,s,"detune"),it(r,s,"frequency"),it(r,s,"gain"),n6(r,s,"type"),r},ic=i=>{let s=i.numberOfOutputs;Object.defineProperty(i,"channelCount",{get:()=>s,set:i=>{if(i!==s)throw nK()}}),Object.defineProperty(i,"channelCountMode",{get:()=>"explicit",set:i=>{if("explicit"!==i)throw nK()}}),Object.defineProperty(i,"channelInterpretation",{get:()=>"discrete",set:i=>{if("discrete"!==i)throw nK()}})},id=(i,s)=>{let r=i.createChannelSplitter(s.numberOfOutputs);return n5(r,s),ic(r),r},ip=(i,s)=>(i.connect=s.connect.bind(s),i.disconnect=s.disconnect.bind(s),i),im=(i,s)=>{let r=i.createDelay(s.maxDelayTime);return n5(r,s),it(r,s,"delayTime"),r},i_=(i,s)=>{let r=i.createGain();return n5(r,s),it(r,s,"gain"),r};function ig(i,s){var r;let o=[0,0];for(let a=i.length-1;a>=0;a-=1)o=[(r=o)[0]*s[0]-r[1]*s[1],r[0]*s[1]+r[1]*s[0]],o[0]+=i[a];return o}let iv=(i,s,r,o)=>i.createScriptProcessor(s,r,o),iy=()=>new DOMException("","NotSupportedError"),ib={numberOfChannels:1},iT={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},iw={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},ix={disableNormalization:!1},iC={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},iS={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},iA=(i,s,r)=>void 0===i.copyFromChannel?i.getChannelData(r)[0]:(i.copyFromChannel(s,r),s[0]),ik=i=>{if(null===i)return!1;let s=i.length;return s%2!=0?0!==i[Math.floor(s/2)]:i[s/2-1]+i[s/2]!==0},iO=(i,s,r,o)=>{let a=i;for(;!a.hasOwnProperty(s);)a=Object.getPrototypeOf(a);let{get:l,set:h}=Object.getOwnPropertyDescriptor(a,s);Object.defineProperty(i,s,{get:r(l),set:o(h)})},iM=(i,s,r)=>{try{i.setValueAtTime(s,r)}catch(o){if(9!==o.code)throw o;iM(i,s,r+1e-7)}},iE=i=>{let s=i.createOscillator();try{s.start(-1)}catch(i){return i instanceof RangeError}return!1},iI=i=>{let s=i.createBuffer(1,1,44100),r=i.createBufferSource();r.buffer=s,r.start(),r.stop();try{return r.stop(),!0}catch{return!1}},iD=i=>{let s=i.createOscillator();try{s.stop(-1)}catch(i){return i instanceof RangeError}return!1},iR=(i,s)=>{var r,o;let a;let l=s.createGain();i.connect(l);let h=(r=i.disconnect,()=>{r.call(i,l),i.removeEventListener("ended",h)});i.addEventListener("ended",h),ip(i,l),i.stop=(o=i.stop,a=!1,(s=0)=>{if(a)try{o.call(i,s)}catch{l.gain.setValueAtTime(0,s)}else o.call(i,s),a=!0})},iP=(i,s)=>r=>{let o={value:i};return Object.defineProperties(r,{currentTarget:o,target:o}),"function"==typeof s?s.call(i,r):s.handleEvent.call(i,r)},iN=new WeakMap,iV=(p=new Map,m=new WeakMap,(i,s)=>{let r=m.get(i);if(void 0!==r)return r;let o=p.get(i);if(void 0!==o)return o;try{let r=s();return r instanceof Promise?(p.set(i,r),r.catch(()=>!1).then(s=>(p.delete(i),m.set(i,s),s))):(m.set(i,r),r)}catch{return m.set(i,!1),!1}}),iq="undefined"==typeof window?null:window,iL=(i,s)=>{let r=i.createAnalyser();if(n5(r,s),!(s.maxDecibels>s.minDecibels))throw eU();return n6(r,s,"fftSize"),n6(r,s,"maxDecibels"),n6(r,s,"minDecibels"),n6(r,s,"smoothingTimeConstant"),iV(n7,()=>n7(r))||n9(r),r},iF=i=>{let s=e0(i);if(null===s.renderer)throw Error("Missing the renderer of the given AudioNode in the audio graph.");return s.renderer},ij=async(i,s,r)=>{let o=e0(i);await Promise.all(o.activeInputs.map((o,a)=>Array.from(o).map(async([o,l])=>{let h=iF(o),u=await h.render(o,s),c=i.context.destination;nh(o)||i===c&&nh(i)||u.connect(r,l,a)})).reduce((i,s)=>[...i,...s],[]))},iB=i=>{let s=eT.get(i);if(void 0===s)throw nK();return s},iW=null===iq?null:iq.hasOwnProperty("OfflineAudioContext")?iq.OfflineAudioContext:iq.hasOwnProperty("webkitOfflineAudioContext")?iq.webkitOfflineAudioContext:null,iU=i=>null!==iW&&i instanceof iW,iz=new WeakMap,iG=class{constructor(i){this._nativeEventTarget=i,this._listeners=new WeakMap}addEventListener(i,s,r){if(null!==s){let o=this._listeners.get(s);void 0===o&&(o=iP(this,s),"function"==typeof s&&this._listeners.set(s,o)),this._nativeEventTarget.addEventListener(i,o,r)}}dispatchEvent(i){return this._nativeEventTarget.dispatchEvent(i)}removeEventListener(i,s,r){let o=null===s?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(i,void 0===o?null:o,r)}},iX=null===iq?null:iq.hasOwnProperty("AudioContext")?iq.AudioContext:iq.hasOwnProperty("webkitAudioContext")?iq.webkitAudioContext:null,iY=i=>null!==iX&&i instanceof iX,iZ=i=>null!==iq&&"function"==typeof iq.AudioNode&&i instanceof iq.AudioNode,i$=i=>null!==iq&&"function"==typeof iq.AudioParam&&i instanceof iq.AudioParam,iH=null===iq?null:iq.hasOwnProperty("AudioWorkletNode")?iq.AudioWorkletNode:null,iJ=(f=(i,s,r)=>{let o=[];for(let i=0;i<r.numberOfInputs;i+=1)o.push(new Set);eg.set(i,{activeInputs:o,outputs:new Set,passiveInputs:new WeakMap,renderer:s})},_=((i,s,r,o,a,l,h,u,c,d,p,m,f)=>{let _=new WeakMap;return(g,v,y,b,T)=>{let{activeInputs:w,passiveInputs:x}=l(v),{outputs:C}=l(g),S=u(g),A=l=>{let u=c(v),d=c(g);if(l){let s=eP(x,g,y,b);i(w,g,s,!1),T||m(g)||r(d,u,y,b),f(v)&&eV(v)}else{let i=o(w,g,y,b);s(x,b,i,!1),T||m(g)||a(d,u,y,b);let r=h(v);if(0===r)p(v)&&eF(v,w);else{let i=_.get(v);void 0!==i&&clearTimeout(i),_.set(v,setTimeout(()=>{p(v)&&eF(v,w)},1e3*r))}}};return!!d(C,[v,y,b],i=>i[0]===v&&i[1]===y&&i[2]===b,!0)&&(S.add(A),p(g)?i(w,g,[y,b,A],!0):s(x,b,[g,y,A],!0),!0)}})((i,s,[r,o,a],l)=>{e5(i[o],[s,r,a],i=>i[0]===s&&i[1]===r,l)},(i,s,[r,o,a],l)=>{let h=i.get(r);void 0===h?i.set(r,new Set([[o,s,a]])):e5(h,[o,s,a],i=>i[0]===o&&i[1]===s,l)},ne,(i,s,r,o)=>eR(i[o],i=>i[0]===s&&i[1]===r),no,e0,i=>{var s;return null!==(s=iN.get(i))&&void 0!==s?s:0},eN,na,e5,eX,nh,nu),g=i=>(s,r)=>{let o=ex.get(s);if(void 0===o){if(!i&&eX(s)){let i=na(s),{outputs:r}=e0(s);for(let s of r)if(e6(s))no(i,na(s[0]),s[1],s[2]);else{let r=nl(s[0]);i.disconnect(r,s[1])}}ex.set(s,r)}else ex.set(s,o+r)},v=(i,s)=>{let r=ex.get(i);if(void 0===r)throw Error("Missing the expected cycle count.");let o=iU(iB(i.context));if(r===s){if(ex.delete(i),!o&&eX(i)){let s=na(i),{outputs:r}=e0(i);for(let i of r)if(e6(i))ne(s,na(i[0]),i[1],i[2]);else{let r=nl(i[0]);s.connect(r,i[1])}}}else ex.set(i,r-s)},y=function i(s,r){let o=e4(r)?r:eD(iz,r);if(n$(o))return[];if(s[0]===o)return[s];if(s.includes(o))return[];let{outputs:a}=e0(o);return Array.from(a).map(r=>i([...s,o],r[0])).reduce((i,s)=>i.concat(s),[])},b=iG,class extends b{constructor(i,s,r,o){super(r),this._context=i,this._nativeAudioNode=r;let a=iB(i);iY(a)&&!0!==iV(nc,()=>nc(a,iH))&&nm(r),ev.set(this,r),ew.set(this,new Set),"closed"!==i.state&&s&&eV(this),f(this,o,r)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(i){this._nativeAudioNode.channelCount=i}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(i){this._nativeAudioNode.channelCountMode=i}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(i){this._nativeAudioNode.channelInterpretation=i}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(i,s=0,r=0){if(s<0||s>=this._nativeAudioNode.numberOfOutputs)throw eU();let o=iU(iB(this._context));if(iZ(i)||i$(i))throw n0();if(e4(i)){let a=na(i);try{let l=ne(this._nativeAudioNode,a,s,r),h=nu(this);(o||h)&&this._nativeAudioNode.disconnect(...l),"closed"!==this.context.state&&!h&&nu(i)&&eV(i)}catch(i){if(12===i.code)throw n0();throw i}return _(this,i,s,r,o)&&nd(y([this],i),g(o)),i}let a=nl(i);if("playbackRate"===a.name&&1024===a.maxValue)throw iy();try{this._nativeAudioNode.connect(a,s),(o||nu(this))&&this._nativeAudioNode.disconnect(a,s)}catch(i){if(12===i.code)throw n0();throw i}((i,s,r,o)=>{let{activeInputs:a,passiveInputs:l}=e1(s),{outputs:h}=e0(i),u=eN(i),c=h=>{let u=na(i),c=nl(s);if(h){let s=nr(l,i,r);e7(a,i,s,!1),o||nh(i)||u.connect(c,r)}else e9(l,ni(a,i,r),!1),o||nh(i)||u.disconnect(c,r)};return!!e5(h,[s,r],i=>i[0]===s&&i[1]===r,!0)&&(u.add(c),eX(i)?e7(a,i,[r,c],!0):e9(l,[i,r,c],!0),!0)})(this,i,s,o)&&nd(y([this],i),g(o))}disconnect(i,s,r){let o;let a=iU(iB(this._context));if(void 0===i)o=((i,s)=>{let r=e0(i),o=[];for(let a of r.outputs)e6(a)?nf(i,s,...a):n_(i,s,...a),o.push(a[0]);return r.outputs.clear(),o})(this,a);else if("number"==typeof i){if(i<0||i>=this.numberOfOutputs)throw eU();o=((i,s,r)=>{let o=e0(i),a=[];for(let l of o.outputs)l[1]===r&&(e6(l)?nf(i,s,...l):n_(i,s,...l),a.push(l[0]),o.outputs.delete(l));return a})(this,a,i)}else{if(void 0!==s&&(s<0||s>=this.numberOfOutputs)||e4(i)&&void 0!==r&&(r<0||r>=i.numberOfInputs))throw eU();if(0===(o=((i,s,r,o,a)=>{let l=e0(i);return Array.from(l.outputs).filter(i=>!(i[0]!==r||void 0!==o&&i[1]!==o||void 0!==a&&i[2]!==a)).map(r=>(e6(r)?nf(i,s,...r):n_(i,s,...r),l.outputs.delete(r),r[0]))})(this,a,i,s,r)).length)throw n0()}for(let i of o)nd(y([this],i),v)}}),iQ=(T=iJ,w=()=>{let i=new WeakMap;return{render(s,r){let o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=na(s);return eB(o,r)||(o=iL(r,{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,fftSize:o.fftSize,maxDecibels:o.maxDecibels,minDecibels:o.minDecibels,smoothingTimeConstant:o.smoothingTimeConstant})),i.set(r,o),await ij(s,r,o),o})(s,r)}}},class extends T{constructor(i,s){let r=iB(i),o=iL(r,{...ej,...s});super(i,!1,o,iU(r)?w():null),this._nativeAnalyserNode=o}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(i){this._nativeAnalyserNode.fftSize=i}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(i){let s=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=i,!(i>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=s,eU()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(i){let s=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=i,!(this._nativeAnalyserNode.maxDecibels>i))throw this._nativeAnalyserNode.minDecibels=s,eU()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(i){this._nativeAnalyserNode.smoothingTimeConstant=i}getByteFrequencyData(i){this._nativeAnalyserNode.getByteFrequencyData(i)}getByteTimeDomainData(i){this._nativeAnalyserNode.getByteTimeDomainData(i)}getFloatFrequencyData(i){this._nativeAnalyserNode.getFloatFrequencyData(i)}getFloatTimeDomainData(i){this._nativeAnalyserNode.getFloatTimeDomainData(i)}}),iK=new WeakSet,i0=null===iq?null:iq.hasOwnProperty("AudioBuffer")?iq.AudioBuffer:null,i1=(x=new Uint32Array(1),i=>(x[0]=i,x[0])),i2=i=>{i.copyFromChannel=(s,r,o=0)=>{let a=i1(o),l=i1(r);if(l>=i.numberOfChannels)throw eU();let h=i.length,u=i.getChannelData(l),c=s.length;for(let i=a<0?-a:0;i+a<h&&i<c;i+=1)s[i]=u[i+a]},i.copyToChannel=(s,r,o=0)=>{let a=i1(o),l=i1(r);if(l>=i.numberOfChannels)throw eU();let h=i.length,u=i.getChannelData(l),c=s.length;for(let i=a<0?-a:0;i+a<h&&i<c;i+=1)u[i+a]=s[i]}},i3=i=>{var s,r;i.copyFromChannel=(s=i.copyFromChannel,(r,o,a=0)=>{let l=i1(a),h=i1(o);if(l<i.length)return s.call(i,r,h,l)}),i.copyToChannel=(r=i.copyToChannel,(s,o,a=0)=>{let l=i1(a),h=i1(o);if(l<i.length)return r.call(i,s,h,l)})},i8=(i=()=>{if(null===i0)return!1;try{new i0({length:1,sampleRate:44100})}catch{return!1}return!0},C=null,class s{constructor(s){if(null===iW)throw Error("Missing the native OfflineAudioContext constructor.");let{length:r,numberOfChannels:o,sampleRate:a}={...eG,...s};null===C&&(C=new iW(1,1,44100));let l=null!==i0&&iV(i,i)?new i0({length:r,numberOfChannels:o,sampleRate:a}):C.createBuffer(o,r,a);if(0===l.numberOfChannels)throw iy();return"function"!=typeof l.copyFromChannel?(i2(l),ez(l)):iV(eW,()=>eW(l))||i3(l),iK.add(l),l}static[Symbol.hasInstance](i){return null!==i&&"object"==typeof i&&Object.getPrototypeOf(i)===s.prototype||iK.has(i)}}),i4=(i,s)=>{let r=i_(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.connect(r).connect(i.destination);let o=()=>{s.removeEventListener("ended",o),s.disconnect(r),r.disconnect()};s.addEventListener("ended",o)},i6=async(i,s,r)=>{let o=e1(i);await Promise.all(Array.from(o.activeInputs).map(async([i,o])=>{let a=iF(i),l=await a.render(i,s);nh(i)||l.connect(r,o)}))},i5=(i,s,r)=>i6(s,i,r),i7=(S=i=>{let s=i.createBufferSource();s.start();try{s.start()}catch{return!0}return!1},A=i=>{let s=i.createBufferSource(),r=i.createBuffer(1,1,44100);s.buffer=r;try{s.start(0,1)}catch{return!1}return!0},k=i=>{let s=i.createBufferSource();s.start();try{s.stop()}catch{return!1}return!0},O=i=>{var s;i.start=(s=i.start,(r=0,o=0,a)=>{let l=i.buffer,h=null===l?o:Math.min(l.duration,o);null!==l&&h>l.duration-.5/i.context.sampleRate?s.call(i,r,0,0):s.call(i,r,h,a)})},M=(i,s)=>{let r=s.createBuffer(1,1,44100);null===i.buffer&&(i.buffer=r),iO(i,"buffer",s=>()=>{let o=s.call(i);return o===r?null:o},s=>o=>s.call(i,null===o?r:o))},(i,s)=>{let r=i.createBufferSource();return n5(r,s),it(r,s,"playbackRate"),n6(r,s,"buffer"),n6(r,s,"loop"),n6(r,s,"loopEnd"),n6(r,s,"loopStart"),iV(S,()=>S(i))||ie(r),iV(A,()=>A(i))||O(r),iV(k,()=>k(i))||M(r,i),iV(iE,()=>iE(i))||ii(r),iV(iI,()=>iI(i))||iR(r,i),iV(iD,()=>iD(i))||is(r),i4(i,r),r}),i9=(E=i=>{let s=e1(i);if(null===s.renderer)throw Error("Missing the renderer of the given AudioParam in the audio graph.");return s.renderer},(i,s,r)=>(E(s).replay(r),i6(s,i,r))),st=(I=(i,s)=>{ey.set(i,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:s})},D=i=>({replay(s){for(let r of i)if("exponentialRampToValue"===r.type){let{endTime:i,value:o}=r;s.exponentialRampToValueAtTime(o,i)}else if("linearRampToValue"===r.type){let{endTime:i,value:o}=r;s.linearRampToValueAtTime(o,i)}else if("setTarget"===r.type){let{startTime:i,target:o,timeConstant:a}=r;s.setTargetAtTime(o,i,a)}else if("setValue"===r.type){let{startTime:i,value:o}=r;s.setValueAtTime(o,i)}else{if("setValueCurve"!==r.type)throw Error("Can't apply an unknown automation.");{let{duration:i,startTime:o,values:a}=r;s.setValueCurveAtTime(a,o,i)}}}}),R=i=>({cancelTime:i,type:"cancelAndHold"}),P=i=>({cancelTime:i,type:"cancelScheduledValues"}),N=(i,s)=>({endTime:s,type:"exponentialRampToValue",value:i}),V=(i,s)=>({endTime:s,type:"linearRampToValue",value:i}),q=(i,s,r)=>({startTime:s,target:i,timeConstant:r,type:"setTarget"}),(i,s,r,o=null,a=null)=>{let l=r.value,h=new nN(l),u=s?D(h):null,c={get defaultValue(){return l},get maxValue(){return null===o?r.maxValue:o},get minValue(){return null===a?r.minValue:a},get value(){return r.value},set value(e){r.value=e,c.setValueAtTime(e,i.context.currentTime)},cancelAndHoldAtTime(s){if("function"==typeof r.cancelAndHoldAtTime)null===u&&h.flush(i.context.currentTime),h.add(R(s)),r.cancelAndHoldAtTime(s);else{let o=Array.from(h).pop();null===u&&h.flush(i.context.currentTime),h.add(R(s));let a=Array.from(h).pop();r.cancelScheduledValues(s),o!==a&&void 0!==a&&("exponentialRampToValue"===a.type?r.exponentialRampToValueAtTime(a.value,a.endTime):"linearRampToValue"===a.type?r.linearRampToValueAtTime(a.value,a.endTime):"setValue"===a.type?r.setValueAtTime(a.value,a.startTime):"setValueCurve"===a.type&&r.setValueCurveAtTime(a.values,a.startTime,a.duration))}return c},cancelScheduledValues:s=>(null===u&&h.flush(i.context.currentTime),h.add(P(s)),r.cancelScheduledValues(s),c),exponentialRampToValueAtTime(s,o){if(0===s||!Number.isFinite(o)||o<0)throw RangeError();let a=i.context.currentTime;return null===u&&h.flush(a),0===Array.from(h).length&&(h.add(em(l,a)),r.setValueAtTime(l,a)),h.add(N(s,o)),r.exponentialRampToValueAtTime(s,o),c},linearRampToValueAtTime(s,o){let a=i.context.currentTime;return null===u&&h.flush(a),0===Array.from(h).length&&(h.add(em(l,a)),r.setValueAtTime(l,a)),h.add(V(s,o)),r.linearRampToValueAtTime(s,o),c},setTargetAtTime:(s,o,a)=>(null===u&&h.flush(i.context.currentTime),h.add(q(s,o,a)),r.setTargetAtTime(s,o,a),c),setValueAtTime:(s,o)=>(null===u&&h.flush(i.context.currentTime),h.add(em(s,o)),r.setValueAtTime(s,o),c),setValueCurveAtTime(s,o,a){let l=s instanceof Float32Array?s:new Float32Array(s);if(null!==iX&&"webkitAudioContext"===iX.name){let s=o+a,d=i.context.sampleRate,p=Math.ceil(o*d),m=Math.floor(s*d),f=m-p,_=new Float32Array(f);for(let i=0;i<f;i+=1){let s=(l.length-1)/a*((p+i)/d-o),r=Math.floor(s),h=Math.ceil(s);_[i]=r===h?l[r]:(1-(s-r))*l[r]+(1-(h-s))*l[h]}null===u&&h.flush(i.context.currentTime),h.add(ef(_,o,a)),r.setValueCurveAtTime(_,o,a);let g=m/d;g<s&&iM(c,_[_.length-1],g),iM(c,l[l.length-1],s)}else null===u&&h.flush(i.context.currentTime),h.add(ef(l,o,a)),r.setValueCurveAtTime(l,o,a);return c}};return eb.set(c,r),iz.set(c,i),I(c,u),c}),se=(L=iJ,F=()=>{let i=new WeakMap,s=null,r=null;return{set start(t){s=t},set stop(t){r=t},render(o,a){let l=i.get(a);return void 0!==l?Promise.resolve(l):(async(o,a)=>{let l=na(o),h=eB(l,a);return h||(l=i7(a,{buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,loop:l.loop,loopEnd:l.loopEnd,loopStart:l.loopStart,playbackRate:l.playbackRate.value}),null!==s&&l.start(...s),null!==r&&l.stop(r)),i.set(a,l),h?await i5(a,o.playbackRate,l.playbackRate):await i9(a,o.playbackRate,l.playbackRate),await ij(o,a,l),l})(o,a)}}},class extends L{constructor(i,s){let r=iB(i),o={...eY,...s},a=i7(r,o),l=iU(r),h=l?F():null;super(i,!1,a,h),this._audioBufferSourceNodeRenderer=h,this._isBufferNullified=!1,this._isBufferSet=null!==o.buffer,this._nativeAudioBufferSourceNode=a,this._onended=null,this._playbackRate=st(this,l,a.playbackRate,34028234663852886e22,-34028234663852886e22)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(i){if(this._nativeAudioBufferSourceNode.buffer=i,null!==i){if(this._isBufferSet)throw nK();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(i){this._nativeAudioBufferSourceNode.loop=i}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(i){this._nativeAudioBufferSourceNode.loopEnd=i}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(i){this._nativeAudioBufferSourceNode.loopStart=i}get onended(){return this._onended}set onended(i){let s="function"==typeof i?iP(this,i):null;this._nativeAudioBufferSourceNode.onended=s;let r=this._nativeAudioBufferSourceNode.onended;this._onended=null!==r&&r===s?i:r}get playbackRate(){return this._playbackRate}start(i=0,s=0,r){if(this._nativeAudioBufferSourceNode.start(i,s,r),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===r?[i,s]:[i,s,r]),"closed"!==this.context.state){eV(this);let i=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",i),eX(this)&&eL(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",i)}}stop(i=0){this._nativeAudioBufferSourceNode.stop(i),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=i)}}),sn=(j=iJ,B=i=>{let s=new WeakMap;return{render(r,o){let a=s.get(o);return void 0!==a?Promise.resolve(a):(async(r,o)=>{let a=o.destination;return s.set(o,a),await i(r,o,a),a})(r,o)}}},W=(i,s,r)=>{let o=i.destination;if(o.channelCount!==s)try{o.channelCount=s}catch{}r&&"explicit"!==o.channelCountMode&&(o.channelCountMode="explicit"),0===o.maxChannelCount&&Object.defineProperty(o,"maxChannelCount",{value:s});let a=i_(i,{channelCount:s,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,gain:1});return iO(a,"channelCount",i=>()=>i.call(a),i=>s=>{i.call(a,s);try{o.channelCount=s}catch(i){if(s>o.maxChannelCount)throw i}}),iO(a,"channelCountMode",i=>()=>i.call(a),i=>s=>{i.call(a,s),o.channelCountMode=s}),iO(a,"channelInterpretation",i=>()=>i.call(a),i=>s=>{i.call(a,s),o.channelInterpretation=s}),Object.defineProperty(a,"maxChannelCount",{get:()=>o.maxChannelCount}),a.connect(o),a},class extends j{constructor(i,s){let r=iB(i),o=iU(r),a=W(r,s,o);super(i,!1,a,o?B(ij):null),this._isNodeOfNativeOfflineAudioContext=o,this._nativeAudioDestinationNode=a}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(i){if(this._isNodeOfNativeOfflineAudioContext)throw nK();if(i>this._nativeAudioDestinationNode.maxChannelCount)throw eU();this._nativeAudioDestinationNode.channelCount=i}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(i){if(this._isNodeOfNativeOfflineAudioContext)throw nK();this._nativeAudioDestinationNode.channelCountMode=i}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}}),si=(i,s)=>iN.set(i,s),ss=(U=iJ,z=()=>{let i=new WeakMap;return{render(s,r){let o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=na(s),a=eB(o,r);return a||(o=iu(r,{Q:o.Q.value,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,detune:o.detune.value,frequency:o.frequency.value,gain:o.gain.value,type:o.type})),i.set(r,o),a?(await i5(r,s.Q,o.Q),await i5(r,s.detune,o.detune),await i5(r,s.frequency,o.frequency),await i5(r,s.gain,o.gain)):(await i9(r,s.Q,o.Q),await i9(r,s.detune,o.detune),await i9(r,s.frequency,o.frequency),await i9(r,s.gain,o.gain)),await ij(s,r,o),o})(s,r)}}},class extends U{constructor(i,s){let r=iB(i),o=iu(r,{...nW,...s}),a=iU(r);super(i,!1,o,a?z():null),this._Q=st(this,a,o.Q,34028234663852886e22,-34028234663852886e22),this._detune=st(this,a,o.detune,1200*Math.log2(34028234663852886e22),-1200*Math.log2(34028234663852886e22)),this._frequency=st(this,a,o.frequency,i.sampleRate/2,0),this._gain=st(this,a,o.gain,40*Math.log10(34028234663852886e22),-34028234663852886e22),this._nativeBiquadFilterNode=o,si(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(i){this._nativeBiquadFilterNode.type=i}getFrequencyResponse(i,s,r){try{this._nativeBiquadFilterNode.getFrequencyResponse(i,s,r)}catch(i){if(11===i.code)throw n0();throw i}if(i.length!==s.length||s.length!==r.length)throw n0()}}),sr=(i,s,r)=>{var o,a;let l=new Set;return i.connect=(o=i.connect,(r,a=0,h=0)=>{let u=0===l.size;if(iZ(r))return o.call(i,r,a,h),e5(l,[r,a,h],i=>i[0]===r&&i[1]===a&&i[2]===h,!0),u&&s(),r;o.call(i,r,a),e5(l,[r,a],i=>i[0]===r&&i[1]===a,!0),u&&s()}),i.disconnect=(a=i.disconnect,(s,o,h)=>{let u=l.size>0;if(void 0===s)a.apply(i),l.clear();else if("number"==typeof s)for(let r of(a.call(i,s),l))r[1]===s&&l.delete(r);else for(let r of(iZ(s)?a.call(i,s,o,h):a.call(i,s,o),l))r[0]!==s||void 0!==o&&r[1]!==o||void 0!==h&&r[2]!==h||l.delete(r);let c=0===l.size;u&&c&&r()}),i},so=(G=(i,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw nK()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw nK()}});let r=i.createBufferSource();sr(s,()=>{let i=s.numberOfInputs;for(let o=0;o<i;o+=1)r.connect(s,0,o)},()=>r.disconnect(s))},(i,s)=>{let r=i.createChannelMerger(s.numberOfInputs);return null!==iX&&"webkitAudioContext"===iX.name&&G(i,r),n5(r,s),r}),sa=(X=iJ,Y=()=>{let i=new WeakMap;return{render(s,r){let o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=na(s);return eB(o,r)||(o=so(r,{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs})),i.set(r,o),await ij(s,r,o),o})(s,r)}}},class extends X{constructor(i,s){let r=iB(i);super(i,!1,so(r,{...nU,...s}),iU(r)?Y():null)}}),sl=(Z=iJ,$=()=>{let i=new WeakMap;return{render(s,r){let o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=na(s);return eB(o,r)||(o=id(r,{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfOutputs:o.numberOfOutputs})),i.set(r,o),await ij(s,r,o),o})(s,r)}}},H=i=>({...i,channelCount:i.numberOfOutputs}),class extends Z{constructor(i,s){let r=iB(i);super(i,!1,id(r,H({...nz,...s})),iU(r)?$():null)}}),sh=(J=(i,{offset:s,...r})=>{let o=i.createBuffer(1,2,44100),a=i7(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=i_(i,{...r,gain:s}),h=o.getChannelData(0);return h[0]=1,h[1]=1,a.buffer=o,a.loop=!0,i4(i,a),sr(ip({get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(e){l.channelCount=e},get channelCountMode(){return l.channelCountMode},set channelCountMode(e){l.channelCountMode=e},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(e){l.channelInterpretation=e},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return a.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return a.onended},set onended(e){a.onended=e},addEventListener:(...i)=>a.addEventListener(i[0],i[1],i[2]),dispatchEvent:(...i)=>a.dispatchEvent(i[0]),removeEventListener:(...i)=>a.removeEventListener(i[0],i[1],i[2]),start(i=0){a.start.call(a,i)},stop(i=0){a.stop.call(a,i)}},l),()=>a.connect(l),()=>a.disconnect(l))},(i,s)=>{if(void 0===i.createConstantSource)return J(i,s);let r=i.createConstantSource();return n5(r,s),it(r,s,"offset"),iV(iE,()=>iE(i))||ii(r),iV(iD,()=>iD(i))||is(r),i4(i,r),r}),su=(Q=iJ,K=()=>{let i=new WeakMap,s=null,r=null;return{set start(t){s=t},set stop(t){r=t},render(o,a){let l=i.get(a);return void 0!==l?Promise.resolve(l):(async(o,a)=>{let l=na(o),h=eB(l,a);return h||(l=sh(a,{channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,offset:l.offset.value}),null!==s&&l.start(s),null!==r&&l.stop(r)),i.set(a,l),h?await i5(a,o.offset,l.offset):await i9(a,o.offset,l.offset),await ij(o,a,l),l})(o,a)}}},class extends Q{constructor(i,s){let r=iB(i),o=sh(r,{...nG,...s}),a=iU(r),l=a?K():null;super(i,!1,o,l),this._constantSourceNodeRenderer=l,this._nativeConstantSourceNode=o,this._offset=st(this,a,o.offset,34028234663852886e22,-34028234663852886e22),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(i){let s="function"==typeof i?iP(this,i):null;this._nativeConstantSourceNode.onended=s;let r=this._nativeConstantSourceNode.onended;this._onended=null!==r&&r===s?i:r}start(i=0){if(this._nativeConstantSourceNode.start(i),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=i),"closed"!==this.context.state){eV(this);let i=()=>{this._nativeConstantSourceNode.removeEventListener("ended",i),eX(this)&&eL(this)};this._nativeConstantSourceNode.addEventListener("ended",i)}}stop(i=0){this._nativeConstantSourceNode.stop(i),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=i)}}),sc=(i,s)=>{let r=i.createConvolver();if(n5(r,s),s.disableNormalization===r.normalize&&(r.normalize=!s.disableNormalization),n6(r,s,"buffer"),s.channelCount>2||(iO(r,"channelCount",i=>()=>i.call(r),i=>s=>{if(s>2)throw iy();return i.call(r,s)}),"max"===s.channelCountMode))throw iy();return iO(r,"channelCountMode",i=>()=>i.call(r),i=>s=>{if("max"===s)throw iy();return i.call(r,s)}),r},sd=(tt=iJ,te=()=>{let i=new WeakMap;return{render(s,r){let o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=na(s);return eB(o,r)||(o=sc(r,{buffer:o.buffer,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,disableNormalization:!o.normalize})),i.set(r,o),nt(o)?await ij(s,r,o.inputs[0]):await ij(s,r,o),o})(s,r)}}},class extends tt{constructor(i,s){let r=iB(i),o={...nX,...s},a=sc(r,o);super(i,!1,a,iU(r)?te():null),this._isBufferNullified=!1,this._nativeConvolverNode=a,null!==o.buffer&&si(this,o.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(i){if(this._nativeConvolverNode.buffer=i,null===i&&null!==this._nativeConvolverNode.buffer){let i=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=i.createBuffer(1,1,i.sampleRate),this._isBufferNullified=!0,si(this,0)}else this._isBufferNullified=!1,si(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(i){this._nativeConvolverNode.normalize=i}}),sp=(tn=iJ,ti=i=>{let s=new WeakMap;return{render(r,o){let a=s.get(o);return void 0!==a?Promise.resolve(a):(async(r,o)=>{let a=na(r),l=eB(a,o);return l||(a=im(o,{channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,delayTime:a.delayTime.value,maxDelayTime:i})),s.set(o,a),l?await i5(o,r.delayTime,a.delayTime):await i9(o,r.delayTime,a.delayTime),await ij(r,o,a),a})(r,o)}}},class extends tn{constructor(i,s){let r=iB(i),o={...nZ,...s},a=im(r,o),l=iU(r);super(i,!1,a,l?ti(o.maxDelayTime):null),this._delayTime=st(this,l,a.delayTime),si(this,o.maxDelayTime)}get delayTime(){return this._delayTime}}),sm=(i,s)=>{let r=i.createDynamicsCompressor();if(n5(r,s),s.channelCount>2||"max"===s.channelCountMode)throw iy();return it(r,s,"attack"),it(r,s,"knee"),it(r,s,"ratio"),it(r,s,"release"),it(r,s,"threshold"),r},sf=(ts=iJ,tr=()=>{let i=new WeakMap;return{render(s,r){let o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=na(s),a=eB(o,r);return a||(o=sm(r,{attack:o.attack.value,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,knee:o.knee.value,ratio:o.ratio.value,release:o.release.value,threshold:o.threshold.value})),i.set(r,o),a?(await i5(r,s.attack,o.attack),await i5(r,s.knee,o.knee),await i5(r,s.ratio,o.ratio),await i5(r,s.release,o.release),await i5(r,s.threshold,o.threshold)):(await i9(r,s.attack,o.attack),await i9(r,s.knee,o.knee),await i9(r,s.ratio,o.ratio),await i9(r,s.release,o.release),await i9(r,s.threshold,o.threshold)),await ij(s,r,o),o})(s,r)}}},class extends ts{constructor(i,s){let r=iB(i),o=sm(r,{...nJ,...s}),a=iU(r);super(i,!1,o,a?tr():null),this._attack=st(this,a,o.attack),this._knee=st(this,a,o.knee),this._nativeDynamicsCompressorNode=o,this._ratio=st(this,a,o.ratio),this._release=st(this,a,o.release),this._threshold=st(this,a,o.threshold),si(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(i){let s=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=i,i>2)throw this._nativeDynamicsCompressorNode.channelCount=s,iy()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(i){let s=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=i,"max"===i)throw this._nativeDynamicsCompressorNode.channelCountMode=s,iy()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}}),s_=(to=iJ,ta=()=>{let i=new WeakMap;return{render(s,r){let o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=na(s),a=eB(o,r);return a||(o=i_(r,{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,gain:o.gain.value})),i.set(r,o),a?await i5(r,s.gain,o.gain):await i9(r,s.gain,o.gain),await ij(s,r,o),o})(s,r)}}},class extends to{constructor(i,s){let r=iB(i),o=i_(r,{...nQ,...s}),a=iU(r);super(i,!1,o,a?ta():null),this._gain=st(this,a,o.gain,34028234663852886e22,-34028234663852886e22)}get gain(){return this._gain}}),sg=(tl=()=>{if(null===iW)return Promise.resolve(!1);let i=new iW(1,1,44100),s=i_(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(r=>{i.oncomplete=()=>{s.disconnect(),r(0!==i.currentTime)},i.startRendering()})},i=>iV(n4,()=>n4(i))?Promise.resolve(iV(tl,tl)).then(s=>{if(!s){let s=iv(i,512,0,1);i.oncomplete=()=>{s.onaudioprocess=null,s.disconnect()},s.onaudioprocess=()=>i.currentTime,s.connect(i.destination)}return i.startRendering()}):new Promise(s=>{let r=i_(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=i=>{r.disconnect(),s(i.renderedBuffer)},r.connect(i.destination),i.startRendering()})),sv=(tu=iJ,th=(i,s,{channelCount:r,channelCountMode:o,channelInterpretation:a,feedback:l,feedforward:h})=>{let u=io(s,i.sampleRate),c=l instanceof Float64Array?l:new Float64Array(l),d=h instanceof Float64Array?h:new Float64Array(h),p=c.length,m=d.length,f=Math.min(p,m);if(0===p||p>20)throw iy();if(0===c[0])throw nK();if(0===m||m>20)throw iy();if(0===d[0])throw nK();if(1!==c[0]){for(let i=0;i<m;i+=1)d[i]/=c[0];for(let i=1;i<p;i+=1)c[i]/=c[0]}let _=iv(i,u,r,r);_.channelCount=r,_.channelCountMode=o,_.channelInterpretation=a;let g=[],v=[],y=[];for(let i=0;i<r;i+=1){g.push(0);let i=new Float32Array(32),s=new Float32Array(32);i.fill(0),s.fill(0),v.push(i),y.push(s)}_.onaudioprocess=i=>{let s=i.inputBuffer,r=i.outputBuffer,o=s.numberOfChannels;for(let i=0;i<o;i+=1){let o=s.getChannelData(i),a=r.getChannelData(i);g[i]=n3(c,p,d,m,f,v[i],y[i],g[i],32,o,a)}};let b=i.sampleRate/2;return ip({get bufferSize(){return u},get channelCount(){return _.channelCount},set channelCount(t){_.channelCount=t},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){_.channelCountMode=t},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(t){_.channelInterpretation=t},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...i)=>_.addEventListener(i[0],i[1],i[2]),dispatchEvent:(...i)=>_.dispatchEvent(i[0]),getFrequencyResponse(i,s,r){if(i.length!==s.length||s.length!==r.length)throw n0();let o=i.length;for(let a=0;a<o;a+=1){let o=-Math.PI*(i[a]/b),l=[Math.cos(o),Math.sin(o)],h=function(i,s){let r=s[0]*s[0]+s[1]*s[1];return[(i[0]*s[0]+i[1]*s[1])/r,(i[1]*s[0]-i[0]*s[1])/r]}(ig(d,l),ig(c,l));s[a]=Math.sqrt(h[0]*h[0]+h[1]*h[1]),r[a]=Math.atan2(h[1],h[0])}},removeEventListener:(...i)=>_.removeEventListener(i[0],i[1],i[2])},_)},tc=(i,s,r)=>{if(void 0===i.createIIRFilter)return th(i,s,r);let o=i.createIIRFilter(r.feedforward,r.feedback);return n5(o,r),o},td=(i,s)=>{let r=new WeakMap,o=null,a=async(a,l)=>{let h=null,u=na(a),c=eB(u,l);if(void 0===l.createIIRFilter?h=i7(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):c||(u=l.createIIRFilter(s,i)),r.set(l,null===h?u:h),null!==h){if(null===o){if(null===iW)throw Error("Missing the native OfflineAudioContext constructor.");let r=new iW(a.context.destination.channelCount,a.context.length,l.sampleRate);o=(async()=>(await ij(a,r,r.destination),((i,s,r,o)=>{let a=r instanceof Float64Array?r:new Float64Array(r),l=o instanceof Float64Array?o:new Float64Array(o),h=a.length,u=l.length,c=Math.min(h,u);if(1!==a[0]){for(let i=0;i<h;i+=1)l[i]/=a[0];for(let i=1;i<u;i+=1)a[i]/=a[0]}let d=new Float32Array(32),p=new Float32Array(32),m=s.createBuffer(i.numberOfChannels,i.length,i.sampleRate),f=i.numberOfChannels;for(let s=0;s<f;s+=1){let r=i.getChannelData(s),o=m.getChannelData(s);d.fill(0),p.fill(0),n3(a,h,l,u,c,d,p,0,32,r,o)}return m})(await sg(r),l,i,s)))()}let r=await o;return h.buffer=r,h.start(0),h}return await ij(a,l,u),u};return{render(i,s){let o=r.get(s);return void 0!==o?Promise.resolve(o):a(i,s)}}},class extends tu{constructor(i,s){let r=iB(i),o=iU(r),a={...n2,...s},l=tc(r,o?null:i.baseLatency,a);super(i,!1,l,o?td(a.feedback,a.feedforward):null),n1(l),this._nativeIIRFilterNode=l,si(this,1)}getFrequencyResponse(i,s,r){return this._nativeIIRFilterNode.getFrequencyResponse(i,s,r)}}),sy=new WeakMap,sb=(tp=(i,s)=>{let r=s.listener,{forwardX:o,forwardY:a,forwardZ:l,positionX:h,positionY:u,positionZ:c,upX:d,upY:p,upZ:m}=void 0===r.forwardX?(()=>{let o=new Float32Array(1),a=so(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),l=iU(s),h=!1,u=[0,0,-1,0,1,0],c=[0,0,0],d=()=>{if(h)return;h=!0;let i=iv(s,256,9,0);i.onaudioprocess=({inputBuffer:i})=>{let s=[iA(i,o,0),iA(i,o,1),iA(i,o,2),iA(i,o,3),iA(i,o,4),iA(i,o,5)];s.some((i,s)=>i!==u[s])&&(r.setOrientation(...s),u=s);let a=[iA(i,o,6),iA(i,o,7),iA(i,o,8)];a.some((i,s)=>i!==c[s])&&(r.setPosition(...a),c=a)},a.connect(i)},p=i=>s=>{s!==u[i]&&(u[i]=s,r.setOrientation(...u))},m=i=>s=>{s!==c[i]&&(c[i]=s,r.setPosition(...c))},f=(r,o,h)=>{var u,c,p,m,f,_,g;let v=sh(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:o});v.connect(a,0,r),v.start(),Object.defineProperty(v.offset,"defaultValue",{get:()=>o});let y=st({context:i},l,v.offset,34028234663852886e22,-34028234663852886e22);return iO(y,"value",i=>()=>i.call(y),i=>s=>{try{i.call(y,s)}catch(i){if(9!==i.code)throw i}d(),l&&h(s)}),y.cancelAndHoldAtTime=(u=y.cancelAndHoldAtTime,l?()=>{throw iy()}:(...i)=>{let s=u.apply(y,i);return d(),s}),y.cancelScheduledValues=(c=y.cancelScheduledValues,l?()=>{throw iy()}:(...i)=>{let s=c.apply(y,i);return d(),s}),y.exponentialRampToValueAtTime=(p=y.exponentialRampToValueAtTime,l?()=>{throw iy()}:(...i)=>{let s=p.apply(y,i);return d(),s}),y.linearRampToValueAtTime=(m=y.linearRampToValueAtTime,l?()=>{throw iy()}:(...i)=>{let s=m.apply(y,i);return d(),s}),y.setTargetAtTime=(f=y.setTargetAtTime,l?()=>{throw iy()}:(...i)=>{let s=f.apply(y,i);return d(),s}),y.setValueAtTime=(_=y.setValueAtTime,l?()=>{throw iy()}:(...i)=>{let s=_.apply(y,i);return d(),s}),y.setValueCurveAtTime=(g=y.setValueCurveAtTime,l?()=>{throw iy()}:(...i)=>{let s=g.apply(y,i);return d(),s}),y};return{forwardX:f(0,0,p(0)),forwardY:f(1,0,p(1)),forwardZ:f(2,-1,p(2)),positionX:f(6,0,m(0)),positionY:f(7,0,m(1)),positionZ:f(8,0,m(2)),upX:f(3,0,p(3)),upY:f(4,1,p(4)),upZ:f(5,0,p(5))}})():r;return{get forwardX(){return o},get forwardY(){return a},get forwardZ(){return l},get positionX(){return h},get positionY(){return u},get positionZ(){return c},get upX(){return d},get upY(){return p},get upZ(){return m}}},tm=iG,class extends tm{constructor(i,s){super(i),this._nativeContext=i,eT.set(this,i),iU(i)&&sy.set(i,new Set),this._destination=new sn(this,s),this._listener=tp(this,i),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(i){let s="function"==typeof i?iP(this,i):null;this._nativeContext.onstatechange=s;let r=this._nativeContext.onstatechange;this._onstatechange=null!==r&&r===s?i:r}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}}),sT=(i,s)=>{let r=i.createOscillator();return n5(r,s),it(r,s,"detune"),it(r,s,"frequency"),void 0!==s.periodicWave?r.setPeriodicWave(s.periodicWave):n6(r,s,"type"),iV(iE,()=>iE(i))||ii(r),iV(iI,()=>iI(i))||iR(r,i),iV(iD,()=>iD(i))||is(r),i4(i,r),r},sw=(tf=iJ,t_=()=>{let i=new WeakMap,s=null,r=null,o=null;return{set periodicWave(e){s=e},set start(e){r=e},set stop(e){o=e},render(a,l){let h=i.get(l);return void 0!==h?Promise.resolve(h):(async(a,l)=>{let h=na(a),u=eB(h,l);return u||(h=sT(l,{channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:null===s?void 0:s,type:h.type}),null!==r&&h.start(r),null!==o&&h.stop(o)),i.set(l,h),u?(await i5(l,a.detune,h.detune),await i5(l,a.frequency,h.frequency)):(await i9(l,a.detune,h.detune),await i9(l,a.frequency,h.frequency)),await ij(a,l,h),h})(a,l)}}},class extends tf{constructor(i,s){let r=iB(i),o={...iT,...s},a=sT(r,o),l=iU(r),h=l?t_():null,u=i.sampleRate/2;super(i,!1,a,h),this._detune=st(this,l,a.detune,153600,-153600),this._frequency=st(this,l,a.frequency,u,-u),this._nativeOscillatorNode=a,this._onended=null,this._oscillatorNodeRenderer=h,null!==this._oscillatorNodeRenderer&&void 0!==o.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=o.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(i){let s="function"==typeof i?iP(this,i):null;this._nativeOscillatorNode.onended=s;let r=this._nativeOscillatorNode.onended;this._onended=null!==r&&r===s?i:r}get type(){return this._nativeOscillatorNode.type}set type(i){this._nativeOscillatorNode.type=i,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(i){this._nativeOscillatorNode.setPeriodicWave(i),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=i)}start(i=0){if(this._nativeOscillatorNode.start(i),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=i),"closed"!==this.context.state){eV(this);let i=()=>{this._nativeOscillatorNode.removeEventListener("ended",i),eX(this)&&eL(this)};this._nativeOscillatorNode.addEventListener("ended",i)}}stop(i=0){this._nativeOscillatorNode.stop(i),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=i)}}),sx=(i,s)=>{let r=i7(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),o=i.createBuffer(1,2,44100);return r.buffer=o,r.loop=!0,r.connect(s),r.start(),()=>{r.stop(),r.disconnect(s)}},sC=(tg=(i,{curve:s,oversample:r,...o})=>{let a=i.createWaveShaper(),l=i.createWaveShaper();n5(a,o),n5(l,o);let h=i_(i,{...o,gain:1}),u=i_(i,{...o,gain:-1}),c=i_(i,{...o,gain:1}),d=i_(i,{...o,gain:-1}),p=null,m=!1,f=null,_={get bufferSize(){},get channelCount(){return a.channelCount},set channelCount(n){h.channelCount=n,u.channelCount=n,a.channelCount=n,c.channelCount=n,l.channelCount=n,d.channelCount=n},get channelCountMode(){return a.channelCountMode},set channelCountMode(n){h.channelCountMode=n,u.channelCountMode=n,a.channelCountMode=n,c.channelCountMode=n,l.channelCountMode=n,d.channelCountMode=n},get channelInterpretation(){return a.channelInterpretation},set channelInterpretation(n){h.channelInterpretation=n,u.channelInterpretation=n,a.channelInterpretation=n,c.channelInterpretation=n,l.channelInterpretation=n,d.channelInterpretation=n},get context(){return a.context},get curve(){return f},set curve(n){if(null!==n&&n.length<2)throw nK();if(null===n)a.curve=n,l.curve=n;else{let i=n.length,s=new Float32Array(i+2-i%2),r=new Float32Array(i+2-i%2);s[0]=n[0],r[0]=-n[i-1];let o=Math.ceil((i+1)/2),h=(i+1)/2-1;for(let a=1;a<o;a+=1){let l=a/o*h,u=Math.floor(l),c=Math.ceil(l);s[a]=u===c?n[u]:(1-(l-u))*n[u]+(1-(c-l))*n[c],r[a]=u===c?-n[i-1-u]:-(1-(l-u))*n[i-1-u]-(1-(c-l))*n[i-1-c]}s[o]=i%2==1?n[o-1]:(n[o-2]+n[o-1])/2,a.curve=s,l.curve=r}f=n,m&&(ik(f)&&null===p?p=sx(i,h):null!==p&&(p(),p=null))},get inputs(){return[h]},get numberOfInputs(){return a.numberOfInputs},get numberOfOutputs(){return a.numberOfOutputs},get oversample(){return a.oversample},set oversample(n){a.oversample=n,l.oversample=n},addEventListener:(...i)=>h.addEventListener(i[0],i[1],i[2]),dispatchEvent:(...i)=>h.dispatchEvent(i[0]),removeEventListener:(...i)=>h.removeEventListener(i[0],i[1],i[2])};return null!==s&&(_.curve=s instanceof Float32Array?s:new Float32Array(s)),r!==_.oversample&&(_.oversample=r),sr(ip(_,c),()=>{h.connect(a).connect(c),h.connect(u).connect(l).connect(d).connect(c),m=!0,ik(f)&&(p=sx(i,h))},()=>{h.disconnect(a),a.disconnect(c),h.disconnect(u),u.disconnect(l),l.disconnect(d),d.disconnect(c),m=!1,null!==p&&(p(),p=null)})},(i,s)=>{let r=i.createWaveShaper();if(null!==iX&&"webkitAudioContext"===iX.name&&void 0===i.createGain().gain.automationRate)return tg(i,s);n5(r,s);let o=null===s.curve||s.curve instanceof Float32Array?s.curve:new Float32Array(s.curve);if(null!==o&&o.length<2)throw nK();n6(r,{curve:o},"curve"),n6(r,s,"oversample");let a=null,l=!1;return iO(r,"curve",i=>()=>i.call(r),s=>o=>(s.call(r,o),l&&(ik(o)&&null===a?a=sx(i,r):ik(o)||null===a||(a(),a=null)),o)),sr(r,()=>{l=!0,ik(r.curve)&&(a=sx(i,r))},()=>{l=!1,null!==a&&(a(),a=null)})}),sS=(tv=(i,{coneInnerAngle:s,coneOuterAngle:r,coneOuterGain:o,distanceModel:a,maxDistance:l,orientationX:h,orientationY:u,orientationZ:c,panningModel:d,positionX:p,positionY:m,positionZ:f,refDistance:_,rolloffFactor:g,...v})=>{let y=i.createPanner();if(v.channelCount>2||"max"===v.channelCountMode)throw iy();n5(y,v);let b={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},T=so(i,{...b,channelInterpretation:"speakers",numberOfInputs:6}),w=i_(i,{...v,gain:1}),x=i_(i,{...b,gain:1}),C=i_(i,{...b,gain:0}),S=i_(i,{...b,gain:0}),A=i_(i,{...b,gain:0}),k=i_(i,{...b,gain:0}),O=i_(i,{...b,gain:0}),M=iv(i,256,6,1),E=sC(i,{...b,curve:new Float32Array([1,1]),oversample:"none"}),I=[h,u,c],D=[p,m,f],R=new Float32Array(1);M.onaudioprocess=({inputBuffer:i})=>{let s=[iA(i,R,0),iA(i,R,1),iA(i,R,2)];s.some((i,s)=>i!==I[s])&&(y.setOrientation(...s),I=s);let r=[iA(i,R,3),iA(i,R,4),iA(i,R,5)];r.some((i,s)=>i!==D[s])&&(y.setPosition(...r),D=r)},Object.defineProperty(C.gain,"defaultValue",{get:()=>0}),Object.defineProperty(S.gain,"defaultValue",{get:()=>0}),Object.defineProperty(A.gain,"defaultValue",{get:()=>0}),Object.defineProperty(k.gain,"defaultValue",{get:()=>0}),Object.defineProperty(O.gain,"defaultValue",{get:()=>0});let P={get bufferSize(){},get channelCount(){return y.channelCount},set channelCount(n){if(n>2)throw iy();w.channelCount=n,y.channelCount=n},get channelCountMode(){return y.channelCountMode},set channelCountMode(n){if("max"===n)throw iy();w.channelCountMode=n,y.channelCountMode=n},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(n){w.channelInterpretation=n,y.channelInterpretation=n},get coneInnerAngle(){return y.coneInnerAngle},set coneInnerAngle(n){y.coneInnerAngle=n},get coneOuterAngle(){return y.coneOuterAngle},set coneOuterAngle(n){y.coneOuterAngle=n},get coneOuterGain(){return y.coneOuterGain},set coneOuterGain(n){if(n<0||n>1)throw nK();y.coneOuterGain=n},get context(){return y.context},get distanceModel(){return y.distanceModel},set distanceModel(n){y.distanceModel=n},get inputs(){return[w]},get maxDistance(){return y.maxDistance},set maxDistance(n){if(n<0)throw RangeError();y.maxDistance=n},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},get orientationX(){return x.gain},get orientationY(){return C.gain},get orientationZ(){return S.gain},get panningModel(){return y.panningModel},set panningModel(n){y.panningModel=n},get positionX(){return A.gain},get positionY(){return k.gain},get positionZ(){return O.gain},get refDistance(){return y.refDistance},set refDistance(n){if(n<0)throw RangeError();y.refDistance=n},get rolloffFactor(){return y.rolloffFactor},set rolloffFactor(n){if(n<0)throw RangeError();y.rolloffFactor=n},addEventListener:(...i)=>w.addEventListener(i[0],i[1],i[2]),dispatchEvent:(...i)=>w.dispatchEvent(i[0]),removeEventListener:(...i)=>w.removeEventListener(i[0],i[1],i[2])};return s!==P.coneInnerAngle&&(P.coneInnerAngle=s),r!==P.coneOuterAngle&&(P.coneOuterAngle=r),o!==P.coneOuterGain&&(P.coneOuterGain=o),a!==P.distanceModel&&(P.distanceModel=a),l!==P.maxDistance&&(P.maxDistance=l),h!==P.orientationX.value&&(P.orientationX.value=h),u!==P.orientationY.value&&(P.orientationY.value=u),c!==P.orientationZ.value&&(P.orientationZ.value=c),d!==P.panningModel&&(P.panningModel=d),p!==P.positionX.value&&(P.positionX.value=p),m!==P.positionY.value&&(P.positionY.value=m),f!==P.positionZ.value&&(P.positionZ.value=f),_!==P.refDistance&&(P.refDistance=_),g!==P.rolloffFactor&&(P.rolloffFactor=g),1===I[0]&&0===I[1]&&0===I[2]||y.setOrientation(...I),0===D[0]&&0===D[1]&&0===D[2]||y.setPosition(...D),sr(ip(P,y),()=>{w.connect(y),ne(w,E,0,0),E.connect(x).connect(T,0,0),E.connect(C).connect(T,0,1),E.connect(S).connect(T,0,2),E.connect(A).connect(T,0,3),E.connect(k).connect(T,0,4),E.connect(O).connect(T,0,5),T.connect(M).connect(i.destination)},()=>{w.disconnect(y),no(w,E,0,0),E.disconnect(x),x.disconnect(T),E.disconnect(C),C.disconnect(T),E.disconnect(S),S.disconnect(T),E.disconnect(A),A.disconnect(T),E.disconnect(k),k.disconnect(T),E.disconnect(O),O.disconnect(T),T.disconnect(M),M.disconnect(i.destination)})},(i,s)=>{let r=i.createPanner();return void 0===r.orientationX?tv(i,s):(n5(r,s),it(r,s,"orientationX"),it(r,s,"orientationY"),it(r,s,"orientationZ"),it(r,s,"positionX"),it(r,s,"positionY"),it(r,s,"positionZ"),n6(r,s,"coneInnerAngle"),n6(r,s,"coneOuterAngle"),n6(r,s,"coneOuterGain"),n6(r,s,"distanceModel"),n6(r,s,"maxDistance"),n6(r,s,"panningModel"),n6(r,s,"refDistance"),n6(r,s,"rolloffFactor"),r)}),sA=(ty=iJ,tb=()=>{let i=new WeakMap,s=null;return{render(r,o){let a=i.get(o);return void 0!==a?Promise.resolve(a):(async(r,o)=>{let a=null,l=na(r),h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation},u={...h,coneInnerAngle:l.coneInnerAngle,coneOuterAngle:l.coneOuterAngle,coneOuterGain:l.coneOuterGain,distanceModel:l.distanceModel,maxDistance:l.maxDistance,panningModel:l.panningModel,refDistance:l.refDistance,rolloffFactor:l.rolloffFactor},c=eB(l,o);if("bufferSize"in l?a=i_(o,{...h,gain:1}):c||(l=sS(o,{...u,orientationX:l.orientationX.value,orientationY:l.orientationY.value,orientationZ:l.orientationZ.value,positionX:l.positionX.value,positionY:l.positionY.value,positionZ:l.positionZ.value})),i.set(o,null===a?l:a),null!==a){if(null===s){if(null===iW)throw Error("Missing the native OfflineAudioContext constructor.");let i=new iW(6,r.context.length,o.sampleRate),a=so(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});a.connect(i.destination),s=(async()=>{let s=await Promise.all([r.orientationX,r.orientationY,r.orientationZ,r.positionX,r.positionY,r.positionZ].map(async(s,r)=>{let o=sh(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===r?1:0});return await i9(i,s,o.offset),o}));for(let i=0;i<6;i+=1)s[i].connect(a,0,i),s[i].start(0);return sg(i)})()}let i=await s,l=i_(o,{...h,gain:1});await ij(r,o,l);let c=[];for(let s=0;s<i.numberOfChannels;s+=1)c.push(i.getChannelData(s));let d=[c[0][0],c[1][0],c[2][0]],p=[c[3][0],c[4][0],c[5][0]],m=i_(o,{...h,gain:1}),f=sS(o,{...u,orientationX:d[0],orientationY:d[1],orientationZ:d[2],positionX:p[0],positionY:p[1],positionZ:p[2]});l.connect(m).connect(f.inputs[0]),f.connect(a);for(let s=128;s<i.length;s+=128){let i=[c[0][s],c[1][s],c[2][s]],r=[c[3][s],c[4][s],c[5][s]];if(i.some((i,s)=>i!==d[s])||r.some((i,s)=>i!==p[s])){d=i,p=r;let c=s/o.sampleRate;m.gain.setValueAtTime(0,c),m=i_(o,{...h,gain:0}),f=sS(o,{...u,orientationX:d[0],orientationY:d[1],orientationZ:d[2],positionX:p[0],positionY:p[1],positionZ:p[2]}),m.gain.setValueAtTime(1,c),l.connect(m).connect(f.inputs[0]),f.connect(a)}}return a}return c?(await i5(o,r.orientationX,l.orientationX),await i5(o,r.orientationY,l.orientationY),await i5(o,r.orientationZ,l.orientationZ),await i5(o,r.positionX,l.positionX),await i5(o,r.positionY,l.positionY),await i5(o,r.positionZ,l.positionZ)):(await i9(o,r.orientationX,l.orientationX),await i9(o,r.orientationY,l.orientationY),await i9(o,r.orientationZ,l.orientationZ),await i9(o,r.positionX,l.positionX),await i9(o,r.positionY,l.positionY),await i9(o,r.positionZ,l.positionZ)),nt(l)?await ij(r,o,l.inputs[0]):await ij(r,o,l),l})(r,o)}}},class extends ty{constructor(i,s){let r=iB(i),o=sS(r,{...iw,...s}),a=iU(r);super(i,!1,o,a?tb():null),this._nativePannerNode=o,this._orientationX=st(this,a,o.orientationX,34028234663852886e22,-34028234663852886e22),this._orientationY=st(this,a,o.orientationY,34028234663852886e22,-34028234663852886e22),this._orientationZ=st(this,a,o.orientationZ,34028234663852886e22,-34028234663852886e22),this._positionX=st(this,a,o.positionX,34028234663852886e22,-34028234663852886e22),this._positionY=st(this,a,o.positionY,34028234663852886e22,-34028234663852886e22),this._positionZ=st(this,a,o.positionZ,34028234663852886e22,-34028234663852886e22),si(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(i){this._nativePannerNode.coneInnerAngle=i}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(i){this._nativePannerNode.coneOuterAngle=i}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(i){this._nativePannerNode.coneOuterGain=i}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(i){this._nativePannerNode.distanceModel=i}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(i){this._nativePannerNode.maxDistance=i}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(i){this._nativePannerNode.panningModel=i}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(i){this._nativePannerNode.refDistance=i}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(i){this._nativePannerNode.rolloffFactor=i}}),sk=(tT=(i,{disableNormalization:s,imag:r,real:o})=>{let a=r instanceof Float32Array?r:new Float32Array(r),l=o instanceof Float32Array?o:new Float32Array(o),h=i.createPeriodicWave(l,a,{disableNormalization:s});if(Array.from(r).length<2)throw eU();return h},tw=new WeakSet,tx=i=>{let{imag:s,real:r}=i;return void 0===s?void 0===r?{...i,imag:[0,0],real:[0,0]}:{...i,imag:Array.from(r,()=>0),real:r}:void 0===r?{...i,imag:s,real:Array.from(s,()=>0)}:{...i,imag:s,real:r}},class i{constructor(i,s){let r=tT(iB(i),tx({...ix,...s}));return tw.add(r),r}static[Symbol.hasInstance](s){return null!==s&&"object"==typeof s&&Object.getPrototypeOf(s)===i.prototype||tw.has(s)}}),sO=(tC=((i,s,r,o,a,l)=>{let h=new Float32Array([1,1]),u=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},d={...c,oversample:"none"},p=(i,l,p,m,f)=>{if(1===l)return((i,s,a,l)=>{let p=new Float32Array(16385),m=new Float32Array(16385);for(let i=0;i<16385;i+=1){let s=i/16384*u;p[i]=Math.cos(s),m[i]=Math.sin(s)}let f=r(i,{...c,gain:0}),_=o(i,{...d,curve:p}),g=o(i,{...d,curve:h}),v=r(i,{...c,gain:0}),y=o(i,{...d,curve:m});return{connectGraph(){s.connect(f),s.connect(void 0===g.inputs?g:g.inputs[0]),s.connect(v),g.connect(a),a.connect(void 0===_.inputs?_:_.inputs[0]),a.connect(void 0===y.inputs?y:y.inputs[0]),_.connect(f.gain),y.connect(v.gain),f.connect(l,0,0),v.connect(l,0,1)},disconnectGraph(){s.disconnect(f),s.disconnect(void 0===g.inputs?g:g.inputs[0]),s.disconnect(v),g.disconnect(a),a.disconnect(void 0===_.inputs?_:_.inputs[0]),a.disconnect(void 0===y.inputs?y:y.inputs[0]),_.disconnect(f.gain),y.disconnect(v.gain),f.disconnect(l,0,0),v.disconnect(l,0,1)}}})(i,p,m,f);if(2===l)return((i,a,l,p)=>{let m=new Float32Array(16385),f=new Float32Array(16385),_=new Float32Array(16385),g=new Float32Array(16385),v=Math.floor(8192.5);for(let i=0;i<16385;i+=1)if(i>v){let s=(i-v)/(16384-v)*u;m[i]=Math.cos(s),f[i]=Math.sin(s),_[i]=0,g[i]=1}else{let s=i/(16384-v)*u;m[i]=1,f[i]=0,_[i]=Math.cos(s),g[i]=Math.sin(s)}let y=s(i,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),b=r(i,{...c,gain:0}),T=o(i,{...d,curve:m}),w=r(i,{...c,gain:0}),x=o(i,{...d,curve:f}),C=o(i,{...d,curve:h}),S=r(i,{...c,gain:0}),A=o(i,{...d,curve:_}),k=r(i,{...c,gain:0}),O=o(i,{...d,curve:g});return{connectGraph(){a.connect(y),a.connect(void 0===C.inputs?C:C.inputs[0]),y.connect(b,0),y.connect(w,0),y.connect(S,1),y.connect(k,1),C.connect(l),l.connect(void 0===T.inputs?T:T.inputs[0]),l.connect(void 0===x.inputs?x:x.inputs[0]),l.connect(void 0===A.inputs?A:A.inputs[0]),l.connect(void 0===O.inputs?O:O.inputs[0]),T.connect(b.gain),x.connect(w.gain),A.connect(S.gain),O.connect(k.gain),b.connect(p,0,0),S.connect(p,0,0),w.connect(p,0,1),k.connect(p,0,1)},disconnectGraph(){a.disconnect(y),a.disconnect(void 0===C.inputs?C:C.inputs[0]),y.disconnect(b,0),y.disconnect(w,0),y.disconnect(S,1),y.disconnect(k,1),C.disconnect(l),l.disconnect(void 0===T.inputs?T:T.inputs[0]),l.disconnect(void 0===x.inputs?x:x.inputs[0]),l.disconnect(void 0===A.inputs?A:A.inputs[0]),l.disconnect(void 0===O.inputs?O:O.inputs[0]),T.disconnect(b.gain),x.disconnect(w.gain),A.disconnect(S.gain),O.disconnect(k.gain),b.disconnect(p,0,0),S.disconnect(p,0,0),w.disconnect(p,0,1),k.disconnect(p,0,1)}}})(i,p,m,f);throw a()};return(s,{channelCount:o,channelCountMode:h,pan:u,...c})=>{if("max"===h)throw a();let d=i(s,{...c,channelCount:1,channelCountMode:h,numberOfInputs:2}),m=r(s,{...c,channelCount:o,channelCountMode:h,gain:1}),f=r(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:u}),{connectGraph:_,disconnectGraph:g}=p(s,o,m,f,d);Object.defineProperty(f.gain,"defaultValue",{get:()=>0}),Object.defineProperty(f.gain,"maxValue",{get:()=>1}),Object.defineProperty(f.gain,"minValue",{get:()=>-1});let v=!1;return l(ip({get bufferSize(){},get channelCount(){return m.channelCount},set channelCount(n){m.channelCount!==n&&(v&&g(),{connectGraph:_,disconnectGraph:g}=p(s,n,m,f,d),v&&_()),m.channelCount=n},get channelCountMode(){return m.channelCountMode},set channelCountMode(n){if("clamped-max"===n||"max"===n)throw a();m.channelCountMode=n},get channelInterpretation(){return m.channelInterpretation},set channelInterpretation(n){m.channelInterpretation=n},get context(){return m.context},get inputs(){return[m]},get numberOfInputs(){return m.numberOfInputs},get numberOfOutputs(){return m.numberOfOutputs},get pan(){return f.gain},addEventListener:(...i)=>m.addEventListener(i[0],i[1],i[2]),dispatchEvent:(...i)=>m.dispatchEvent(i[0]),removeEventListener:(...i)=>m.removeEventListener(i[0],i[1],i[2])},d),()=>{_(),v=!0},()=>{g(),v=!1})}})(so,id,i_,sC,iy,sr),(i,s)=>{let r=s.channelCountMode;if("clamped-max"===r)throw iy();if(void 0===i.createStereoPanner)return tC(i,s);let o=i.createStereoPanner();return n5(o,s),it(o,s,"pan"),Object.defineProperty(o,"channelCountMode",{get:()=>r,set:i=>{if(i!==r)throw iy()}}),o}),sM=(tS=iJ,tA=()=>{let i=new WeakMap;return{render(s,r){let o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=na(s),a=eB(o,r);return a||(o=sO(r,{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,pan:o.pan.value})),i.set(r,o),a?await i5(r,s.pan,o.pan):await i9(r,s.pan,o.pan),nt(o)?await ij(s,r,o.inputs[0]):await ij(s,r,o),o})(s,r)}}},class extends tS{constructor(i,s){let r=iB(i),o=sO(r,{...iC,...s}),a=iU(r);super(i,!1,o,a?tA():null),this._pan=st(this,a,o.pan)}get pan(){return this._pan}}),sE=(tk=iJ,tO=()=>{let i=new WeakMap;return{render(s,r){let o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=na(s);return eB(o,r)||(o=sC(r,{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,curve:o.curve,oversample:o.oversample})),i.set(r,o),nt(o)?await ij(s,r,o.inputs[0]):await ij(s,r,o),o})(s,r)}}},class extends tk{constructor(i,s){let r=iB(i),o=sC(r,{...iS,...s});super(i,!0,o,iU(r)?tO():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=o,si(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(i){if(null===i)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(i.length<2)throw nK();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=i}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(i){this._nativeWaveShaperNode.oversample=i}}),sI=null!==iq&&iq.isSecureContext,sD=(i,s,r)=>{Object.defineProperties(iq,{currentFrame:{configurable:!0,get:()=>Math.round(i*s)},currentTime:{configurable:!0,get:()=>i}});try{return r()}finally{null!==iq&&(delete iq.currentFrame,delete iq.currentTime)}},sR=new WeakMap,sP=sI?(s=i=>new Promise((s,r)=>{if(null===iq)return void r(SyntaxError());let o=iq.document.head;if(null===o)r(SyntaxError());else{let a=iq.document.createElement("script"),l=new Blob([i],{type:"application/javascript"}),h=URL.createObjectURL(l),u=iq.onerror,c=()=>{iq.onerror=u,URL.revokeObjectURL(h)};iq.onerror=(i,s,o,a,l)=>s===h||s===iq.location.href&&1===o&&1===a?(c(),r(l),!1):null!==u?u(i,s,o,a,l):void 0,a.onerror=()=>{c(),r(SyntaxError())},a.onload=()=>{c(),s()},a.src=h,a.type="module",o.appendChild(a)}}),tM=()=>new DOMException("","AbortError"),r=async i=>{try{let s=await fetch(i);if(s.ok)return[await s.text(),s.url]}catch{}throw tM()},o=i=>{let s=sR.get(i);if(void 0!==s)return s;if(null===iW)throw Error("Missing the native OfflineAudioContext constructor.");return s=new iW(1,1,44100),sR.set(i,s),s},a=new WeakMap,l=new WeakMap,h=async()=>{if(null===iH)return!0;if(null===iW)return!1;let i=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new iW(1,128,44100),r=URL.createObjectURL(i),o=!1,a=!1;try{await s.audioWorklet.addModule(r);let i=new iH(s,"a",{numberOfOutputs:0}),l=s.createOscillator();i.port.onmessage=()=>o=!0,i.onprocessorerror=()=>a=!0,l.connect(i),l.start(0),await s.startRendering(),await new Promise(i=>setTimeout(i))}catch{}finally{URL.revokeObjectURL(r)}return o&&!a},tE=0,(i,u,c={credentials:"omit"})=>{let d=l.get(i);if(void 0!==d&&d.has(u))return Promise.resolve();let p=a.get(i);if(void 0!==p){let i=p.get(u);if(void 0!==i)return i}let m=iB(i),f=void 0===m.audioWorklet?r(u).then(([i,r])=>{let[o,a]=eM(i,r);return s(`${o};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${a}
})})(window,'_AWGS')`)}).then(()=>{let i=iq._AWGS.pop();if(void 0===i)throw SyntaxError();sD(m.currentTime,m.sampleRate,()=>i(class{},void 0,(i,s)=>{if(""===i.trim())throw iy();let r=eC.get(m);if(void 0!==r){if(r.has(i))throw iy();eI(s),eE(s.parameterDescriptors),r.set(i,s)}else eI(s),eE(s.parameterDescriptors),eC.set(m,new Map([[i,s]]))},m.sampleRate,void 0,void 0))}):Promise.all([r(u),Promise.resolve(iV(h,h))]).then(([[i,s],r])=>{let a=tE+1;tE=a;let[l,h]=eM(i,s),u=new Blob([`${l};((AudioWorkletProcessor,registerProcessor)=>{${h}
})(${r?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${r?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${r?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${a}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),d=URL.createObjectURL(u);return m.audioWorklet.addModule(d,c).then(()=>{if(iU(m))return m;let i=o(m);return i.audioWorklet.addModule(d,c).then(()=>i)}).then(i=>{if(null===iH)throw SyntaxError();try{new iH(i,`__sac${a}`)}catch{throw SyntaxError()}}).finally(()=>URL.revokeObjectURL(d))});return void 0===p?a.set(i,new Map([[u,f]])):p.set(u,f),f.then(()=>{let s=l.get(i);void 0===s?l.set(i,new Set([u])):s.add(u)}).finally(()=>{let s=a.get(i);void 0!==s&&s.delete(u)}),f}):void 0,sN=(tI=()=>new DOMException("","DataCloneError"),tD=()=>new DOMException("","EncodingError"),tR=new WeakSet,tP=i=>iY(i)||iU(i),(i,s)=>{let r=tP(i)?i:iB(i);if(tR.has(s))return Promise.reject(tI());try{tR.add(s)}catch{}return iV(n4,()=>n4(r))?r.decodeAudioData(s).then(i=>(nY(s).catch(()=>{}),iV(eW,()=>eW(i))||i3(i),iK.add(i),i)):new Promise((i,o)=>{let a=async()=>{try{await nY(s)}catch{}},l=i=>{o(i),a()};try{r.decodeAudioData(s,s=>{"function"!=typeof s.copyFromChannel&&(i2(s),ez(s)),iK.add(s),a().then(()=>i(s))},i=>{l(null===i?tD():i)})}catch(i){l(i)}})}),sV=(tN=sb,class extends tN{constructor(i,s){super(i,s),this._nativeContext=i,this._audioWorklet=void 0===sP?void 0:{addModule:(i,s)=>sP(this,i,s)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new iQ(this)}createBiquadFilter(){return new ss(this)}createBuffer(i,s,r){return new i8({length:s,numberOfChannels:i,sampleRate:r})}createBufferSource(){return new se(this)}createChannelMerger(i=6){return new sa(this,{numberOfInputs:i})}createChannelSplitter(i=6){return new sl(this,{numberOfOutputs:i})}createConstantSource(){return new su(this)}createConvolver(){return new sd(this)}createDelay(i=1){return new sp(this,{maxDelayTime:i})}createDynamicsCompressor(){return new sf(this)}createGain(){return new s_(this)}createIIRFilter(i,s){return new sv(this,{feedback:s,feedforward:i})}createOscillator(){return new sw(this)}createPanner(){return new sA(this)}createPeriodicWave(i,s,r={disableNormalization:!1}){return new sk(this,{...r,imag:s,real:i})}createStereoPanner(){return new sM(this)}createWaveShaper(){return new sE(this)}decodeAudioData(i,s,r){return sN(this._nativeContext,i).then(i=>("function"==typeof s&&s(i),i),i=>{throw"function"==typeof r&&r(i),i})}}),sq=(tV=iJ,tq=(i,s)=>i.createMediaElementSource(s.mediaElement),class extends tV{constructor(i,s){let r=iB(i),o=tq(r,s);if(iU(r))throw TypeError();super(i,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}}),sL=(tL=iJ,tF=(i,s)=>{let r=i.createMediaStreamDestination();return n5(r,s),1===r.numberOfOutputs&&Object.defineProperty(r,"numberOfOutputs",{get:()=>0}),r},class extends tL{constructor(i,s){let r=iB(i);if(iU(r))throw TypeError();let o=tF(r,{...n8,...s});super(i,!1,o,null),this._nativeMediaStreamAudioDestinationNode=o}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}}),sF=(tj=iJ,tB=(i,{mediaStream:s})=>{let r=s.getAudioTracks();r.sort((i,s)=>i.id<s.id?-1:i.id>s.id?1:0);let o=r.slice(0,1),a=i.createMediaStreamSource(new MediaStream(o));return Object.defineProperty(a,"mediaStream",{value:s}),a},class extends tj{constructor(i,s){let r=iB(i),o=tB(r,s);if(iU(r))throw TypeError();super(i,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}}),sj=(tW=iJ,tU=(i,{mediaStreamTrack:s})=>{if("function"==typeof i.createMediaStreamTrackSource)return i.createMediaStreamTrackSource(s);let r=new MediaStream([s]),o=i.createMediaStreamSource(r);if("audio"!==s.kind)throw nK();if(iU(i))throw TypeError();return o},class extends tW{constructor(i,s){super(i,!0,tU(iB(i),s),null)}}),sB=(tz=sV,tG=()=>new DOMException("","UnknownError"),class extends tz{constructor(i={}){let s;if(null===iX)throw Error("Missing the native AudioContext constructor.");try{s=new iX(i)}catch(i){if(12===i.code&&"sampleRate is not in range"===i.message)throw iy();throw i}if(null===s)throw tG();if(!e8(i.latencyHint))throw TypeError(`The provided value '${i.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==i.sampleRate&&s.sampleRate!==i.sampleRate)throw iy();super(s,2);let{latencyHint:r}=i,{sampleRate:o}=s;if(this._baseLatency="number"==typeof s.baseLatency?s.baseLatency:"balanced"===r?512/o:"interactive"===r||void 0===r?256/o:"playback"===r?1024/o:128*Math.max(2,Math.min(128,Math.round(r*o/128)))/o,this._nativeAudioContext=s,"webkitAudioContext"===iX.name?(this._nativeGainNode=s.createGain(),this._nativeOscillatorNode=s.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(s.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===s.state){this._state="suspended";let i=()=>{"suspended"===this._state&&(this._state=null),s.removeEventListener("statechange",i)};s.addEventListener("statechange",i)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then(()=>{throw nK()}):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then(()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),e3(this)}))}createMediaElementSource(i){return new sq(this,{mediaElement:i})}createMediaStreamDestination(){return new sL(this)}createMediaStreamSource(i){return new sF(this,{mediaStream:i})}createMediaStreamTrackSource(i){return new sj(this,{mediaStreamTrack:i})}resume(){return"suspended"===this._state?new Promise((i,s)=>{let r=()=>{this._nativeAudioContext.removeEventListener("statechange",r),"running"===this._nativeAudioContext.state?i():this.resume().then(i,s)};this._nativeAudioContext.addEventListener("statechange",r)}):this._nativeAudioContext.resume().catch(i=>{if(void 0===i||15===i.code)throw nK();throw i})}suspend(){return this._nativeAudioContext.suspend().catch(i=>{if(void 0===i)throw nK();throw i})}}),sW=i=>{let s=sy.get(i);if(void 0===s)throw Error("The context has no set of AudioWorkletNodes.");return s},sU=(i,s,r=0,o=0)=>{let a=i[r];if(void 0===a)throw eU();return np(s)?a.connect(s,0,o):a.connect(s,0)},sz=(i,s,r,o=0)=>void 0===s?i.forEach(i=>i.disconnect()):"number"==typeof s?nH(eU,i,s).disconnect():np(s)?void 0===r?i.forEach(i=>i.disconnect(s)):void 0===o?nH(eU,i,r).disconnect(s,0):nH(eU,i,r).disconnect(s,0,o):void 0===r?i.forEach(i=>i.disconnect(s)):nH(eU,i,r).disconnect(s,0),sG=new WeakMap,sX=(tX=i=>eD(sG,i),tY=(i,s,r,o)=>{var a,l;if(0===o.numberOfInputs&&0===o.numberOfOutputs)throw iy();let h=Array.isArray(o.outputChannelCount)?o.outputChannelCount:Array.from(o.outputChannelCount);if(h.some(i=>i<1))throw iy();if(h.length!==o.numberOfOutputs)throw eU();if("explicit"!==o.channelCountMode)throw iy();let u=o.channelCount*o.numberOfInputs,c=h.reduce((i,s)=>i+s,0),d=void 0===r.parameterDescriptors?0:r.parameterDescriptors.length;if(u+d>6||c>6)throw iy();let p=new MessageChannel,m=[],f=[];for(let s=0;s<o.numberOfInputs;s+=1)m.push(i_(i,{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,gain:1})),f.push(id(i,{channelCount:o.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:o.channelCount}));let _=[];if(void 0!==r.parameterDescriptors)for(let{defaultValue:s,maxValue:a,minValue:l,name:h}of r.parameterDescriptors){let r=sh(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==o.parameterData[h]?o.parameterData[h]:void 0===s?0:s});Object.defineProperties(r.offset,{defaultValue:{get:()=>void 0===s?0:s},maxValue:{get:()=>void 0===a?34028234663852886e22:a},minValue:{get:()=>void 0===l?-34028234663852886e22:l}}),_.push(r)}let g=so(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,u+d)}),v=io(s,i.sampleRate),y=iv(i,v,u+d,Math.max(1,c)),b=id(i,{channelCount:Math.max(1,c),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,c)}),T=[];for(let s=0;s<o.numberOfOutputs;s+=1)T.push(so(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:h[s]}));for(let i=0;i<o.numberOfInputs;i+=1){m[i].connect(f[i]);for(let s=0;s<o.channelCount;s+=1)f[i].connect(g,s,i*o.channelCount+s)}let w=new nV(void 0===r.parameterDescriptors?[]:r.parameterDescriptors.map(({name:i},s)=>{let r=_[s];return r.connect(g,0,u+s),r.start(0),[i,r.offset]}));g.connect(y);let x=o.channelInterpretation,C=null,S=0===o.numberOfOutputs?[y]:T,A={get bufferSize(){return v},get channelCount(){return o.channelCount},set channelCount(e){throw nK()},get channelCountMode(){return o.channelCountMode},set channelCountMode(e){throw nK()},get channelInterpretation(){return x},set channelInterpretation(e){for(let i of m)i.channelInterpretation=e;x=e},get context(){return y.context},get inputs(){return m},get numberOfInputs(){return o.numberOfInputs},get numberOfOutputs(){return o.numberOfOutputs},get onprocessorerror(){return C},set onprocessorerror(e){"function"==typeof C&&A.removeEventListener("processorerror",C),"function"==typeof(C="function"==typeof e?e:null)&&A.addEventListener("processorerror",C)},get parameters(){return w},get port(){return p.port2},addEventListener:(...i)=>y.addEventListener(i[0],i[1],i[2]),connect:sU.bind(null,S),disconnect:sz.bind(null,S),dispatchEvent:(...i)=>y.dispatchEvent(i[0]),removeEventListener:(...i)=>y.removeEventListener(i[0],i[1],i[2])},k=new Map;p.port1.addEventListener=(a=p.port1.addEventListener,(...s)=>{if("message"===s[0]){let r="function"==typeof s[1]?s[1]:"object"==typeof s[1]&&null!==s[1]&&"function"==typeof s[1].handleEvent?s[1].handleEvent:null;if(null!==r){let o=k.get(s[1]);void 0!==o?s[1]=o:(s[1]=s=>{sD(i.currentTime,i.sampleRate,()=>r(s))},k.set(r,s[1]))}}return a.call(p.port1,s[0],s[1],s[2])}),p.port1.removeEventListener=(l=p.port1.removeEventListener,(...i)=>{if("message"===i[0]){let s=k.get(i[1]);void 0!==s&&(k.delete(i[1]),i[1]=s)}return l.call(p.port1,i[0],i[1],i[2])});let O=null;Object.defineProperty(p.port1,"onmessage",{get:()=>O,set:i=>{"function"==typeof O&&p.port1.removeEventListener("message",O),"function"==typeof(O="function"==typeof i?i:null)&&(p.port1.addEventListener("message",O),p.port1.start())}}),r.prototype.port=p.port1;let M=null;ih(i,A,r,o).then(i=>M=i);let E=nj(o.numberOfInputs,o.channelCount),I=nj(o.numberOfOutputs,h),D=void 0===r.parameterDescriptors?[]:r.parameterDescriptors.reduce((i,{name:s})=>({...i,[s]:new Float32Array(128)}),{}),R=!0,P=()=>{o.numberOfOutputs>0&&y.disconnect(b);for(let i=0,s=0;i<o.numberOfOutputs;i+=1){let r=T[i];for(let o=0;o<h[i];o+=1)b.disconnect(r,s+o,o);s+=h[i]}},N=new Map;y.onaudioprocess=({inputBuffer:s,outputBuffer:a})=>{if(null!==M){let l=tX(A);for(let c=0;c<v;c+=128){for(let i=0;i<o.numberOfInputs;i+=1)for(let r=0;r<o.channelCount;r+=1)nL(s,E[i],r,r,c);void 0!==r.parameterDescriptors&&r.parameterDescriptors.forEach(({name:i},r)=>{nL(s,D,i,u+r,c)});for(let i=0;i<o.numberOfInputs;i+=1)for(let s=0;s<h[i];s+=1)0===I[i][s].byteLength&&(I[i][s]=new Float32Array(128));try{let s=E.map((i,s)=>{if(l[s].size>0)return N.set(s,v/128),i;let r=N.get(s);return void 0===r?[]:(i.every(i=>i.every(i=>0===i))&&(1===r?N.delete(s):N.set(s,r-1)),i)});R=sD(i.currentTime+c/i.sampleRate,i.sampleRate,()=>M.process(s,I,D));for(let i=0,s=0;i<o.numberOfOutputs;i+=1){for(let r=0;r<h[i];r+=1)nF(a,I[i],r,s+r,c);s+=h[i]}}catch(i){R=!1,A.dispatchEvent(new ErrorEvent("processorerror",{colno:i.colno,filename:i.filename,lineno:i.lineno,message:i.message}))}if(!R){for(let i=0;i<o.numberOfInputs;i+=1){m[i].disconnect(f[i]);for(let s=0;s<o.channelCount;s+=1)f[c].disconnect(g,s,i*o.channelCount+s)}if(void 0!==r.parameterDescriptors){let i=r.parameterDescriptors.length;for(let s=0;s<i;s+=1){let i=_[s];i.disconnect(g,0,u+s),i.stop()}}g.disconnect(y),y.onaudioprocess=null,V?P():F();break}}}};let V=!1,q=i_(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),L=()=>y.connect(q).connect(i.destination),F=()=>{y.disconnect(q),q.disconnect()};return L(),sr(A,()=>{if(R){F(),o.numberOfOutputs>0&&y.connect(b);for(let i=0,s=0;i<o.numberOfOutputs;i+=1){let r=T[i];for(let o=0;o<h[i];o+=1)b.connect(r,s+o,o);s+=h[i]}}V=!0},()=>{R&&(L(),P()),V=!1})},(i,s,r,o,a,l)=>{var h,u;if(null!==r)try{let s=new r(i,o,l),a=new Map,c=null;if(Object.defineProperties(s,{channelCount:{get:()=>l.channelCount,set:()=>{throw nK()}},channelCountMode:{get:()=>"explicit",set:()=>{throw nK()}},onprocessorerror:{get:()=>c,set:i=>{"function"==typeof c&&s.removeEventListener("processorerror",c),c="function"==typeof i?i:null,"function"==typeof c&&s.addEventListener("processorerror",c)}}}),s.addEventListener=(u=s.addEventListener,(...i)=>{if("processorerror"===i[0]){let s="function"==typeof i[1]?i[1]:"object"==typeof i[1]&&null!==i[1]&&"function"==typeof i[1].handleEvent?i[1].handleEvent:null;if(null!==s){let r=a.get(i[1]);void 0!==r?i[1]=r:(i[1]=r=>{"error"===r.type?(Object.defineProperties(r,{type:{value:"processorerror"}}),s(r)):s(new ErrorEvent(i[0],{...r}))},a.set(s,i[1]))}}return u.call(s,"error",i[1],i[2]),u.call(s,...i)}),s.removeEventListener=(h=s.removeEventListener,(...i)=>{if("processorerror"===i[0]){let s=a.get(i[1]);void 0!==s&&(a.delete(i[1]),i[1]=s)}return h.call(s,"error",i[1],i[2]),h.call(s,i[0],i[1],i[2])}),0!==l.numberOfOutputs){let r=i_(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return s.connect(r).connect(i.destination),sr(s,()=>r.disconnect(),()=>r.connect(i.destination))}return s}catch(i){if(11===i.code)throw iy();throw i}if(void 0===a)throw iy();return ir(l),tY(i,s,a,l)}),sY=(tZ=(i,s)=>{sW(i).delete(s)},(i,s,r)=>{let o=new WeakMap,a=null,l=async(l,h)=>{let u=na(l),c=null,d=eB(u,h),p=Array.isArray(s.outputChannelCount)?s.outputChannelCount:Array.from(s.outputChannelCount);if(null===iH){let i=p.reduce((i,s)=>i+s,0),r=id(h,{channelCount:Math.max(1,i),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,i)}),o=[];for(let i=0;i<l.numberOfOutputs;i+=1)o.push(so(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:p[i]}));let a=i_(h,{channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});a.connect=sU.bind(null,o),a.disconnect=sz.bind(null,o),c=[r,o,a]}else d||(u=new iH(h,i));if(o.set(h,null===c?u:c[2]),null!==c){if(null===a){if(void 0===r)throw Error("Missing the processor constructor.");if(null===iW)throw Error("Missing the native OfflineAudioContext constructor.");let i=l.channelCount*l.numberOfInputs,o=void 0===r.parameterDescriptors?0:r.parameterDescriptors.length,u=i+o,c=async()=>{let r=new iW(u,128*Math.ceil(l.context.length/128),h.sampleRate),a=[],c=[];for(let i=0;i<s.numberOfInputs;i+=1)a.push(i_(r,{channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1})),c.push(id(r,{channelCount:s.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:s.channelCount}));let d=await Promise.all(Array.from(l.parameters.values()).map(async i=>{let s=sh(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:i.value});return await i9(r,i,s.offset),s})),p=so(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,i+o)});for(let i=0;i<s.numberOfInputs;i+=1){a[i].connect(c[i]);for(let r=0;r<s.channelCount;r+=1)c[i].connect(p,r,i*s.channelCount+r)}for(let[s,r]of d.entries())r.connect(p,0,i+s),r.start(0);return p.connect(r.destination),await Promise.all(a.map(i=>ij(l,r,i))),sg(r)};a=(async(i,s,r,o,a,l,h)=>{let u=null===s?128*Math.ceil(i.context.length/128):s.length,c=o.channelCount*o.numberOfInputs,d=a.reduce((i,s)=>i+s,0),p=0===d?null:r.createBuffer(d,u,r.sampleRate);if(void 0===l)throw Error("Missing the processor constructor.");let m=e0(i),f=await nB(r,i),_=nj(o.numberOfInputs,o.channelCount),g=nj(o.numberOfOutputs,a),v=Array.from(i.parameters.keys()).reduce((i,s)=>({...i,[s]:new Float32Array(128)}),{});for(let d=0;d<u;d+=128){if(o.numberOfInputs>0&&null!==s)for(let i=0;i<o.numberOfInputs;i+=1)for(let r=0;r<o.channelCount;r+=1)nL(s,_[i],r,r,d);void 0!==l.parameterDescriptors&&null!==s&&l.parameterDescriptors.forEach(({name:i},r)=>{nL(s,v,i,c+r,d)});for(let i=0;i<o.numberOfInputs;i+=1)for(let s=0;s<a[i];s+=1)0===g[i][s].byteLength&&(g[i][s]=new Float32Array(128));try{let i=_.map((i,s)=>0===m.activeInputs[s].size?[]:i),s=h(d/r.sampleRate,r.sampleRate,()=>f.process(i,g,v));if(null!==p)for(let i=0,s=0;i<o.numberOfOutputs;i+=1){for(let r=0;r<a[i];r+=1)nF(p,g[i],r,s+r,d);s+=a[i]}if(!s)break}catch(s){i.dispatchEvent(new ErrorEvent("processorerror",{colno:s.colno,filename:s.filename,lineno:s.lineno,message:s.message}));break}}return p})(l,0===u?null:await c(),h,s,p,r,sD)}let i=await a,o=i7(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[u,d,m]=c;null!==i&&(o.buffer=i,o.start(0)),o.connect(u);for(let i=0,s=0;i<l.numberOfOutputs;i+=1){let r=d[i];for(let o=0;o<p[i];o+=1)u.connect(r,s+o,o);s+=p[i]}return m}if(d)for(let[i,s]of l.parameters.entries())await i5(h,s,u.parameters.get(i));else for(let[i,s]of l.parameters.entries())await i9(h,s,u.parameters.get(i));return await ij(l,h,u),u};return{render(i,s){tZ(s,i);let r=o.get(s);return void 0!==r?Promise.resolve(r):l(i,s)}}}),sZ=sI?(t$=(i,s)=>{sW(i).add(s)},tH=iJ,tJ=i=>sR.get(i),tQ=i=>({...i,outputChannelCount:void 0!==i.outputChannelCount?i.outputChannelCount:1===i.numberOfInputs&&1===i.numberOfOutputs?[i.channelCount]:Array.from({length:i.numberOfOutputs},()=>1)}),tK=(i,s)=>{sG.set(i,s)},t0=i=>{let{port1:s,port2:r}=new MessageChannel;try{s.postMessage(i)}finally{s.close(),r.close()}},class extends tH{constructor(i,s,r){var o;let a=iB(i),l=iU(a),h=tQ({...nq,...r});t0(h);let u=eC.get(a),c=null==u?void 0:u.get(s),d=sX(l||"closed"!==a.state?a:null!==(o=tJ(a))&&void 0!==o?o:a,l?null:i.baseLatency,iH,s,c,h);super(i,!0,d,l?sY(s,h,c):null);let p=[];d.parameters.forEach((i,s)=>{let r=st(this,l,i);p.push([s,r])}),this._nativeAudioWorkletNode=d,this._onprocessorerror=null,this._parameters=new nV(p),l&&t$(a,this);let{activeInputs:m}=e0(this);tK(d,m)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(i){let s="function"==typeof i?iP(this,i):null;this._nativeAudioWorkletNode.onprocessorerror=s;let r=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==r&&r===s?i:r}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}}):void 0,s$=(t1=sV,t2=(i,s,r)=>{if(null===iW)throw Error("Missing the native OfflineAudioContext constructor.");try{return new iW(i,s,r)}catch(i){if("SyntaxError"===i.name)throw iy();throw i}},t3=(i,s)=>iF(i).render(i,s).then(()=>Promise.all(Array.from(sW(s)).map(i=>iF(i).render(i,s)))).then(()=>sg(s)).then(i=>("function"!=typeof i.copyFromChannel?(i2(i),ez(i)):iV(eW,()=>eW(i))||i3(i),iK.add(i),i)),class extends t1{constructor(i,s,r){let o;if("number"==typeof i&&void 0!==s&&void 0!==r)o={length:s,numberOfChannels:i,sampleRate:r};else{if("object"!=typeof i)throw Error("The given parameters are not valid.");o=i}let{length:a,numberOfChannels:l,sampleRate:h}={...ib,...o},u=t2(l,a,h);iV(n4,()=>n4(u))||u.addEventListener("statechange",(()=>{let i=0,s=r=>{"running"===this._state&&(i>0?(u.removeEventListener("statechange",s),r.stopImmediatePropagation(),this._waitForThePromiseToSettle(r)):i+=1)};return s})()),super(u,l),this._length=a,this._nativeOfflineAudioContext=u,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(nK()):(this._state="running",t3(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,e3(this)}))}_waitForThePromiseToSettle(i){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(i):setTimeout(()=>this._waitForThePromiseToSettle(i))}}),sH=i=>iY(eT.get(i))||iY(i),sJ=i=>ev.has(i)||iZ(i),sQ=i=>eb.has(i)||i$(i),sK=i=>iU(eT.get(i))||iU(i);function s0(i){return void 0===i}function s1(i){return void 0!==i}function s2(i){return"number"==typeof i}function s3(i){return"[object Object]"===Object.prototype.toString.call(i)&&i.constructor===Object}function s8(i){return Array.isArray(i)}function s4(i){return"string"==typeof i}function s6(i){return s4(i)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(i)}function s5(i,s){if(!i)throw Error(s)}function s7(i,s,r=1/0){if(!(s<=i&&i<=r))throw RangeError(`Value must be within [${s}, ${r}], got: ${i}`)}function s9(i){i.isOffline||"running"===i.state||ri('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let rt=!1,re=!1,rn=console;function ri(...i){rn.warn(...i)}let rs="object"==typeof self?self:null,rr=rs&&(rs.hasOwnProperty("AudioContext")||rs.hasOwnProperty("webkitAudioContext"));class ro{constructor(i,s,r,o){this._callback=i,this._type=s,this._minimumUpdateInterval=Math.max(128/(o||44100),.001),this.updateInterval=r,this._createClock()}_createWorker(){let i=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),s=new Worker(URL.createObjectURL(i));s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(i){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(i){var s;this._updateInterval=Math.max(i,this._minimumUpdateInterval),"worker"===this._type&&(null===(s=this._worker)||void 0===s||s.postMessage(1e3*this._updateInterval))}get type(){return this._type}set type(i){this._disposeClock(),this._type=i,this._createClock()}dispose(){this._disposeClock()}}function ra(i,...s){if(!s.length)return i;let r=s.shift();if(s3(i)&&s3(r))for(let s in r){var o;(o=r[s],"value"===s||sQ(o)||sJ(o)||o instanceof i8)?i[s]=r[s]:s3(r[s])?(i[s]||Object.assign(i,{[s]:{}}),ra(i[s],r[s])):Object.assign(i,{[s]:r[s]})}return ra(i,...s)}function rl(i,s,r=[],o){let a={},l=Array.from(s);if(s3(l[0])&&o&&!Reflect.has(l[0],o)&&(Object.keys(l[0]).some(s=>Reflect.has(i,s))||(ra(a,{[o]:l[0]}),r.splice(r.indexOf(o),1),l.shift())),1===l.length&&s3(l[0]))ra(a,l[0]);else for(let i=0;i<r.length;i++)s1(l[i])&&(a[r[i]]=l[i]);return ra(i,a)}function rh(i,s){return s0(i)?s:i}function ru(i,s){return s.forEach(s=>{Reflect.has(i,s)&&delete i[s]}),i}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class rc{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...i){(this.debug||rs&&this.toString()===rs.TONE_DEBUG_CLASS)&&function(...i){rn.log(...i)}(this,...i)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}function rd(i,s){return i>s+1e-6}function rp(i,s){return rd(i,s)||rf(i,s)}function rm(i,s){return i+1e-6<s}function rf(i,s){return 1e-6>Math.abs(i-s)}rc.version=ep;class r_ extends rc{constructor(){super(),this.name="Timeline",this._timeline=[];let i=rl(r_.getDefaults(),arguments,["memory"]);this.memory=i.memory,this.increasing=i.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(i){if(s5(Reflect.has(i,"time"),"Timeline: events must have a time attribute"),i.time=i.time.valueOf(),this.increasing&&this.length){let s=this._timeline[this.length-1];s5(rp(i.time,s.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(i)}else{let s=this._search(i.time);this._timeline.splice(s+1,0,i)}if(this.length>this.memory){let i=this.length-this.memory;this._timeline.splice(0,i)}return this}remove(i){let s=this._timeline.indexOf(i);return -1!==s&&this._timeline.splice(s,1),this}get(i,s="time"){let r=this._search(i,s);return -1!==r?this._timeline[r]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(i,s="time"){let r=this._search(i,s);return r+1<this._timeline.length?this._timeline[r+1]:null}getBefore(i){let s=this._timeline.length;if(s>0&&this._timeline[s-1].time<i)return this._timeline[s-1];let r=this._search(i);return r-1>=0?this._timeline[r-1]:null}cancel(i){if(this._timeline.length>1){let s=this._search(i);if(s>=0){if(rf(this._timeline[s].time,i)){for(let r=s;r>=0&&rf(this._timeline[r].time,i);r--)s=r;this._timeline=this._timeline.slice(0,s)}else this._timeline=this._timeline.slice(0,s+1)}else this._timeline=[]}else 1===this._timeline.length&&rp(this._timeline[0].time,i)&&(this._timeline=[]);return this}cancelBefore(i){let s=this._search(i);return s>=0&&(this._timeline=this._timeline.slice(s+1)),this}previousEvent(i){let s=this._timeline.indexOf(i);return s>0?this._timeline[s-1]:null}_search(i,s="time"){if(0===this._timeline.length)return -1;let r=0,o=this._timeline.length,a=o;if(o>0&&this._timeline[o-1][s]<=i)return o-1;for(;r<a;){let o=Math.floor(r+(a-r)/2),l=this._timeline[o],h=this._timeline[o+1];if(rf(l[s],i)){for(let r=o;r<this._timeline.length&&rf(this._timeline[r][s],i);r++)o=r;return o}if(rm(l[s],i)&&rd(h[s],i))return o;rd(l[s],i)?a=o:r=o+1}return -1}_iterate(i,s=0,r=this._timeline.length-1){this._timeline.slice(s,r+1).forEach(i)}forEach(i){return this._iterate(i),this}forEachBefore(i,s){let r=this._search(i);return -1!==r&&this._iterate(s,0,r),this}forEachAfter(i,s){let r=this._search(i);return this._iterate(s,r+1),this}forEachBetween(i,s,r){let o=this._search(i),a=this._search(s);return -1!==o&&-1!==a?(this._timeline[o].time!==i&&(o+=1),this._timeline[a].time===s&&(a-=1),this._iterate(r,o,a)):-1===o&&this._iterate(r,0,a),this}forEachFrom(i,s){let r=this._search(i);for(;r>=0&&this._timeline[r].time>=i;)r--;return this._iterate(s,r+1),this}forEachAtTime(i,s){let r=this._search(i);if(-1!==r&&rf(this._timeline[r].time,i)){let o=r;for(let s=r;s>=0&&rf(this._timeline[s].time,i);s--)o=s;this._iterate(i=>{s(i)},o,r)}return this}dispose(){return super.dispose(),this._timeline=[],this}}let rg=[];function rv(i){rg.push(i)}let ry=[];function rb(i){ry.push(i)}class rT extends rc{constructor(){super(...arguments),this.name="Emitter"}on(i,s){return i.split(/\W+/).forEach(i=>{s0(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(s)}),this}once(i,s){let r=(...o)=>{s(...o),this.off(i,r)};return this.on(i,r),this}off(i,s){return i.split(/\W+/).forEach(i=>{if(s0(this._events)&&(this._events={}),this._events.hasOwnProperty(i)){if(s0(s))this._events[i]=[];else{let r=this._events[i];for(let i=r.length-1;i>=0;i--)r[i]===s&&r.splice(i,1)}}}),this}emit(i,...s){if(this._events&&this._events.hasOwnProperty(i)){let r=this._events[i].slice(0);for(let i=0,o=r.length;i<o;i++)r[i].apply(this,s)}return this}static mixin(i){["on","once","off","emit"].forEach(s=>{let r=Object.getOwnPropertyDescriptor(rT.prototype,s);Object.defineProperty(i.prototype,s,r)})}dispose(){return super.dispose(),this._events=void 0,this}}class rw extends rT{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class rx extends rw{constructor(){var i,s;super(),this.name="Context",this._constants=new Map,this._timeouts=new r_,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;let r=rl(rx.getDefaults(),arguments,["context"]);r.context?(this._context=r.context,this._latencyHint=(null===(i=arguments[0])||void 0===i?void 0:i.latencyHint)||""):(this._context=new sB({latencyHint:r.latencyHint}),this._latencyHint=r.latencyHint),this._ticker=new ro(this.emit.bind(this,"tick"),r.clockSource,r.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[(null===(s=arguments[0])||void 0===s?void 0:s.hasOwnProperty("updateInterval"))?"_lookAhead":"lookAhead"]=r.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var i;return this._initialized||(i=this,rg.forEach(s=>s(i)),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(i,s,r){return this._context.createBuffer(i,s,r)}createChannelMerger(i){return this._context.createChannelMerger(i)}createChannelSplitter(i){return this._context.createChannelSplitter(i)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(i){return this._context.createDelay(i)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(i,s){return this._context.createIIRFilter(i,s)}createPanner(){return this._context.createPanner()}createPeriodicWave(i,s,r){return this._context.createPeriodicWave(i,s,r)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(i){return s5(sH(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(i)}createMediaElementSource(i){return s5(sH(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(i)}createMediaStreamDestination(){return s5(sH(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(i){return this._context.decodeAudioData(i)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(i){s5(!this._initialized,"The listener cannot be set after initialization."),this._listener=i}get transport(){return this.initialize(),this._transport}set transport(i){s5(!this._initialized,"The transport cannot be set after initialization."),this._transport=i}get draw(){return this.initialize(),this._draw}set draw(i){s5(!this._initialized,"Draw cannot be set after initialization."),this._draw=i}get destination(){return this.initialize(),this._destination}set destination(i){s5(!this._initialized,"The destination cannot be set after initialization."),this._destination=i}createAudioWorkletNode(i,s){var r;return r=this.rawContext,s5(s1(sZ),"This node only works in a secure context (https or localhost)"),new sZ(r,i,s)}addAudioWorkletModule(i){return t4(this,void 0,void 0,function*(){s5(s1(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(i)),yield this._workletPromise})}workletsAreReady(){return t4(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(i){this._ticker.updateInterval=i}get clockSource(){return this._ticker.type}set clockSource(i){this._ticker.type=i}get lookAhead(){return this._lookAhead}set lookAhead(i){this._lookAhead=i,this.updateInterval=i?i/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return sH(this._context)?this._context.resume():Promise.resolve()}close(){return t4(this,void 0,void 0,function*(){var i;sH(this._context)&&"closed"!==this.state&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&(i=this,ry.forEach(s=>s(i)))})}getConstant(i){if(this._constants.has(i))return this._constants.get(i);{let s=this._context.createBuffer(1,128,this._context.sampleRate),r=s.getChannelData(0);for(let s=0;s<r.length;s++)r[s]=i;let o=this._context.createBufferSource();return o.channelCount=1,o.channelCountMode="explicit",o.buffer=s,o.loop=!0,o.start(0),this._constants.set(i,o),o}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(i=>this._constants[i].disconnect()),this.close(),this}_timeoutLoop(){let i=this.now(),s=this._timeouts.peek();for(;this._timeouts.length&&s&&s.time<=i;)s.callback(),this._timeouts.shift(),s=this._timeouts.peek()}setTimeout(i,s){this._timeoutIds++;let r=this.now();return this._timeouts.add({callback:i,id:this._timeoutIds,time:r+s}),this._timeoutIds}clearTimeout(i){return this._timeouts.forEach(s=>{s.id===i&&this._timeouts.remove(s)}),this}clearInterval(i){return this.clearTimeout(i)}setInterval(i,s){let r=++this._timeoutIds,o=()=>{let a=this.now();this._timeouts.add({callback:()=>{i(),o()},id:r,time:a+s})};return o(),r}}function rC(i,s){s8(s)?s.forEach(s=>rC(i,s)):Object.defineProperty(i,s,{enumerable:!0,writable:!1})}let rS=()=>{};class rA extends rc{constructor(){super(),this.name="ToneAudioBuffer",this.onload=rS;let i=rl(rA.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=i.reverse,this.onload=i.onload,s4(i.url)?this.load(i.url).catch(i.onerror):i.url&&this.set(i.url)}static getDefaults(){return{onerror:rS,onload:rS,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:rE().sampleRate}set(i){return i instanceof rA?i.loaded?this._buffer=i.get():i.onload=()=>{this.set(i),this.onload(this)}:this._buffer=i,this._reversed&&this._reverse(),this}get(){return this._buffer}load(i){return t4(this,void 0,void 0,function*(){let s=rA.load(i).then(i=>{this.set(i),this.onload(this)});rA.downloads.push(s);try{yield s}finally{let i=rA.downloads.indexOf(s);rA.downloads.splice(i,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(i){let s=s8(i)&&i[0].length>0,r=s?i.length:1,o=s?i[0].length:i.length,a=rE(),l=a.createBuffer(r,o,a.sampleRate),h=s||1!==r?i:[i];for(let i=0;i<r;i++)l.copyToChannel(h[i],i);return this._buffer=l,this}toMono(i){if(s2(i))this.fromArray(this.toArray(i));else{let i=new Float32Array(this.length),s=this.numberOfChannels;for(let r=0;r<s;r++){let s=this.toArray(r);for(let r=0;r<s.length;r++)i[r]+=s[r]}i=i.map(i=>i/s),this.fromArray(i)}return this}toArray(i){if(s2(i))return this.getChannelData(i);if(1===this.numberOfChannels)return this.toArray(0);{let i=[];for(let s=0;s<this.numberOfChannels;s++)i[s]=this.getChannelData(s);return i}}getChannelData(i){return this._buffer?this._buffer.getChannelData(i):new Float32Array(0)}slice(i,s=this.duration){s5(this.loaded,"Buffer is not loaded");let r=Math.floor(i*this.sampleRate),o=Math.floor(s*this.sampleRate);s5(r<o,"The start time must be less than the end time");let a=rE().createBuffer(this.numberOfChannels,o-r,this.sampleRate);for(let i=0;i<this.numberOfChannels;i++)a.copyToChannel(this.getChannelData(i).subarray(r,o),i);return new rA(a)}_reverse(){if(this.loaded)for(let i=0;i<this.numberOfChannels;i++)this.getChannelData(i).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(i){this._reversed!==i&&(this._reversed=i,this._reverse())}static fromArray(i){return(new rA).fromArray(i)}static fromUrl(i){return t4(this,void 0,void 0,function*(){let s=new rA;return yield s.load(i)})}static load(i){return t4(this,void 0,void 0,function*(){let s=i.match(/\[([^\]\[]+\|.+)\]$/);if(s){let r=s[1].split("|"),o=r[0];for(let i of r)if(rA.supportsType(i)){o=i;break}i=i.replace(s[0],o)}let r=""===rA.baseUrl||rA.baseUrl.endsWith("/")?rA.baseUrl:rA.baseUrl+"/",o=document.createElement("a");o.href=r+i,o.pathname=(o.pathname+o.hash).split("/").map(encodeURIComponent).join("/");let a=yield fetch(o.href);if(!a.ok)throw Error(`could not load url: ${i}`);let l=yield a.arrayBuffer();return yield rE().decodeAudioData(l)})}static supportsType(i){let s=i.split("."),r=s[s.length-1];return""!==document.createElement("audio").canPlayType("audio/"+r)}static loaded(){return t4(this,void 0,void 0,function*(){for(yield Promise.resolve();rA.downloads.length;)yield rA.downloads[0]})}}rA.baseUrl="",rA.downloads=[];class rk extends rx{constructor(){var i,s,r,o,a,l;super({clockSource:"offline",context:(i=arguments[0],sK(i))?arguments[0]:(s=arguments[0],r=arguments[1]*arguments[2],o=arguments[2],new s$(s,r,o)),lookAhead:0,updateInterval:(a=arguments[0],sK(a))?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,l=arguments[0],this._duration=sK(l)?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(i){return t4(this,void 0,void 0,function*(){let s=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,s++;let r=Math.floor(this.sampleRate/128);i&&s%r==0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(i=!0){return t4(this,void 0,void 0,function*(){return yield this.workletsAreReady(),yield this._renderClock(i),new rA((yield this._context.startRendering()))})}close(){return Promise.resolve()}}let rO=new class extends rw{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(i,s,r){return{}}createChannelMerger(i){return{}}createChannelSplitter(i){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(i){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(i,s){return{}}createPanner(){return{}}createPeriodicWave(i,s,r){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(i){return{}}createMediaElementSource(i){return{}}createMediaStreamDestination(){return{}}decodeAudioData(i){return Promise.resolve({})}createAudioWorkletNode(i,s){return{}}get rawContext(){return{}}addAudioWorkletModule(i){return t4(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(i,s){return 0}clearTimeout(i){return this}setInterval(i,s){return 0}clearInterval(i){return this}getConstant(i){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(i){}get destination(){return{}}set destination(i){}now(){return 0}immediate(){return 0}},rM=rO;function rE(){return rM===rO&&rr&&rI(new rx),rM}function rI(i,s=!1){s&&rM.dispose(),rM=sH(i)?new rx(i):sK(i)?new rk(i):i}function rD(){return rM.resume()}if(rs&&!rs.TONE_SILENCE_LOGGING){let i=` * Tone.js v${ep} * `;console.log(`%c${i}`,"background: #000; color: #fff")}function rR(i){return Math.pow(2,i/12)}let rP=440;function rN(i){return Math.round(rV(i))}function rV(i){return 69+12*Math.log2(i/rP)}class rq extends rc{constructor(i,s,r){super(),this.defaultUnits="s",this._val=s,this._units=r,this.context=i,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:i=>this._frequencyToUnits(parseFloat(i)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:i=>this._ticksToUnits(parseInt(i,10)),regexp:/^(\d+)i$/i},m:{method:i=>this._beatsToUnits(parseInt(i,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(i,s)=>{let r=parseInt(i,10),o="."===s?1.5:1;return 1===r?this._beatsToUnits(this._getTimeSignature())*o:this._beatsToUnits(4/r)*o},regexp:/^(\d+)n(\.?)$/i},number:{method:i=>this._expressions[this.defaultUnits].method.call(this,i),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:i=>this._secondsToUnits(parseFloat(i)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:i=>parseInt(i,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:i=>{let s=parseInt(i,10);return this._beatsToUnits(8/(3*Math.floor(s)))},regexp:/^(\d+)t$/i},tr:{method:(i,s,r)=>{let o=0;return i&&"0"!==i&&(o+=this._beatsToUnits(this._getTimeSignature()*parseFloat(i))),s&&"0"!==s&&(o+=this._beatsToUnits(parseFloat(s))),r&&"0"!==r&&(o+=this._beatsToUnits(parseFloat(r)/4)),o},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof rq&&this.fromType(this._val),s0(this._val))return this._noArg();if(s4(this._val)&&s0(this._units)){for(let i in this._expressions)if(this._expressions[i].regexp.test(this._val.trim())){this._units=i;break}}else if(s3(this._val)){let i=0;for(let s in this._val)if(s1(this._val[s])){let r=this._val[s];i+=new this.constructor(this.context,s).valueOf()*r}return i}if(s1(this._units)){let i=this._expressions[this._units],s=this._val.toString().trim().match(i.regexp);return s?i.method.apply(this,s.slice(1)):i.method.call(this,this._val)}return s4(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(i){return 1/i}_beatsToUnits(i){return 60/this._getBpm()*i}_secondsToUnits(i){return i}_ticksToUnits(i){return i*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(i){switch(this._units=void 0,this.defaultUnits){case"s":this._val=i.toSeconds();break;case"i":this._val=i.toTicks();break;case"hz":this._val=i.toFrequency();break;case"midi":this._val=i.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class rL extends rq{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:i=>this._now()+new this.constructor(this.context,i).valueOf(),regexp:/^\+(.+)/},quantize:{method:i=>{let s=new rL(this.context,i).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(s))},regexp:/^@(.+)/}})}quantize(i,s=1){let r=new this.constructor(this.context,i).valueOf(),o=this.valueOf();return o+(Math.round(o/r)*r-o)*s}toNotation(){let i=this.toSeconds(),s=["1m"];for(let i=1;i<9;i++){let r=Math.pow(2,i);s.push(r+"n."),s.push(r+"n"),s.push(r+"t")}s.push("0");let r=s[0],o=new rL(this.context,s[0]).toSeconds();return s.forEach(s=>{let a=new rL(this.context,s).toSeconds();Math.abs(a-i)<Math.abs(o-i)&&(r=s,o=a)}),r}toBarsBeatsSixteenths(){let i=this._beatsToUnits(1),s=this.valueOf()/i,r=Math.floor((s=parseFloat(s.toFixed(4)))/this._getTimeSignature()),o=s%1*4;s=Math.floor(s)%this._getTimeSignature();let a=o.toString();return a.length>3&&(o=parseFloat(parseFloat(a).toFixed(3))),[r,s,o].join(":")}toTicks(){let i=this._beatsToUnits(1);return this.valueOf()/i*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return rN(this.toFrequency())}_now(){return this.context.now()}}function rF(i,s){return new rL(rE(),i,s)}class rj extends rL{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return rP}static set A4(i){rP=i}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(i){return"midi"===this.defaultUnits?i:rj.mtof(i)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(i,s){let r=rB[i.toLowerCase()]+12*(parseInt(s,10)+1);return"midi"===this.defaultUnits?r:rj.mtof(r)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(i,s,r){let o=1;return i&&"0"!==i&&(o*=this._beatsToUnits(this._getTimeSignature()*parseFloat(i))),s&&"0"!==s&&(o*=this._beatsToUnits(parseFloat(s))),r&&"0"!==r&&(o*=this._beatsToUnits(parseFloat(r)/4)),o}}})}transpose(i){return new rj(this.context,this.valueOf()*rR(i))}harmonize(i){return i.map(i=>this.transpose(i))}toMidi(){return rN(this.valueOf())}toNote(){let i=Math.round(12*Math.log2(this.toFrequency()/rj.A4))+57,s=Math.floor(i/12);return s<0&&(i+=-12*s),rW[i%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){let i=this._beatsToUnits(1);return Math.floor(this.valueOf()/i*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(i){return i}_ticksToUnits(i){return 1/(60*i/(this._getBpm()*this._getPPQ()))}_beatsToUnits(i){return 1/super._beatsToUnits(i)}_secondsToUnits(i){return 1/i}static mtof(i){return rP*Math.pow(2,(i-69)/12)}static ftom(i){return rN(i)}}let rB={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},rW=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class rU extends rL{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class rz extends rc{constructor(){super();let i=rl(rz.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=i.context}static getDefaults(){return{context:rE()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(i){return s0(i)&&rt&&!re&&(re=!0,ri("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing")),new rL(this.context,i).toSeconds()}toFrequency(i){return new rj(this.context,i).toFrequency()}toTicks(i){return new rU(this.context,i).toTicks()}_getPartialProperties(i){let s=this.get();return Object.keys(s).forEach(r=>{s0(i[r])&&delete s[r]}),s}get(){let i=this.constructor.getDefaults();return Object.keys(i).forEach(s=>{if(Reflect.has(this,s)){let r=this[s];s1(r)&&s1(r.value)&&s1(r.setValueAtTime)?i[s]=r.value:r instanceof rz?i[s]=r._getPartialProperties(i[s]):s8(r)||s2(r)||s4(r)||"boolean"==typeof r?i[s]=r:delete i[s]}}),i}set(i){return Object.keys(i).forEach(s=>{Reflect.has(this,s)&&s1(this[s])&&(this[s]&&s1(this[s].value)&&s1(this[s].setValueAtTime)?this[s].value!==i[s]&&(this[s].value=i[s]):this[s]instanceof rz?this[s].set(i[s]):this[s]=i[s])}),this}}class rG extends r_{constructor(i="stopped"){super(),this.name="StateTimeline",this._initial=i,this.setStateAtTime(this._initial,0)}getValueAtTime(i){let s=this.get(i);return null!==s?s.state:this._initial}setStateAtTime(i,s,r){return s7(s,0),this.add(Object.assign({},r,{state:i,time:s})),this}getLastState(i,s){for(let r=this._search(s);r>=0;r--){let s=this._timeline[r];if(s.state===i)return s}}getNextState(i,s){let r=this._search(s);if(-1!==r)for(let s=r;s<this._timeline.length;s++){let r=this._timeline[s];if(r.state===i)return r}}}class rX extends rz{constructor(){super(rl(rX.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;let i=rl(rX.getDefaults(),arguments,["param","units","convert"]);for(s5(s1(i.param)&&(sQ(i.param)||i.param instanceof rX),"param must be an AudioParam");!sQ(i.param);)i.param=i.param._param;this._swappable=!!s1(i.swappable)&&i.swappable,this._swappable?(this.input=this.context.createGain(),this._param=i.param,this.input.connect(this._param)):this._param=this.input=i.param,this._events=new r_(1e3),this._initialValue=this._param.defaultValue,this.units=i.units,this.convert=i.convert,this._minValue=i.minValue,this._maxValue=i.maxValue,s1(i.value)&&i.value!==this._toType(this._initialValue)&&this.setValueAtTime(i.value,0)}static getDefaults(){return Object.assign(rz.getDefaults(),{convert:!0,units:"number"})}get value(){let i=this.now();return this.getValueAtTime(i)}set value(i){this.cancelScheduledValues(this.now()),this.setValueAtTime(i,this.now())}get minValue(){return s1(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return s1(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(i,s){return this.units===s}_assertRange(i){return s1(this.maxValue)&&s1(this.minValue)&&s7(i,this._fromType(this.minValue),this._fromType(this.maxValue)),i}_fromType(i){return this.convert&&!this.overridden?this._is(i,"time")?this.toSeconds(i):this._is(i,"decibels")?Math.pow(10,i/20):this._is(i,"frequency")?this.toFrequency(i):i:this.overridden?0:i}_toType(i){return this.convert&&"decibels"===this.units?Math.log(i)/Math.LN10*20:i}setValueAtTime(i,s){let r=this.toSeconds(s),o=this._fromType(i);return s5(isFinite(o)&&isFinite(r),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(i)}, ${JSON.stringify(s)}`),this._assertRange(o),this.log(this.units,"setValueAtTime",i,r),this._events.add({time:r,type:"setValueAtTime",value:o}),this._param.setValueAtTime(o,r),this}getValueAtTime(i){let s=Math.max(this.toSeconds(i),0),r=this._events.getAfter(s),o=this._events.get(s),a=this._initialValue;if(null===o)a=this._initialValue;else if("setTargetAtTime"!==o.type||null!==r&&"setValueAtTime"!==r.type){if(null===r)a=o.value;else if("linearRampToValueAtTime"===r.type||"exponentialRampToValueAtTime"===r.type){let i=o.value;if("setTargetAtTime"===o.type){let s=this._events.getBefore(o.time);i=null===s?this._initialValue:s.value}a="linearRampToValueAtTime"===r.type?this._linearInterpolate(o.time,i,r.time,r.value,s):this._exponentialInterpolate(o.time,i,r.time,r.value,s)}else a=o.value}else{let i;let r=this._events.getBefore(o.time);i=null===r?this._initialValue:r.value,"setTargetAtTime"===o.type&&(a=this._exponentialApproach(o.time,i,o.value,o.constant,s))}return this._toType(a)}setRampPoint(i){i=this.toSeconds(i);let s=this.getValueAtTime(i);return this.cancelAndHoldAtTime(i),0===this._fromType(s)&&(s=this._toType(this._minOutput)),this.setValueAtTime(s,i),this}linearRampToValueAtTime(i,s){let r=this._fromType(i),o=this.toSeconds(s);return s5(isFinite(r)&&isFinite(o),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(i)}, ${JSON.stringify(s)}`),this._assertRange(r),this._events.add({time:o,type:"linearRampToValueAtTime",value:r}),this.log(this.units,"linearRampToValueAtTime",i,o),this._param.linearRampToValueAtTime(r,o),this}exponentialRampToValueAtTime(i,s){let r=this._fromType(i);r=rf(r,0)?this._minOutput:r,this._assertRange(r);let o=this.toSeconds(s);return s5(isFinite(r)&&isFinite(o),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(i)}, ${JSON.stringify(s)}`),this._events.add({time:o,type:"exponentialRampToValueAtTime",value:r}),this.log(this.units,"exponentialRampToValueAtTime",i,o),this._param.exponentialRampToValueAtTime(r,o),this}exponentialRampTo(i,s,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialRampToValueAtTime(i,r+this.toSeconds(s)),this}linearRampTo(i,s,r){return r=this.toSeconds(r),this.setRampPoint(r),this.linearRampToValueAtTime(i,r+this.toSeconds(s)),this}targetRampTo(i,s,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialApproachValueAtTime(i,r,s),this}exponentialApproachValueAtTime(i,s,r){s=this.toSeconds(s);let o=Math.log((r=this.toSeconds(r))+1)/Math.log(200);return this.setTargetAtTime(i,s,o),this.cancelAndHoldAtTime(s+.9*r),this.linearRampToValueAtTime(i,s+r),this}setTargetAtTime(i,s,r){let o=this._fromType(i);s5(isFinite(r)&&r>0,"timeConstant must be a number greater than 0");let a=this.toSeconds(s);return this._assertRange(o),s5(isFinite(o)&&isFinite(a),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(i)}, ${JSON.stringify(s)}`),this._events.add({constant:r,time:a,type:"setTargetAtTime",value:o}),this.log(this.units,"setTargetAtTime",i,a,r),this._param.setTargetAtTime(o,a,r),this}setValueCurveAtTime(i,s,r,o=1){r=this.toSeconds(r),s=this.toSeconds(s);let a=this._fromType(i[0])*o;this.setValueAtTime(this._toType(a),s);let l=r/(i.length-1);for(let r=1;r<i.length;r++){let a=this._fromType(i[r])*o;this.linearRampToValueAtTime(this._toType(a),s+r*l)}return this}cancelScheduledValues(i){let s=this.toSeconds(i);return s5(isFinite(s),`Invalid argument to cancelScheduledValues: ${JSON.stringify(i)}`),this._events.cancel(s),this._param.cancelScheduledValues(s),this.log(this.units,"cancelScheduledValues",s),this}cancelAndHoldAtTime(i){let s=this.toSeconds(i),r=this._fromType(this.getValueAtTime(s));s5(isFinite(s),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(i)}`),this.log(this.units,"cancelAndHoldAtTime",s,"value="+r);let o=this._events.get(s),a=this._events.getAfter(s);return o&&rf(o.time,s)?a?(this._param.cancelScheduledValues(a.time),this._events.cancel(a.time)):(this._param.cancelAndHoldAtTime(s),this._events.cancel(s+this.sampleTime)):a&&(this._param.cancelScheduledValues(a.time),this._events.cancel(a.time),"linearRampToValueAtTime"===a.type?this.linearRampToValueAtTime(this._toType(r),s):"exponentialRampToValueAtTime"===a.type&&this.exponentialRampToValueAtTime(this._toType(r),s)),this._events.add({time:s,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,s),this}rampTo(i,s=.1,r){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(i,s,r):this.linearRampTo(i,s,r),this}apply(i){let s=this.context.currentTime;i.setValueAtTime(this.getValueAtTime(s),s);let r=this._events.get(s);if(r&&"setTargetAtTime"===r.type){let o=this._events.getAfter(r.time),a=o?o.time:s+2,l=(a-s)/10;for(let r=s;r<a;r+=l)i.linearRampToValueAtTime(this.getValueAtTime(r),r)}return this._events.forEachAfter(this.context.currentTime,s=>{"cancelScheduledValues"===s.type?i.cancelScheduledValues(s.time):"setTargetAtTime"===s.type?i.setTargetAtTime(s.value,s.time,s.constant):i[s.type](s.value,s.time)}),this}setParam(i){s5(this._swappable,"The Param must be assigned as 'swappable' in the constructor");let s=this.input;return s.disconnect(this._param),this.apply(i),this._param=i,s.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(i,s,r,o,a){return r+(s-r)*Math.exp(-(a-i)/o)}_linearInterpolate(i,s,r,o,a){return s+(a-i)/(r-i)*(o-s)}_exponentialInterpolate(i,s,r,o,a){return s*Math.pow(o/s,(a-i)/(r-i))}}class rY extends rz{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return s1(this.input)?sQ(this.input)||this.input instanceof rX?1:this.input.numberOfInputs:0}get numberOfOutputs(){return s1(this.output)?this.output.numberOfOutputs:0}_isAudioNode(i){return s1(i)&&(i instanceof rY||sJ(i))}_getInternalNodes(){let i=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&i.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&i.push(this.output),i}_setChannelProperties(i){this._getInternalNodes().forEach(s=>{s.channelCount=i.channelCount,s.channelCountMode=i.channelCountMode,s.channelInterpretation=i.channelInterpretation})}_getChannelProperties(){let i=this._getInternalNodes();s5(i.length>0,"ToneAudioNode does not have any internal nodes");let s=i[0];return{channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(i){let s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelCount:i}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(i){let s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelCountMode:i}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(i){let s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelInterpretation:i}))}connect(i,s=0,r=0){return r$(this,i,s,r),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return ri("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(i,s=0,r=0){return function(i,s,r=0,o=0){if(s1(s))for(;s instanceof rY;)s=s.input;for(;!sJ(i);)s1(i.output)&&(i=i.output);sQ(s)?i.disconnect(s,r):sJ(s)?i.disconnect(s,r,o):i.disconnect()}(this,i,s,r),this}chain(...i){return rZ(this,...i),this}fan(...i){return i.forEach(i=>this.connect(i)),this}dispose(){return super.dispose(),s1(this.input)&&(this.input instanceof rY?this.input.dispose():sJ(this.input)&&this.input.disconnect()),s1(this.output)&&(this.output instanceof rY?this.output.dispose():sJ(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function rZ(...i){let s=i.shift();i.reduce((i,s)=>(i instanceof rY?i.connect(s):sJ(i)&&r$(i,s),s),s)}function r$(i,s,r=0,o=0){for(s5(s1(i),"Cannot connect from undefined node"),s5(s1(s),"Cannot connect to undefined node"),(s instanceof rY||sJ(s))&&s5(s.numberOfInputs>0,"Cannot connect to node with no inputs"),s5(i.numberOfOutputs>0,"Cannot connect from node with no outputs");s instanceof rY||s instanceof rX;)s1(s.input)&&(s=s.input);for(;i instanceof rY;)s1(i.output)&&(i=i.output);sQ(s)?i.connect(s,r):i.connect(s,r,o)}class rH extends rY{constructor(){super(rl(rH.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;let i=rl(rH.getDefaults(),arguments,["gain","units"]);this.gain=new rX({context:this.context,convert:i.convert,param:this._gainNode.gain,units:i.units,value:i.gain,minValue:i.minValue,maxValue:i.maxValue}),rC(this,"gain")}static getDefaults(){return Object.assign(rY.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class rJ extends rY{constructor(i){super(i),this.onended=rS,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new rH({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(i){let s=this.toSeconds(i);return -1!==this._startTime&&s>=this._startTime&&(-1===this._stopTime||s<=this._stopTime)?"started":"stopped"},this._fadeIn=i.fadeIn,this._fadeOut=i.fadeOut,this._curve=i.curve,this.onended=i.onended}static getDefaults(){return Object.assign(rY.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:rS})}_startGain(i,s=1){s5(-1===this._startTime,"Source cannot be started more than once");let r=this.toSeconds(this._fadeIn);return this._startTime=i+r,this._startTime=Math.max(this._startTime,this.context.currentTime),r>0?(this._gainNode.gain.setValueAtTime(0,i),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(s,i+r):this._gainNode.gain.exponentialApproachValueAtTime(s,i,r)):this._gainNode.gain.setValueAtTime(s,i),this}stop(i){return this.log("stop",i),this._stopGain(this.toSeconds(i)),this}_stopGain(i){s5(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();let s=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(i)+s,this._stopTime=Math.max(this._stopTime,this.now()),s>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,s,i):this._gainNode.gain.targetRampTo(0,s,i):(this._gainNode.gain.cancelAndHoldAtTime(i),this._gainNode.gain.setValueAtTime(0,i)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{let i="exponential"===this._curve?2*s:0;this._stopSource(this.now()+i),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==rS&&(this.onended(this),this.onended=rS,!this.context.isOffline)){let i=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(i):setTimeout(i,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),s5(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=rS,this}}class rQ extends rJ{constructor(){super(rl(rQ.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();let i=rl(rQ.getDefaults(),arguments,["offset"]);r$(this._source,this._gainNode),this.offset=new rX({context:this.context,convert:i.convert,param:this._source.offset,units:i.units,value:i.offset,minValue:i.minValue,maxValue:i.maxValue})}static getDefaults(){return Object.assign(rJ.getDefaults(),{convert:!0,offset:1,units:"number"})}start(i){let s=this.toSeconds(i);return this.log("start",s),this._startGain(s),this._source.start(s),this}_stopSource(i){this._source.stop(i)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class rK extends rY{constructor(){super(rl(rK.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;let i=rl(rK.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new rQ({context:this.context,convert:i.convert,offset:i.value,units:i.units,minValue:i.minValue,maxValue:i.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(rY.getDefaults(),{convert:!0,units:"number",value:0})}connect(i,s=0,r=0){return r0(this,i,s,r),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(i,s){return this._param.setValueAtTime(i,s),this}getValueAtTime(i){return this._param.getValueAtTime(i)}setRampPoint(i){return this._param.setRampPoint(i),this}linearRampToValueAtTime(i,s){return this._param.linearRampToValueAtTime(i,s),this}exponentialRampToValueAtTime(i,s){return this._param.exponentialRampToValueAtTime(i,s),this}exponentialRampTo(i,s,r){return this._param.exponentialRampTo(i,s,r),this}linearRampTo(i,s,r){return this._param.linearRampTo(i,s,r),this}targetRampTo(i,s,r){return this._param.targetRampTo(i,s,r),this}exponentialApproachValueAtTime(i,s,r){return this._param.exponentialApproachValueAtTime(i,s,r),this}setTargetAtTime(i,s,r){return this._param.setTargetAtTime(i,s,r),this}setValueCurveAtTime(i,s,r,o){return this._param.setValueCurveAtTime(i,s,r,o),this}cancelScheduledValues(i){return this._param.cancelScheduledValues(i),this}cancelAndHoldAtTime(i){return this._param.cancelAndHoldAtTime(i),this}rampTo(i,s,r){return this._param.rampTo(i,s,r),this}get value(){return this._param.value}set value(i){this._param.value=i}get convert(){return this._param.convert}set convert(i){this._param.convert=i}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(i){this._param.overridden=i}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(i){return this._param.apply(i),this}}function r0(i,s,r,o){(s instanceof rX||sQ(s)||s instanceof rK&&s.override)&&(s.cancelScheduledValues(0),s.setValueAtTime(0,0),s instanceof rK&&(s.overridden=!0)),r$(i,s,r,o)}class r1 extends rX{constructor(){super(rl(r1.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new r_(1/0),this._multiplier=1;let i=rl(r1.getDefaults(),arguments,["value"]);this._multiplier=i.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(i.value)}),this.setValueAtTime(i.value,0)}static getDefaults(){return Object.assign(rX.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(i,s,r){s=this.toSeconds(s),this.setRampPoint(s);let o=this._fromType(i),a=this._events.get(s),l=Math.round(Math.max(1/r,1));for(let i=0;i<=l;i++){let l=r*i+s,h=this._exponentialApproach(a.time,a.value,o,r,l);this.linearRampToValueAtTime(this._toType(h),l)}return this}setValueAtTime(i,s){let r=this.toSeconds(s);super.setValueAtTime(i,s);let o=this._events.get(r),a=this._events.previousEvent(o),l=this._getTicksUntilEvent(a,r);return o.ticks=Math.max(l,0),this}linearRampToValueAtTime(i,s){let r=this.toSeconds(s);super.linearRampToValueAtTime(i,s);let o=this._events.get(r),a=this._events.previousEvent(o),l=this._getTicksUntilEvent(a,r);return o.ticks=Math.max(l,0),this}exponentialRampToValueAtTime(i,s){s=this.toSeconds(s);let r=this._fromType(i),o=this._events.get(s),a=Math.round(Math.max(10*(s-o.time),1)),l=(s-o.time)/a;for(let i=0;i<=a;i++){let a=l*i+o.time,h=this._exponentialInterpolate(o.time,o.value,s,r,a);this.linearRampToValueAtTime(this._toType(h),a)}return this}_getTicksUntilEvent(i,s){if(null===i)i={ticks:0,time:0,type:"setValueAtTime",value:0};else if(s0(i.ticks)){let s=this._events.previousEvent(i);i.ticks=this._getTicksUntilEvent(s,i.time)}let r=this._fromType(this.getValueAtTime(i.time)),o=this._fromType(this.getValueAtTime(s)),a=this._events.get(s);return a&&a.time===s&&"setValueAtTime"===a.type&&(o=this._fromType(this.getValueAtTime(s-this.sampleTime))),.5*(s-i.time)*(r+o)+i.ticks}getTicksAtTime(i){let s=this.toSeconds(i),r=this._events.get(s);return Math.max(this._getTicksUntilEvent(r,s),0)}getDurationOfTicks(i,s){let r=this.toSeconds(s),o=this.getTicksAtTime(s);return this.getTimeOfTick(o+i)-r}getTimeOfTick(i){let s=this._events.get(i,"ticks"),r=this._events.getAfter(i,"ticks");if(s&&s.ticks===i)return s.time;if(s&&r&&"linearRampToValueAtTime"===r.type&&s.value!==r.value){let o=this._fromType(this.getValueAtTime(s.time)),a=(this._fromType(this.getValueAtTime(r.time))-o)/(r.time-s.time),l=Math.sqrt(Math.pow(o,2)-2*a*(s.ticks-i)),h=(-o+l)/a;return(h>0?h:(-o-l)/a)+s.time}return s?0===s.value?1/0:s.time+(i-s.ticks)/s.value:i/this._initialValue}ticksToTime(i,s){return this.getDurationOfTicks(i,s)}timeToTicks(i,s){let r=this.toSeconds(s),o=this.toSeconds(i),a=this.getTicksAtTime(r);return this.getTicksAtTime(r+o)-a}_fromType(i){return"bpm"===this.units&&this.multiplier?1/(60/i/this.multiplier):super._fromType(i)}_toType(i){return"bpm"===this.units&&this.multiplier?i/this.multiplier*60:super._toType(i)}get multiplier(){return this._multiplier}set multiplier(i){let s=this.value;this._multiplier=i,this.cancelScheduledValues(0),this.setValueAtTime(s,0)}}class r2 extends rK{constructor(){super(rl(r2.getDefaults(),arguments,["value"])),this.name="TickSignal";let i=rl(r2.getDefaults(),arguments,["value"]);this.input=this._param=new r1({context:this.context,convert:i.convert,multiplier:i.multiplier,param:this._constantSource.offset,units:i.units,value:i.value})}static getDefaults(){return Object.assign(rK.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(i,s){return this._param.ticksToTime(i,s)}timeToTicks(i,s){return this._param.timeToTicks(i,s)}getTimeOfTick(i){return this._param.getTimeOfTick(i)}getDurationOfTicks(i,s){return this._param.getDurationOfTicks(i,s)}getTicksAtTime(i){return this._param.getTicksAtTime(i)}get multiplier(){return this._param.multiplier}set multiplier(i){this._param.multiplier=i}dispose(){return super.dispose(),this._param.dispose(),this}}class r3 extends rz{constructor(){super(rl(r3.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new rG,this._tickOffset=new r_,this._ticksAtTime=new r_,this._secondsAtTime=new r_;let i=rl(r3.getDefaults(),arguments,["frequency"]);this.frequency=new r2({context:this.context,units:i.units,value:i.frequency}),rC(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},rz.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(i,s){let r=this.toSeconds(i);return"started"!==this._state.getValueAtTime(r)&&(this._state.setStateAtTime("started",r),s1(s)&&this.setTicksAtTime(s,r),this._ticksAtTime.cancel(r),this._secondsAtTime.cancel(r)),this}stop(i){let s=this.toSeconds(i);if("stopped"===this._state.getValueAtTime(s)){let i=this._state.get(s);i&&i.time>0&&(this._tickOffset.cancel(i.time),this._state.cancel(i.time))}return this._state.cancel(s),this._state.setStateAtTime("stopped",s),this.setTicksAtTime(0,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s),this}pause(i){let s=this.toSeconds(i);return"started"===this._state.getValueAtTime(s)&&(this._state.setStateAtTime("paused",s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}cancel(i){return i=this.toSeconds(i),this._state.cancel(i),this._tickOffset.cancel(i),this._ticksAtTime.cancel(i),this._secondsAtTime.cancel(i),this}getTicksAtTime(i){let s=this.toSeconds(i),r=this._state.getLastState("stopped",s),o=this._ticksAtTime.get(s),a={state:"paused",time:s};this._state.add(a);let l=o||r,h=o?o.ticks:0,u=null;return this._state.forEachBetween(l.time,s+this.sampleTime,i=>{let s=l.time,r=this._tickOffset.get(i.time);r&&r.time>=l.time&&(h=r.ticks,s=r.time),"started"===l.state&&"started"!==i.state&&(h+=this.frequency.getTicksAtTime(i.time)-this.frequency.getTicksAtTime(s),i.time!==a.time&&(u={state:i.state,time:i.time,ticks:h})),l=i}),this._state.remove(a),u&&this._ticksAtTime.add(u),h}get ticks(){return this.getTicksAtTime(this.now())}set ticks(i){this.setTicksAtTime(i,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(i){let s=this.now(),r=this.frequency.timeToTicks(i,s);this.setTicksAtTime(r,s)}getSecondsAtTime(i){i=this.toSeconds(i);let s=this._state.getLastState("stopped",i),r={state:"paused",time:i};this._state.add(r);let o=this._secondsAtTime.get(i),a=o||s,l=o?o.seconds:0,h=null;return this._state.forEachBetween(a.time,i+this.sampleTime,i=>{let s=a.time,o=this._tickOffset.get(i.time);o&&o.time>=a.time&&(l=o.seconds,s=o.time),"started"===a.state&&"started"!==i.state&&(l+=i.time-s,i.time!==r.time&&(h={state:i.state,time:i.time,seconds:l})),a=i}),this._state.remove(r),h&&this._secondsAtTime.add(h),l}setTicksAtTime(i,s){return s=this.toSeconds(s),this._tickOffset.cancel(s),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(i,s),ticks:i,time:s}),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s),this}getStateAtTime(i){return i=this.toSeconds(i),this._state.getValueAtTime(i)}getTimeOfTick(i,s=this.now()){let r=this._tickOffset.get(s),o=this._state.get(s),a=Math.max(r.time,o.time),l=this.frequency.getTicksAtTime(a)+i-r.ticks;return this.frequency.getTimeOfTick(l)}forEachTickBetween(i,s,r){let o=this._state.get(i);this._state.forEachBetween(i,s,s=>{o&&"started"===o.state&&"started"!==s.state&&this.forEachTickBetween(Math.max(o.time,i),s.time-this.sampleTime,r),o=s});let a=null;if(o&&"started"===o.state){let l=Math.max(o.time,i),h=this.frequency.getTicksAtTime(l),u=h-this.frequency.getTicksAtTime(o.time),c=Math.ceil(u)-u;c=rf(c,1)?0:c;let d=this.frequency.getTimeOfTick(h+c);for(;d<s;){try{r(d,Math.round(this.getTicksAtTime(d)))}catch(i){a=i;break}d+=this.frequency.getDurationOfTicks(1,d)}}if(a)throw a;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class r8 extends rz{constructor(){super(rl(r8.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=rS,this._lastUpdate=0,this._state=new rG("stopped"),this._boundLoop=this._loop.bind(this);let i=rl(r8.getDefaults(),arguments,["callback","frequency"]);this.callback=i.callback,this._tickSource=new r3({context:this.context,frequency:i.frequency,units:i.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,rC(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(rz.getDefaults(),{callback:rS,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(i,s){s9(this.context);let r=this.toSeconds(i);return this.log("start",r),"started"!==this._state.getValueAtTime(r)&&(this._state.setStateAtTime("started",r),this._tickSource.start(r,s),r<this._lastUpdate&&this.emit("start",r,s)),this}stop(i){let s=this.toSeconds(i);return this.log("stop",s),this._state.cancel(s),this._state.setStateAtTime("stopped",s),this._tickSource.stop(s),s<this._lastUpdate&&this.emit("stop",s),this}pause(i){let s=this.toSeconds(i);return"started"===this._state.getValueAtTime(s)&&(this._state.setStateAtTime("paused",s),this._tickSource.pause(s),s<this._lastUpdate&&this.emit("pause",s)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(i){this._tickSource.ticks=i}get seconds(){return this._tickSource.seconds}set seconds(i){this._tickSource.seconds=i}getSecondsAtTime(i){return this._tickSource.getSecondsAtTime(i)}setTicksAtTime(i,s){return this._tickSource.setTicksAtTime(i,s),this}getTimeOfTick(i,s=this.now()){return this._tickSource.getTimeOfTick(i,s)}getTicksAtTime(i){return this._tickSource.getTicksAtTime(i)}nextTickTime(i,s){let r=this.toSeconds(s),o=this.getTicksAtTime(r);return this._tickSource.getTimeOfTick(o+i,r)}_loop(){let i=this._lastUpdate,s=this.now();this._lastUpdate=s,this.log("loop",i,s),i!==s&&(this._state.forEachBetween(i,s,i=>{switch(i.state){case"started":let s=this._tickSource.getTicksAtTime(i.time);this.emit("start",i.time,s);break;case"stopped":0!==i.time&&this.emit("stop",i.time);break;case"paused":this.emit("pause",i.time)}}),this._tickSource.forEachTickBetween(i,s,(i,s)=>{this.callback(i,s)}))}getStateAtTime(i){let s=this.toSeconds(i);return this._state.getValueAtTime(s)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}rT.mixin(r8);class r4 extends rz{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new r_,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(i,s){return this._events.add({callback:i,time:this.toSeconds(s)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(i){return this._events.cancel(this.toSeconds(i)),this}_drawLoop(){let i=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=i;){let s=this._events.shift();s&&i-s.time<=this.expiration&&s.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}rv(i=>{i.draw=new r4({context:i})}),rb(i=>{i.draw.dispose()});class r6 extends rY{constructor(){super(rl(r6.getDefaults(),arguments,["volume"])),this.name="Volume";let i=rl(r6.getDefaults(),arguments,["volume"]);this.input=this.output=new rH({context:this.context,gain:i.volume,units:"decibels"}),this.volume=this.output.gain,rC(this,"volume"),this._unmutedVolume=i.volume,this.mute=i.mute}static getDefaults(){return Object.assign(rY.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(i){!this.mute&&i?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!i&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class r5 extends rY{constructor(){super(rl(r5.getDefaults(),arguments)),this.name="Destination",this.input=new r6({context:this.context}),this.output=new rH({context:this.context}),this.volume=this.input.volume;let i=rl(r5.getDefaults(),arguments);rZ(this.input,this.output,this.context.rawContext.destination),this.mute=i.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(rY.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(i){this.input.mute=i}chain(...i){return this.input.disconnect(),i.unshift(this.input),i.push(this.output),rZ(...i),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}rv(i=>{i.destination=new r5({context:i})}),rb(i=>{i.destination.dispose()});class r7 extends rc{constructor(i){super(),this.name="TimelineValue",this._timeline=new r_({memory:10}),this._initialValue=i}set(i,s){return this._timeline.add({value:i,time:s}),this}get(i){let s=this._timeline.get(i);return s?s.value:this._initialValue}}class r9 extends rY{constructor(){super(Object.assign(rl(r9.getDefaults(),arguments,["context"])))}connect(i,s=0,r=0){return r0(this,i,s,r),this}}class ot extends r9{constructor(){super(Object.assign(rl(ot.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;let i=rl(ot.getDefaults(),arguments,["mapping","length"]);s8(i.mapping)||i.mapping instanceof Float32Array?this.curve=Float32Array.from(i.mapping):"function"==typeof i.mapping&&this.setMap(i.mapping,i.length)}static getDefaults(){return Object.assign(rK.getDefaults(),{length:1024})}setMap(i,s=1024){let r=new Float32Array(s);for(let o=0;o<s;o++){let a=o/(s-1)*2-1;r[o]=i(a,o)}return this.curve=r,this}get curve(){return this._shaper.curve}set curve(i){this._shaper.curve=i}get oversample(){return this._shaper.oversample}set oversample(i){s5(["none","2x","4x"].some(s=>s.includes(i)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=i}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class oe extends r9{constructor(){super(Object.assign(rl(oe.getDefaults(),arguments,["value"]))),this.name="Pow";let i=rl(oe.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new ot({context:this.context,mapping:this._expFunc(i.value),length:8192}),this._exponent=i.value}static getDefaults(){return Object.assign(r9.getDefaults(),{value:1})}_expFunc(i){return s=>Math.pow(Math.abs(s),i)}get value(){return this._exponent}set value(i){this._exponent=i,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class on extends rU{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(i){return this._getPPQ()*i}_secondsToUnits(i){return Math.floor(i/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(i){return i}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class oi extends rc{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(i){s5(s1(i.time),"Events must have a time property"),s5(s1(i.duration),"Events must have a duration parameter"),i.time=i.time.valueOf();let s=new os(i.time,i.time+i.duration,i);for(null===this._root?this._root=s:this._root.insert(s),this._length++;null!==s;)s.updateHeight(),s.updateMax(),this._rebalance(s),s=s.parent;return this}remove(i){if(null!==this._root){let s=[];for(let r of(this._root.search(i.time,s),s))if(r.event===i){this._removeNode(r),this._length--;break}}return this}get length(){return this._length}cancel(i){return this.forEachFrom(i,i=>this.remove(i)),this}_setRoot(i){this._root=i,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(i,s){null!==i.parent?(i.isLeftChild()?i.parent.left=s:i.parent.right=s,this._rebalance(i.parent)):this._setRoot(s)}_removeNode(i){if(null===i.left&&null===i.right)this._replaceNodeInParent(i,null);else if(null===i.right)this._replaceNodeInParent(i,i.left);else if(null===i.left)this._replaceNodeInParent(i,i.right);else{let s,r=null;if(i.getBalance()>0){if(null===i.left.right)(s=i.left).right=i.right,r=s;else{for(s=i.left.right;null!==s.right;)s=s.right;s.parent&&(s.parent.right=s.left,r=s.parent,s.left=i.left,s.right=i.right)}}else if(null===i.right.left)(s=i.right).left=i.left,r=s;else{for(s=i.right.left;null!==s.left;)s=s.left;s.parent&&(s.parent.left=s.right,r=s.parent,s.left=i.left,s.right=i.right)}null!==i.parent?i.isLeftChild()?i.parent.left=s:i.parent.right=s:this._setRoot(s),r&&this._rebalance(r)}i.dispose()}_rotateLeft(i){let s=i.parent,r=i.isLeftChild(),o=i.right;o&&(i.right=o.left,o.left=i),null!==s?r?s.left=o:s.right=o:this._setRoot(o)}_rotateRight(i){let s=i.parent,r=i.isLeftChild(),o=i.left;o&&(i.left=o.right,o.right=i),null!==s?r?s.left=o:s.right=o:this._setRoot(o)}_rebalance(i){let s=i.getBalance();s>1&&i.left?0>i.left.getBalance()?this._rotateLeft(i.left):this._rotateRight(i):s<-1&&i.right&&(i.right.getBalance()>0?this._rotateRight(i.right):this._rotateLeft(i))}get(i){if(null!==this._root){let s=[];if(this._root.search(i,s),s.length>0){let i=s[0];for(let r=1;r<s.length;r++)s[r].low>i.low&&(i=s[r]);return i.event}}return null}forEach(i){if(null!==this._root){let s=[];this._root.traverse(i=>s.push(i)),s.forEach(s=>{s.event&&i(s.event)})}return this}forEachAtTime(i,s){if(null!==this._root){let r=[];this._root.search(i,r),r.forEach(i=>{i.event&&s(i.event)})}return this}forEachFrom(i,s){if(null!==this._root){let r=[];this._root.searchAfter(i,r),r.forEach(i=>{i.event&&s(i.event)})}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse(i=>i.dispose()),this._root=null,this}}class os{constructor(i,s,r){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=i,this.high=s,this.max=this.high}insert(i){i.low<=this.low?null===this.left?this.left=i:this.left.insert(i):null===this.right?this.right=i:this.right.insert(i)}search(i,s){i>this.max||(null!==this.left&&this.left.search(i,s),this.low<=i&&this.high>i&&s.push(this),this.low>i||null!==this.right&&this.right.search(i,s))}searchAfter(i,s){this.low>=i&&(s.push(this),null!==this.left&&this.left.searchAfter(i,s)),null!==this.right&&this.right.searchAfter(i,s)}traverse(i){i(this),null!==this.left&&this.left.traverse(i),null!==this.right&&this.right.traverse(i)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let i=0;return null!==this.left&&null!==this.right?i=this.left.height-this.right.height:null!==this.left?i=this.left.height+1:null!==this.right&&(i=-(this.right.height+1)),i}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(i){this._left=i,null!==i&&(i.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(i){this._right=i,null!==i&&(i.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class or{constructor(i,s){this.id=or._eventId++,this._remainderTime=0;let r=Object.assign(or.getDefaults(),s);this.transport=i,this.callback=r.callback,this._once=r.once,this.time=Math.floor(r.time),this._remainderTime=r.time-this.time}static getDefaults(){return{callback:rS,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(i){if(this.callback){let s=this.transport.bpm.getDurationOfTicks(1,i);this.callback(i+this._remainderTime*s),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}or._eventId=0;class oo extends or{constructor(i,s){super(i,s),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);let r=Object.assign(oo.getDefaults(),s);this.duration=r.duration,this._interval=r.interval,this._nextTick=r.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},or.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(i){this._createEvents(i),super.invoke(i)}_createEvent(){return rm(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new on(this.context,this._nextTick).toSeconds()):-1}_createEvents(i){rm(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new on(this.context,this._nextTick).toSeconds()))}_restart(i){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;let s=this.transport.getTicksAtTime(i);rd(s,this.time)&&(this._nextTick=this.floatTime+Math.ceil((s-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class oa extends rz{constructor(){super(rl(oa.getDefaults(),arguments)),this.name="Transport",this._loop=new r7(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new r_,this._repeatedEvents=new oi,this._syncedSignals=[],this._swingAmount=0;let i=rl(oa.getDefaults(),arguments);this._ppq=i.ppq,this._clock=new r8({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=i.ppq,this.bpm.setValueAtTime(i.bpm,0),rC(this,"bpm"),this._timeSignature=i.timeSignature,this._swingTicks=i.ppq/2}static getDefaults(){return Object.assign(rz.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(i,s){if(this._loop.get(i)&&s>=this._loopEnd&&(this.emit("loopEnd",i),this._clock.setTicksAtTime(this._loopStart,i),s=this._loopStart,this.emit("loopStart",i,this._clock.getSecondsAtTime(i)),this.emit("loop",i)),this._swingAmount>0&&s%this._ppq!=0&&s%(2*this._swingTicks)!=0){let r=Math.sin(s%(2*this._swingTicks)/(2*this._swingTicks)*Math.PI)*this._swingAmount;i+=new on(this.context,2*this._swingTicks/3).toSeconds()*r}rt=!0,this._timeline.forEachAtTime(s,s=>s.invoke(i)),rt=!1}schedule(i,s){let r=new or(this,{callback:i,time:new rU(this.context,s).toTicks()});return this._addEvent(r,this._timeline)}scheduleRepeat(i,s,r,o=1/0){let a=new oo(this,{callback:i,duration:new rL(this.context,o).toTicks(),interval:new rL(this.context,s).toTicks(),time:new rU(this.context,r).toTicks()});return this._addEvent(a,this._repeatedEvents)}scheduleOnce(i,s){let r=new or(this,{callback:i,once:!0,time:new rU(this.context,s).toTicks()});return this._addEvent(r,this._timeline)}clear(i){if(this._scheduledEvents.hasOwnProperty(i)){let s=this._scheduledEvents[i.toString()];s.timeline.remove(s.event),s.event.dispose(),delete this._scheduledEvents[i.toString()]}return this}_addEvent(i,s){return this._scheduledEvents[i.id.toString()]={event:i,timeline:s},s.add(i),i.id}cancel(i=0){let s=this.toTicks(i);return this._timeline.forEachFrom(s,i=>this.clear(i.id)),this._repeatedEvents.forEachFrom(s,i=>this.clear(i.id)),this}_bindClockEvents(){this._clock.on("start",(i,s)=>{s=new on(this.context,s).toSeconds(),this.emit("start",i,s)}),this._clock.on("stop",i=>{this.emit("stop",i)}),this._clock.on("pause",i=>{this.emit("pause",i)})}get state(){return this._clock.getStateAtTime(this.now())}start(i,s){let r;return this.context.resume(),s1(s)&&(r=this.toTicks(s)),this._clock.start(i,r),this}stop(i){return this._clock.stop(i),this}pause(i){return this._clock.pause(i),this}toggle(i){return i=this.toSeconds(i),"started"!==this._clock.getStateAtTime(i)?this.start(i):this.stop(i),this}get timeSignature(){return this._timeSignature}set timeSignature(i){s8(i)&&(i=i[0]/i[1]*4),this._timeSignature=i}get loopStart(){return new rL(this.context,this._loopStart,"i").toSeconds()}set loopStart(i){this._loopStart=this.toTicks(i)}get loopEnd(){return new rL(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(i){this._loopEnd=this.toTicks(i)}get loop(){return this._loop.get(this.now())}set loop(i){this._loop.set(i,this.now())}setLoopPoints(i,s){return this.loopStart=i,this.loopEnd=s,this}get swing(){return this._swingAmount}set swing(i){this._swingAmount=i}get swingSubdivision(){return new on(this.context,this._swingTicks).toNotation()}set swingSubdivision(i){this._swingTicks=this.toTicks(i)}get position(){let i=this.now(),s=this._clock.getTicksAtTime(i);return new on(this.context,s).toBarsBeatsSixteenths()}set position(i){let s=this.toTicks(i);this.ticks=s}get seconds(){return this._clock.seconds}set seconds(i){let s=this.now(),r=this._clock.frequency.timeToTicks(i,s);this.ticks=r}get progress(){if(this.loop){let i=this.now();return(this._clock.getTicksAtTime(i)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(i){if(this._clock.ticks!==i){let s=this.now();if("started"===this.state){let r=this._clock.getTicksAtTime(s),o=s+this._clock.frequency.getDurationOfTicks(Math.ceil(r)-r,s);this.emit("stop",o),this._clock.setTicksAtTime(i,o),this.emit("start",o,this._clock.getSecondsAtTime(o))}else this.emit("ticks",s),this._clock.setTicksAtTime(i,s)}}getTicksAtTime(i){return this._clock.getTicksAtTime(i)}getSecondsAtTime(i){return this._clock.getSecondsAtTime(i)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(i){this._clock.frequency.multiplier=i}nextSubdivision(i){if(i=this.toTicks(i),"started"!==this.state)return 0;{let s=this.now(),r=i-this.getTicksAtTime(s)%i;return this._clock.nextTickTime(r,s)}}syncSignal(i,s){let r=this.now(),o=this.bpm,a=1/(60/o.getValueAtTime(r)/this.PPQ),l=[];if("time"===i.units){let i=1/64/a,s=new rH(i),r=new oe(-1),h=new rH(i);o.chain(s,r,h),o=h,a=1/a,l=[s,r,h]}s||(s=0!==i.getValueAtTime(r)?i.getValueAtTime(r)/a:0);let h=new rH(s);return o.connect(h),h.connect(i._param),l.push(h),this._syncedSignals.push({initial:i.value,nodes:l,signal:i}),i.value=0,this}unsyncSignal(i){for(let s=this._syncedSignals.length-1;s>=0;s--){let r=this._syncedSignals[s];r.signal===i&&(r.nodes.forEach(i=>i.dispose()),r.signal.value=r.initial,this._syncedSignals.splice(s,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),function i(s,r){s8(r)?r.forEach(r=>i(s,r)):Object.defineProperty(s,r,{writable:!0})}(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}rT.mixin(oa),rv(i=>{i.transport=new oa({context:i})}),rb(i=>{i.transport.dispose()});class ol extends rY{constructor(i){super(i),this.input=void 0,this._state=new rG("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=rS,this._syncedStop=rS,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new r6({context:this.context,mute:i.mute,volume:i.volume}),this.volume=this._volume.volume,rC(this,"volume"),this.onstop=i.onstop}static getDefaults(){return Object.assign(rY.getDefaults(),{mute:!1,onstop:rS,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(i){this._volume.mute=i}_clampToCurrentTime(i){return this._synced?i:Math.max(i,this.context.currentTime)}start(i,s,r){let o=s0(i)&&this._synced?this.context.transport.seconds:this.toSeconds(i);if(o=this._clampToCurrentTime(o),this._synced||"started"!==this._state.getValueAtTime(o)){if(this.log("start",o),this._state.setStateAtTime("started",o),this._synced){let i=this._state.get(o);i&&(i.offset=this.toSeconds(rh(s,0)),i.duration=r?this.toSeconds(r):void 0);let a=this.context.transport.schedule(i=>{this._start(i,s,r)},o);this._scheduled.push(a),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>o&&this._syncedStart(this.now(),this.context.transport.seconds)}else s9(this.context),this._start(o,s,r)}else s5(rd(o,this._state.get(o).time),"Start time must be strictly greater than previous start time"),this._state.cancel(o),this._state.setStateAtTime("started",o),this.log("restart",o),this.restart(o,s,r);return this}stop(i){let s=s0(i)&&this._synced?this.context.transport.seconds:this.toSeconds(i);if(s=this._clampToCurrentTime(s),"started"===this._state.getValueAtTime(s)||s1(this._state.getNextState("started",s))){if(this.log("stop",s),this._synced){let i=this.context.transport.schedule(this._stop.bind(this),s);this._scheduled.push(i)}else this._stop(s);this._state.cancel(s),this._state.setStateAtTime("stopped",s)}return this}restart(i,s,r){return i=this.toSeconds(i),"started"===this._state.getValueAtTime(i)&&(this._state.cancel(i),this._restart(i,s,r)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(i,s)=>{if(rd(s,0)){let r=this._state.get(s);if(r&&"started"===r.state&&r.time!==s){let o;let a=s-this.toSeconds(r.time);r.duration&&(o=this.toSeconds(r.duration)-a),this._start(i,this.toSeconds(r.offset)+a,o)}}},this._syncedStop=i=>{let s=this.context.transport.getSecondsAtTime(Math.max(i-this.sampleTime,0));"started"===this._state.getValueAtTime(s)&&this._stop(i)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(i=>this.context.transport.clear(i)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=rS,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}function oh(i,s){return t4(this,void 0,void 0,function*(){let r=s/i.context.sampleRate,o=new rk(1,r,i.context.sampleRate);return new i.constructor(Object.assign(i.get(),{frequency:2/r,detune:0,context:o})).toDestination().start(0),(yield o.render()).getChannelData(0)})}class ou extends rJ{constructor(){super(rl(ou.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];let i=rl(ou.getDefaults(),arguments,["frequency","type"]);r$(this._oscillator,this._gainNode),this.type=i.type,this.frequency=new rX({context:this.context,param:this._oscillator.frequency,units:"frequency",value:i.frequency}),this.detune=new rX({context:this.context,param:this._oscillator.detune,units:"cents",value:i.detune}),rC(this,["frequency","detune"])}static getDefaults(){return Object.assign(rJ.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(i){let s=this.toSeconds(i);return this.log("start",s),this._startGain(s),this._oscillator.start(s),this}_stopSource(i){this._oscillator.stop(i)}setPeriodicWave(i){return this._oscillator.setPeriodicWave(i),this}get type(){return this._oscillator.type}set type(i){this._oscillator.type=i}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class oc extends ol{constructor(){super(rl(oc.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;let i=rl(oc.getDefaults(),arguments,["frequency","type"]);this.frequency=new rK({context:this.context,units:"frequency",value:i.frequency}),rC(this,"frequency"),this.detune=new rK({context:this.context,units:"cents",value:i.detune}),rC(this,"detune"),this._partials=i.partials,this._partialCount=i.partialCount,this._type=i.type,i.partialCount&&"custom"!==i.type&&(this._type=this.baseType+i.partialCount.toString()),this.phase=i.phase}static getDefaults(){return Object.assign(ol.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(i){let s=this.toSeconds(i),r=new ou({context:this.context,onended:()=>this.onstop(this)});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(s)}_stop(i){let s=this.toSeconds(i);this._oscillator&&this._oscillator.stop(s)}_restart(i){let s=this.toSeconds(i);return this.log("restart",s),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(s),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type)return oc._periodicWaveCache.find(i=>{var s,r;return i.phase===this._phase&&(s=i.partials,r=this._partials,s.length===r.length&&s.every((i,s)=>r[s]===i))});{let i=oc._periodicWaveCache.find(i=>i.type===this._type&&i.phase===this._phase);return this._partialCount=i?i.partialCount:this._partialCount,i}}get type(){return this._type}set type(i){this._type=i;let s=-1!==["sine","square","sawtooth","triangle"].indexOf(i);if(0===this._phase&&s)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=i);else{let s=this._getCachedPeriodicWave();if(s1(s)){let{partials:i,wave:r}=s;this._wave=r,this._partials=i,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{let[s,r]=this._getRealImaginary(i,this._phase),o=this.context.createPeriodicWave(s,r);this._wave=o,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),oc._periodicWaveCache.push({imag:r,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:s,type:this._type,wave:this._wave}),oc._periodicWaveCache.length>100&&oc._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(i){this.partialCount&&"custom"!==this._type&&"custom"!==i?this.type=i+this.partialCount:this.type=i}get partialCount(){return this._partialCount}set partialCount(i){s7(i,0);let s=this._type,r=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(r&&(s=r[1]),"custom"!==this._type)this.type=0===i?s:s+i.toString();else{let s=new Float32Array(i);this._partials.forEach((i,r)=>s[r]=i),this._partials=Array.from(s),this.type=this._type}}_getRealImaginary(i,s){let r=2048,o=new Float32Array(2048),a=new Float32Array(r),l=1;if("custom"===i){if(l=this._partials.length+1,this._partialCount=this._partials.length,r=l,0===this._partials.length)return[o,a]}else{let s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(i);s?(l=parseInt(s[2],10)+1,this._partialCount=parseInt(s[2],10),i=s[1],r=l=Math.max(l,2)):this._partialCount=0,this._partials=[]}for(let h=1;h<r;++h){let r;let u=2/(h*Math.PI);switch(i){case"sine":r=h<=l?1:0,this._partials[h-1]=r;break;case"square":r=1&h?2*u:0,this._partials[h-1]=r;break;case"sawtooth":r=u*(1&h?1:-1),this._partials[h-1]=r;break;case"triangle":r=1&h?u*u*2*(h-1>>1&1?-1:1):0,this._partials[h-1]=r;break;case"custom":r=this._partials[h-1];break;default:throw TypeError("Oscillator: invalid type: "+i)}0!==r?(o[h]=-r*Math.sin(s*h),a[h]=r*Math.cos(s*h)):(o[h]=0,a[h]=0)}return[o,a]}_inverseFFT(i,s,r){let o=0,a=i.length;for(let l=0;l<a;l++)o+=i[l]*Math.cos(l*r)+s[l]*Math.sin(l*r);return o}getInitialValue(){let[i,s]=this._getRealImaginary(this._type,0),r=0,o=2*Math.PI;for(let a=0;a<32;a++)r=Math.max(this._inverseFFT(i,s,a/32*o),r);return Math.max(Math.min(-this._inverseFFT(i,s,this._phase)/r,1),-1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(i){this._partials=i,this._partialCount=this._partials.length,i.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(i){this._phase=i*Math.PI/180,this.type=this._type}asArray(i=1024){return t4(this,void 0,void 0,function*(){return oh(this,i)})}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}oc._periodicWaveCache=[];class od extends rJ{constructor(){super(rl(od.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;let i=rl(od.getDefaults(),arguments,["url","onload"]);r$(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new rX({context:this.context,param:this._source.playbackRate,units:"positive",value:i.playbackRate}),this.loop=i.loop,this.loopStart=i.loopStart,this.loopEnd=i.loopEnd,this._buffer=new rA(i.url,i.onload,i.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(rJ.getDefaults(),{url:new rA,loop:!1,loopEnd:0,loopStart:0,onload:rS,onerror:rS,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(i){this._fadeIn=i}get fadeOut(){return this._fadeOut}set fadeOut(i){this._fadeOut=i}get curve(){return this._curve}set curve(i){this._curve=i}start(i,s,r,o=1){s5(this.buffer.loaded,"buffer is either not set or not loaded");let a=this.toSeconds(i);this._startGain(a,o),s=this.loop?rh(s,this.loopStart):rh(s,0);let l=Math.max(this.toSeconds(s),0);if(this.loop){let i=this.toSeconds(this.loopEnd)||this.buffer.duration,s=this.toSeconds(this.loopStart),r=i-s;rp(l,i)&&(l=(l-s)%r+s),rf(l,this.buffer.duration)&&(l=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,rm(l,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(a,l)),s1(r)){let i=this.toSeconds(r);i=Math.max(i,0),this.stop(a+i)}return this}_stopSource(i){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(i)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(i){this._source.loopStart=this.toSeconds(i)}get loopEnd(){return this._source.loopEnd}set loopEnd(i){this._source.loopEnd=this.toSeconds(i)}get buffer(){return this._buffer}set buffer(i){this._buffer.set(i)}get loop(){return this._source.loop}set loop(i){this._source.loop=i,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function op(i,s=1/0){let r=new WeakMap;return function(o,a){Reflect.defineProperty(o,a,{configurable:!0,enumerable:!0,get:function(){return r.get(this)},set:function(o){s7(o,i,s),r.set(this,o)}})}}function om(i,s=1/0){let r=new WeakMap;return function(o,a){Reflect.defineProperty(o,a,{configurable:!0,enumerable:!0,get:function(){return r.get(this)},set:function(o){s7(this.toSeconds(o),i,s),r.set(this,o)}})}}class of extends ol{constructor(){super(rl(of.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;let i=rl(of.getDefaults(),arguments,["url","onload"]);this._buffer=new rA({onload:this._onload.bind(this,i.onload),onerror:i.onerror,reverse:i.reverse,url:i.url}),this.autostart=i.autostart,this._loop=i.loop,this._loopStart=i.loopStart,this._loopEnd=i.loopEnd,this._playbackRate=i.playbackRate,this.fadeIn=i.fadeIn,this.fadeOut=i.fadeOut}static getDefaults(){return Object.assign(ol.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:rS,onerror:rS,playbackRate:1,reverse:!1})}load(i){return t4(this,void 0,void 0,function*(){return yield this._buffer.load(i),this._onload(),this})}_onload(i=rS){i(),this.autostart&&this.start()}_onSourceEnd(i){this.onstop(this),this._activeSources.delete(i),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(i,s,r){return super.start(i,s,r),this}_start(i,s,r){s=this._loop?rh(s,this._loopStart):rh(s,0);let o=this.toSeconds(s),a=r;r=rh(r,Math.max(this._buffer.duration-o,0));let l=this.toSeconds(r);l/=this._playbackRate,i=this.toSeconds(i);let h=new od({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(i+l),this._state.setStateAtTime("stopped",i+l,{implicitEnd:!0})),this._activeSources.add(h),this._loop&&s0(a)?h.start(i,o):h.start(i,o,l-this.toSeconds(this.fadeOut))}_stop(i){let s=this.toSeconds(i);this._activeSources.forEach(i=>i.stop(s))}restart(i,s,r){return super.restart(i,s,r),this}_restart(i,s,r){var o;null===(o=[...this._activeSources].pop())||void 0===o||o.stop(i),this._start(i,s,r)}seek(i,s){let r=this.toSeconds(s);if("started"===this._state.getValueAtTime(r)){let s=this.toSeconds(i);this._stop(r),this._start(r,s)}return this}setLoopPoints(i,s){return this.loopStart=i,this.loopEnd=s,this}get loopStart(){return this._loopStart}set loopStart(i){this._loopStart=i,this.buffer.loaded&&s7(this.toSeconds(i),0,this.buffer.duration),this._activeSources.forEach(s=>{s.loopStart=i})}get loopEnd(){return this._loopEnd}set loopEnd(i){this._loopEnd=i,this.buffer.loaded&&s7(this.toSeconds(i),0,this.buffer.duration),this._activeSources.forEach(s=>{s.loopEnd=i})}get buffer(){return this._buffer}set buffer(i){this._buffer.set(i)}get loop(){return this._loop}set loop(i){if(this._loop!==i&&(this._loop=i,this._activeSources.forEach(s=>{s.loop=i}),i)){let i=this._state.getNextState("stopped",this.now());i&&this._state.cancel(i.time)}}get playbackRate(){return this._playbackRate}set playbackRate(i){this._playbackRate=i;let s=this.now(),r=this._state.getNextState("stopped",s);r&&r.implicitEnd&&(this._state.cancel(r.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(r=>{r.playbackRate.setValueAtTime(i,s)})}get reverse(){return this._buffer.reverse}set reverse(i){this._buffer.reverse=i}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(i=>i.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}t8([om(0)],of.prototype,"fadeIn",void 0),t8([om(0)],of.prototype,"fadeOut",void 0);class o_ extends rY{constructor(){super(rl(o_.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new rK({context:this.context,value:0}),this.output=this._sig,this.input=void 0;let i=rl(o_.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=i.attack,this.decay=i.decay,this.sustain=i.sustain,this.release=i.release,this.attackCurve=i.attackCurve,this.releaseCurve=i.releaseCurve,this.decayCurve=i.decayCurve}static getDefaults(){return Object.assign(rY.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(i,s){if(s4(i))return i;{let r;for(r in og)if(og[r][s]===i)return r;return i}}_setCurve(i,s,r){if(s4(r)&&Reflect.has(og,r)){let o=og[r];s3(o)?"_decayCurve"!==i&&(this[i]=o[s]):this[i]=o}else{if(!s8(r)||"_decayCurve"===i)throw Error("Envelope: invalid curve: "+r);this[i]=r}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(i){this._setCurve("_attackCurve","In",i)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(i){this._setCurve("_releaseCurve","Out",i)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(i){this._setCurve("_decayCurve","Out",i)}triggerAttack(i,s=1){this.log("triggerAttack",i,s),i=this.toSeconds(i);let r=this.toSeconds(this.attack),o=this.toSeconds(this.decay),a=this.getValueAtTime(i);if(a>0&&(r=(1-a)/(1/r)),r<this.sampleTime)this._sig.cancelScheduledValues(i),this._sig.setValueAtTime(s,i);else if("linear"===this._attackCurve)this._sig.linearRampTo(s,r,i);else if("exponential"===this._attackCurve)this._sig.targetRampTo(s,r,i);else{this._sig.cancelAndHoldAtTime(i);let o=this._attackCurve;for(let i=1;i<o.length;i++)if(o[i-1]<=a&&a<=o[i]){(o=this._attackCurve.slice(i))[0]=a;break}this._sig.setValueCurveAtTime(o,i,r,s)}if(o&&this.sustain<1){let a=s*this.sustain,l=i+r;this.log("decay",l),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(a,o+l):this._sig.exponentialApproachValueAtTime(a,l,o)}return this}triggerRelease(i){this.log("triggerRelease",i),i=this.toSeconds(i);let s=this.getValueAtTime(i);if(s>0){let r=this.toSeconds(this.release);r<this.sampleTime?this._sig.setValueAtTime(0,i):"linear"===this._releaseCurve?this._sig.linearRampTo(0,r,i):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,r,i):(s5(s8(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(i),this._sig.setValueCurveAtTime(this._releaseCurve,i,r,s))}return this}getValueAtTime(i){return this._sig.getValueAtTime(i)}triggerAttackRelease(i,s,r=1){return s=this.toSeconds(s),this.triggerAttack(s,r),this.triggerRelease(s+this.toSeconds(i)),this}cancel(i){return this._sig.cancelScheduledValues(this.toSeconds(i)),this}connect(i,s=0,r=0){return r0(this,i,s,r),this}asArray(i=1024){return t4(this,void 0,void 0,function*(){let s=i/this.context.sampleRate,r=new rk(1,s,this.context.sampleRate),o=this.toSeconds(this.attack)+this.toSeconds(this.decay),a=o+this.toSeconds(this.release),l=.1*a,h=a+l,u=new this.constructor(Object.assign(this.get(),{attack:s*this.toSeconds(this.attack)/h,decay:s*this.toSeconds(this.decay)/h,release:s*this.toSeconds(this.release)/h,context:r}));return u._sig.toDestination(),u.triggerAttackRelease(s*(o+l)/h,0),(yield r.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}t8([om(0)],o_.prototype,"attack",void 0),t8([om(0)],o_.prototype,"decay",void 0),t8([op(0,1)],o_.prototype,"sustain",void 0),t8([om(0)],o_.prototype,"release",void 0);let og=(()=>{let i,s;let r=[];for(i=0;i<128;i++)r[i]=Math.sin(i/127*(Math.PI/2));let o=[];for(i=0;i<127;i++){let r=Math.sin(2*Math.PI*(s=i/127)*6.4-Math.PI/2)+1;o[i]=r/10+.83*s}o[127]=1;let a=[];for(i=0;i<128;i++)a[i]=Math.ceil(i/127*5)/5;let l=[];for(i=0;i<128;i++)s=i/127,l[i]=.5*(1-Math.cos(Math.PI*s));let h=[];for(i=0;i<128;i++){let r=Math.cos((4*Math.pow(s=i/127,3)+.2)*Math.PI*2*s);h[i]=Math.abs(r*(1-s))}function u(i){let s=Array(i.length);for(let r=0;r<i.length;r++)s[r]=1-i[r];return s}return{bounce:{In:u(h),Out:h},cosine:{In:r,Out:r.slice(0).reverse()},exponential:"exponential",linear:"linear",ripple:{In:o,Out:u(o)},sine:{In:l,Out:u(l)},step:{In:a,Out:u(a)}}})();class ov extends rY{constructor(){super(rl(ov.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=i=>this._original_triggerRelease(i);let i=rl(ov.getDefaults(),arguments);this._volume=this.output=new r6({context:this.context,volume:i.volume}),this.volume=this._volume.volume,rC(this,"volume")}static getDefaults(){return Object.assign(rY.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let i=!1;return this._synced||(this._synced=!0,i=!0),i}_syncMethod(i,s){let r=this["_original_"+i]=this[i];this[i]=(...i)=>{let o=i[s],a=this.context.transport.schedule(o=>{i[s]=o,r.apply(this,i)},o);this._scheduledEvents.push(a)}}unsync(){return this._scheduledEvents.forEach(i=>this.context.transport.clear(i)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(i,s,r,o){let a=this.toSeconds(r),l=this.toSeconds(s);return this.triggerAttack(i,a,o),this.triggerRelease(a+l),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class oy extends ov{constructor(){super(rl(oy.getDefaults(),arguments));let i=rl(oy.getDefaults(),arguments);this.portamento=i.portamento,this.onsilence=i.onsilence}static getDefaults(){return Object.assign(ov.getDefaults(),{detune:0,onsilence:rS,portamento:0})}triggerAttack(i,s,r=1){this.log("triggerAttack",i,s,r);let o=this.toSeconds(s);return this._triggerEnvelopeAttack(o,r),this.setNote(i,o),this}triggerRelease(i){this.log("triggerRelease",i);let s=this.toSeconds(i);return this._triggerEnvelopeRelease(s),this}setNote(i,s){let r=this.toSeconds(s),o=i instanceof rj?i.toFrequency():i;if(this.portamento>0&&this.getLevelAtTime(r)>.05){let i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(o,i,r)}else this.frequency.setValueAtTime(o,r);return this}}t8([om(0)],oy.prototype,"portamento",void 0);class ob extends o_{constructor(){super(rl(ob.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new rH({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class oT extends r9{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new ot({context:this.context,mapping:i=>(i+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class ow extends rK{constructor(){super(Object.assign(rl(ow.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;let i=rl(ow.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new rH({context:this.context,minValue:i.minValue,maxValue:i.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(i.value,0)}static getDefaults(){return Object.assign(rK.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class ox extends ol{constructor(){super(rl(ox.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new oT({context:this.context}),this._modulationNode=new rH({context:this.context});let i=rl(ox.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new oc({context:this.context,detune:i.detune,frequency:i.frequency,onstop:()=>this.onstop(this),phase:i.phase,type:i.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new oc({context:this.context,phase:i.phase,type:i.modulationType}),this.harmonicity=new ow({context:this.context,units:"positive",value:i.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),rC(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(oc.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(i){this._modulator.start(i),this._carrier.start(i)}_stop(i){this._modulator.stop(i),this._carrier.stop(i)}_restart(i){this._modulator.restart(i),this._carrier.restart(i)}get type(){return this._carrier.type}set type(i){this._carrier.type=i}get baseType(){return this._carrier.baseType}set baseType(i){this._carrier.baseType=i}get partialCount(){return this._carrier.partialCount}set partialCount(i){this._carrier.partialCount=i}get modulationType(){return this._modulator.type}set modulationType(i){this._modulator.type=i}get phase(){return this._carrier.phase}set phase(i){this._carrier.phase=i,this._modulator.phase=i}get partials(){return this._carrier.partials}set partials(i){this._carrier.partials=i}asArray(i=1024){return t4(this,void 0,void 0,function*(){return oh(this,i)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class oC extends ol{constructor(){super(rl(oC.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];let i=rl(oC.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new rK({context:this.context,units:"frequency",value:i.frequency}),this.detune=new rK({context:this.context,units:"cents",value:i.detune}),this._spread=i.spread,this._type=i.type,this._phase=i.phase,this._partials=i.partials,this._partialCount=i.partialCount,this.count=i.count,rC(this,["frequency","detune"])}static getDefaults(){return Object.assign(oc.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(i){i=this.toSeconds(i),this._forEach(s=>s.start(i))}_stop(i){i=this.toSeconds(i),this._forEach(s=>s.stop(i))}_restart(i){this._forEach(s=>s.restart(i))}_forEach(i){for(let s=0;s<this._oscillators.length;s++)i(this._oscillators[s],s)}get type(){return this._type}set type(i){this._type=i,this._forEach(s=>s.type=i)}get spread(){return this._spread}set spread(i){if(this._spread=i,this._oscillators.length>1){let s=-i/2,r=i/(this._oscillators.length-1);this._forEach((i,o)=>i.detune.value=s+r*o)}}get count(){return this._oscillators.length}set count(i){if(s7(i,1),this._oscillators.length!==i){this._forEach(i=>i.dispose()),this._oscillators=[];for(let s=0;s<i;s++){let r=new oc({context:this.context,volume:-6-1.1*i,type:this._type,phase:this._phase+s/i*360,partialCount:this._partialCount,onstop:0===s?()=>this.onstop(this):rS});"custom"===this.type&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[s]=r}this.spread=this._spread,"started"===this.state&&this._forEach(i=>i.start())}}get phase(){return this._phase}set phase(i){this._phase=i,this._forEach((i,s)=>i.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(i){this._forEach(s=>s.baseType=i),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(i){this._partials=i,this._partialCount=this._partials.length,i.length&&(this._type="custom",this._forEach(s=>s.partials=i))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(i){this._partialCount=i,this._forEach(s=>s.partialCount=i),this._type=this._oscillators[0].type}asArray(i=1024){return t4(this,void 0,void 0,function*(){return oh(this,i)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(i=>i.dispose()),this}}class oS extends ol{constructor(){super(rl(oS.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new rH({context:this.context,gain:0});let i=rl(oS.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new oc({context:this.context,detune:i.detune,frequency:0,onstop:()=>this.onstop(this),phase:i.phase,type:i.type}),this.detune=this._carrier.detune,this.frequency=new rK({context:this.context,units:"frequency",value:i.frequency}),this._modulator=new oc({context:this.context,phase:i.phase,type:i.modulationType}),this.harmonicity=new ow({context:this.context,units:"positive",value:i.harmonicity}),this.modulationIndex=new ow({context:this.context,units:"positive",value:i.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),rC(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(oc.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(i){this._modulator.start(i),this._carrier.start(i)}_stop(i){this._modulator.stop(i),this._carrier.stop(i)}_restart(i){return this._modulator.restart(i),this._carrier.restart(i),this}get type(){return this._carrier.type}set type(i){this._carrier.type=i}get baseType(){return this._carrier.baseType}set baseType(i){this._carrier.baseType=i}get partialCount(){return this._carrier.partialCount}set partialCount(i){this._carrier.partialCount=i}get modulationType(){return this._modulator.type}set modulationType(i){this._modulator.type=i}get phase(){return this._carrier.phase}set phase(i){this._carrier.phase=i,this._modulator.phase=i}get partials(){return this._carrier.partials}set partials(i){this._carrier.partials=i}asArray(i=1024){return t4(this,void 0,void 0,function*(){return oh(this,i)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class oA extends ol{constructor(){super(rl(oA.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new rH({context:this.context,gain:0}),this._thresh=new ot({context:this.context,mapping:i=>i<=0?-1:1});let i=rl(oA.getDefaults(),arguments,["frequency","width"]);this.width=new rK({context:this.context,units:"audioRange",value:i.width}),this._triangle=new oc({context:this.context,detune:i.detune,frequency:i.frequency,onstop:()=>this.onstop(this),phase:i.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),rC(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(ol.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(i){i=this.toSeconds(i),this._triangle.start(i),this._widthGate.gain.setValueAtTime(1,i)}_stop(i){i=this.toSeconds(i),this._triangle.stop(i),this._widthGate.gain.cancelScheduledValues(i),this._widthGate.gain.setValueAtTime(0,i)}_restart(i){this._triangle.restart(i),this._widthGate.gain.cancelScheduledValues(i),this._widthGate.gain.setValueAtTime(1,i)}get phase(){return this._triangle.phase}set phase(i){this._triangle.phase=i}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(i){this._triangle.type=i}asArray(i=1024){return t4(this,void 0,void 0,function*(){return oh(this,i)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class ok extends ol{constructor(){super(rl(ok.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new ow({context:this.context,value:2});let i=rl(ok.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new oA({context:this.context,frequency:i.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new oc({context:this.context,detune:i.detune,frequency:i.frequency,onstop:()=>this.onstop(this),phase:i.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),rC(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(ol.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(i){i=this.toSeconds(i),this._modulator.start(i),this._pulse.start(i)}_stop(i){i=this.toSeconds(i),this._modulator.stop(i),this._pulse.stop(i)}_restart(i){this._modulator.restart(i),this._pulse.restart(i)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(i){this._modulator.phase=i}asArray(i=1024){return t4(this,void 0,void 0,function*(){return oh(this,i)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}let oO={am:ox,fat:oC,fm:oS,oscillator:oc,pulse:oA,pwm:ok};class oM extends ol{constructor(){super(rl(oM.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";let i=rl(oM.getDefaults(),arguments,["frequency","type"]);this.frequency=new rK({context:this.context,units:"frequency",value:i.frequency}),this.detune=new rK({context:this.context,units:"cents",value:i.detune}),rC(this,["frequency","detune"]),this.set(i)}static getDefaults(){return Object.assign(oc.getDefaults(),oS.getDefaults(),ox.getDefaults(),oC.getDefaults(),oA.getDefaults(),ok.getDefaults())}_start(i){this._oscillator.start(i)}_stop(i){this._oscillator.stop(i)}_restart(i){return this._oscillator.restart(i),this}get type(){let i="";return["am","fm","fat"].some(i=>this._sourceType===i)&&(i=this._sourceType),i+this._oscillator.type}set type(i){"fm"===i.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=i.substr(2)):"am"===i.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=i.substr(2)):"fat"===i.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=i.substr(3)):"pwm"===i?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===i?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=i)}get partials(){return this._oscillator.partials}set partials(i){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=i)}get partialCount(){return this._oscillator.partialCount}set partialCount(i){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=i)}set(i){return Reflect.has(i,"type")&&i.type&&(this.type=i.type),super.set(i),this}_createNewOscillator(i){if(i!==this._sourceType){this._sourceType=i;let s=oO[i],r=this.now();if(this._oscillator){let i=this._oscillator;i.stop(r),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new s({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(r)}}get phase(){return this._oscillator.phase}set phase(i){this._oscillator.phase=i}get sourceType(){return this._sourceType}set sourceType(i){let s="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(s=this._oscillator.type),"fm"===i?this.type="fm"+s:"am"===i?this.type="am"+s:"fat"===i?this.type="fat"+s:"oscillator"===i?this.type=s:"pulse"===i?this.type="pulse":"pwm"===i&&(this.type="pwm")}_getOscType(i,s){return i instanceof oO[s]}get baseType(){return this._oscillator.baseType}set baseType(i){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===i||"pwm"===i||(this._oscillator.baseType=i)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(i){this._getOscType(this._oscillator,"fat")&&s2(i)&&(this._oscillator.count=i)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(i){this._getOscType(this._oscillator,"fat")&&s2(i)&&(this._oscillator.spread=i)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(i){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&s4(i)&&(this._oscillator.modulationType=i)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(i=1024){return t4(this,void 0,void 0,function*(){return oh(this,i)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class oE extends oy{constructor(){super(rl(oE.getDefaults(),arguments)),this.name="Synth";let i=rl(oE.getDefaults(),arguments);this.oscillator=new oM(Object.assign({context:this.context,detune:i.detune,onstop:()=>this.onsilence(this)},i.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new ob(Object.assign({context:this.context},i.envelope)),this.oscillator.chain(this.envelope,this.output),rC(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(oy.getDefaults(),{envelope:Object.assign(ru(o_.getDefaults(),Object.keys(rY.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(ru(oM.getDefaults(),[...Object.keys(ol.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(i,s){if(this.envelope.triggerAttack(i,s),this.oscillator.start(i),0===this.envelope.sustain){let s=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(i+s+r)}}_triggerEnvelopeRelease(i){this.envelope.triggerRelease(i),this.oscillator.stop(i+this.toSeconds(this.envelope.release))}getLevelAtTime(i){return i=this.toSeconds(i),this.envelope.getValueAtTime(i)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class oI extends oE{constructor(){super(rl(oI.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;let i=rl(oI.getDefaults(),arguments);this.pitchDecay=i.pitchDecay,this.octaves=i.octaves,rC(this,["oscillator","envelope"])}static getDefaults(){return ra(oy.getDefaults(),oE.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(i,s){let r=this.toSeconds(s),o=this.toFrequency(i instanceof rj?i.toFrequency():i),a=o*this.octaves;return this.oscillator.frequency.setValueAtTime(a,r),this.oscillator.frequency.exponentialRampToValueAtTime(o,r+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}t8([op(0)],oI.prototype,"octaves",void 0),t8([om(0)],oI.prototype,"pitchDecay",void 0);let oD=new Set;function oR(i,s){let r=`registerProcessor("${i}", ${s})`;oD.add(r)}u='\n	/**\n	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. \n	 */\n	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n		constructor(options) {\n			\n			super(options);\n			/**\n			 * If the processor was disposed or not. Keep alive until it\'s disposed.\n			 */\n			this.disposed = false;\n		   	/** \n			 * The number of samples in the processing block\n			 */\n			this.blockSize = 128;\n			/**\n			 * the sample rate\n			 */\n			this.sampleRate = sampleRate;\n\n			this.port.onmessage = (event) => {\n				// when it receives a dispose \n				if (event.data === "dispose") {\n					this.disposed = true;\n				}\n			};\n		}\n	}\n',oD.add(u),c="\n	/**\n	 * Abstract class for a single input/output processor. \n	 * has a 'generate' function which processes one sample at a time\n	 */\n	class SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n		constructor(options) {\n			super(Object.assign(options, {\n				numberOfInputs: 1,\n				numberOfOutputs: 1\n			}));\n			/**\n			 * Holds the name of the parameter and a single value of that\n			 * parameter at the current sample\n			 * @type { [name: string]: number }\n			 */\n			this.params = {}\n		}\n\n		/**\n		 * Generate an output sample from the input sample and parameters\n		 * @abstract\n		 * @param input number\n		 * @param channel number\n		 * @param parameters { [name: string]: number }\n		 * @returns number\n		 */\n		generate(){}\n\n		/**\n		 * Update the private params object with the \n		 * values of the parameters at the given index\n		 * @param parameters { [name: string]: Float32Array },\n		 * @param index number\n		 */\n		updateParams(parameters, index) {\n			for (const paramName in parameters) {\n				const param = parameters[paramName];\n				if (param.length > 1) {\n					this.params[paramName] = parameters[paramName][index];\n				} else {\n					this.params[paramName] = parameters[paramName][0];\n				}\n			}\n		}\n\n		/**\n		 * Process a single frame of the audio\n		 * @param inputs Float32Array[][]\n		 * @param outputs Float32Array[][]\n		 */\n		process(inputs, outputs, parameters) {\n			const input = inputs[0];\n			const output = outputs[0];\n			// get the parameter values\n			const channelCount = Math.max(input && input.length || 0, output.length);\n			for (let sample = 0; sample < this.blockSize; sample++) {\n				this.updateParams(parameters, sample);\n				for (let channel = 0; channel < channelCount; channel++) {\n					const inputSample = input && input.length ? input[channel][sample] : 0;\n					output[channel][sample] = this.generate(inputSample, channel, this.params);\n				}\n			}\n			return !this.disposed;\n		}\n	};\n",oD.add(c),d="\n	/**\n	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n	 */\n	class DelayLine {\n		\n		constructor(size, channels) {\n			this.buffer = [];\n			this.writeHead = []\n			this.size = size;\n\n			// create the empty channels\n			for (let i = 0; i < channels; i++) {\n				this.buffer[i] = new Float32Array(this.size);\n				this.writeHead[i] = 0;\n			}\n		}\n\n		/**\n		 * Push a value onto the end\n		 * @param channel number\n		 * @param value number\n		 */\n		push(channel, value) {\n			this.writeHead[channel] += 1;\n			if (this.writeHead[channel] > this.size) {\n				this.writeHead[channel] = 0;\n			}\n			this.buffer[channel][this.writeHead[channel]] = value;\n		}\n\n		/**\n		 * Get the recorded value of the channel given the delay\n		 * @param channel number\n		 * @param delay number delay samples\n		 */\n		get(channel, delay) {\n			let readHead = this.writeHead[channel] - Math.floor(delay);\n			if (readHead < 0) {\n				readHead += this.size;\n			}\n			return this.buffer[channel][readHead];\n		}\n	}\n",oD.add(d),oR("feedback-comb-filter",'\n	class FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n		constructor(options) {\n			super(options);\n			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n		}\n\n		static get parameterDescriptors() {\n			return [{\n				name: "delayTime",\n				defaultValue: 0.1,\n				minValue: 0,\n				maxValue: 1,\n				automationRate: "k-rate"\n			}, {\n				name: "feedback",\n				defaultValue: 0.5,\n				minValue: 0,\n				maxValue: 0.9999,\n				automationRate: "k-rate"\n			}];\n		}\n\n		generate(input, channel, parameters) {\n			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n			this.delayLine.push(channel, input + delayedSample * parameters.feedback);\n			return delayedSample;\n		}\n	}\n');class oP extends rc{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;let i=rl(oP.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=i.baseUrl,Object.keys(i.urls).forEach(s=>{this._loadingCount++;let r=i.urls[s];this.add(s,r,this._bufferLoaded.bind(this,i.onload),i.onerror)})}static getDefaults(){return{baseUrl:"",onerror:rS,onload:rS,urls:{}}}has(i){return this._buffers.has(i.toString())}get(i){return s5(this.has(i),`ToneAudioBuffers has no buffer named: ${i}`),this._buffers.get(i.toString())}_bufferLoaded(i){this._loadingCount--,0===this._loadingCount&&i&&i()}get loaded(){return Array.from(this._buffers).every(([i,s])=>s.loaded)}add(i,s,r=rS,o=rS){return s4(s)?(this.baseUrl&&"data:audio/"===s.trim().substring(0,11).toLowerCase()&&(this.baseUrl=""),this._buffers.set(i.toString(),new rA(this.baseUrl+s,r,o))):this._buffers.set(i.toString(),new rA(s,r,o)),this}dispose(){return super.dispose(),this._buffers.forEach(i=>i.dispose()),this._buffers.clear(),this}}class oN extends ov{constructor(){super(rl(oN.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;let i=rl(oN.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),s={};Object.keys(i.urls).forEach(r=>{let o=parseInt(r,10);(s5(s6(r)||s2(o)&&isFinite(o),`url key is neither a note or midi pitch: ${r}`),s6(r))?s[new rj(this.context,r).toMidi()]=i.urls[r]:s2(o)&&isFinite(o)&&(s[o]=i.urls[o])}),this._buffers=new oP({urls:s,onload:i.onload,baseUrl:i.baseUrl,onerror:i.onerror}),this.attack=i.attack,this.release=i.release,this.curve=i.curve,this._buffers.loaded&&Promise.resolve().then(i.onload)}static getDefaults(){return Object.assign(ov.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:rS,onerror:rS,release:.1,urls:{}})}_findClosest(i){let s=0;for(;s<96;){if(this._buffers.has(i+s))return-s;if(this._buffers.has(i-s))return s;s++}throw Error(`No available buffers for note: ${i}`)}triggerAttack(i,s,r=1){return this.log("triggerAttack",i,s,r),Array.isArray(i)||(i=[i]),i.forEach(i=>{let o=rV(new rj(this.context,i).toFrequency()),a=Math.round(o),l=o-a,h=this._findClosest(a),u=a-h,c=this._buffers.get(u),d=rR(h+l),p=new od({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:d}).connect(this.output);p.start(s,0,c.duration/d,r),s8(this._activeSources.get(a))||this._activeSources.set(a,[]),this._activeSources.get(a).push(p),p.onended=()=>{if(this._activeSources&&this._activeSources.has(a)){let i=this._activeSources.get(a),s=i.indexOf(p);-1!==s&&i.splice(s,1)}}}),this}triggerRelease(i,s){return this.log("triggerRelease",i,s),Array.isArray(i)||(i=[i]),i.forEach(i=>{let r=new rj(this.context,i).toMidi();if(this._activeSources.has(r)&&this._activeSources.get(r).length){let i=this._activeSources.get(r);s=this.toSeconds(s),i.forEach(i=>{i.stop(s)}),this._activeSources.set(r,[])}}),this}releaseAll(i){let s=this.toSeconds(i);return this._activeSources.forEach(i=>{for(;i.length;)i.shift().stop(s)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(i,s,r,o=1){let a=this.toSeconds(r);return this.triggerAttack(i,a,o),s8(s)?(s5(s8(i),"notes must be an array when duration is array"),i.forEach((i,r)=>{let o=s[Math.min(r,s.length-1)];this.triggerRelease(i,a+this.toSeconds(o))})):this.triggerRelease(i,a+this.toSeconds(s)),this}add(i,s,r){if(s5(s6(i)||isFinite(i),`note must be a pitch or midi: ${i}`),s6(i)){let o=new rj(this.context,i).toMidi();this._buffers.add(o,s,r)}else this._buffers.add(i,s,r);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(i=>{i.forEach(i=>i.dispose())}),this._activeSources.clear(),this}}t8([om(0)],oN.prototype,"attack",void 0),t8([om(0)],oN.prototype,"release",void 0),oR("bit-crusher","\n	class BitCrusherWorklet extends SingleIOProcessor {\n\n		static get parameterDescriptors() {\n			return [{\n				name: \"bits\",\n				defaultValue: 12,\n				minValue: 1,\n				maxValue: 16,\n				automationRate: 'k-rate'\n			}];\n		}\n\n		generate(input, _channel, parameters) {\n			const step = Math.pow(0.5, parameters.bits - 1);\n			const val = step * Math.floor(input / step + 0.5);\n			return val;\n		}\n	}\n");class oV extends rY{constructor(){super(rl(oV.getDefaults(),arguments,["solo"])),this.name="Solo";let i=rl(oV.getDefaults(),arguments,["solo"]);this.input=this.output=new rH({context:this.context}),oV._allSolos.has(this.context)||oV._allSolos.set(this.context,new Set),oV._allSolos.get(this.context).add(this),this.solo=i.solo}static getDefaults(){return Object.assign(rY.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(i){i?this._addSolo():this._removeSolo(),oV._allSolos.get(this.context).forEach(i=>i._updateSolo())}get muted(){return 0===this.input.gain.value}_addSolo(){oV._soloed.has(this.context)||oV._soloed.set(this.context,new Set),oV._soloed.get(this.context).add(this)}_removeSolo(){oV._soloed.has(this.context)&&oV._soloed.get(this.context).delete(this)}_isSoloed(){return oV._soloed.has(this.context)&&oV._soloed.get(this.context).has(this)}_noSolos(){return!oV._soloed.has(this.context)||oV._soloed.has(this.context)&&0===oV._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),oV._allSolos.get(this.context).delete(this),this._removeSolo(),this}}oV._allSolos=new Map,oV._soloed=new Map;class oq extends rY{constructor(){super(Object.assign(rl(oq.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;let i=rl(oq.getDefaults(),arguments,["pan"]);this.pan=new rX({context:this.context,param:this._panner.pan,value:i.pan,minValue:-1,maxValue:1}),this._panner.channelCount=i.channelCount,this._panner.channelCountMode="explicit",rC(this,"pan")}static getDefaults(){return Object.assign(rY.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class oL extends rY{constructor(){super(rl(oL.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";let i=rl(oL.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new oq({context:this.context,pan:i.pan,channelCount:i.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new r6({context:this.context,volume:i.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=i.mute,rC(this,["pan","volume"])}static getDefaults(){return Object.assign(rY.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(i){this._volume.mute=i}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class oF extends rY{constructor(){super(rl(oF.getDefaults(),arguments,["volume","pan"])),this.name="Channel";let i=rl(oF.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new oV({solo:i.solo,context:this.context}),this._panVol=this.output=new oL({context:this.context,pan:i.pan,volume:i.volume,mute:i.mute,channelCount:i.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),rC(this,["pan","volume"])}static getDefaults(){return Object.assign(rY.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(i){this._solo.solo=i}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(i){this._panVol.mute=i}_getBus(i){return oF.buses.has(i)||oF.buses.set(i,new rH({context:this.context})),oF.buses.get(i)}send(i,s=0){let r=this._getBus(i),o=new rH({context:this.context,units:"decibels",gain:s});return this.connect(o),o.connect(r),o}receive(i){return this._getBus(i).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}oF.buses=new Map;class oj extends rY{constructor(){super(...arguments),this.name="Listener",this.positionX=new rX({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new rX({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new rX({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new rX({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new rX({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new rX({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new rX({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new rX({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new rX({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(rY.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}function oB(){return rE().now()}function oW(){return rE().transport}rv(i=>{i.listener=new oj({context:i})}),rb(i=>{i.listener.dispose()}),rE().transport,rE().destination,rE().destination,rE().listener,rE().draw,rE();class oU extends ol{constructor(){super(rl(oU.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];let i=rl(oU.getDefaults(),arguments,["url","onload"]);this.buffer=new rA({onload:i.onload,onerror:i.onerror,reverse:i.reverse,url:i.url}),this._clock=new r8({context:this.context,callback:this._tick.bind(this),frequency:1/i.grainSize}),this._playbackRate=i.playbackRate,this._grainSize=i.grainSize,this._overlap=i.overlap,this.detune=i.detune,this.overlap=i.overlap,this.loop=i.loop,this.playbackRate=i.playbackRate,this.grainSize=i.grainSize,this.loopStart=i.loopStart,this.loopEnd=i.loopEnd,this.reverse=i.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(ol.getDefaults(),{onload:rS,onerror:rS,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(i,s,r){s=rh(s,0),s=this.toSeconds(s),i=this.toSeconds(i);let o=1/this._clock.frequency.getValueAtTime(i);this._clock.start(i,s/o),r&&this.stop(i+this.toSeconds(r))}restart(i,s,r){return super.restart(i,s,r),this}_restart(i,s,r){this._stop(i),this._start(i,s,r)}_stop(i){this._clock.stop(i)}_onstop(i){this._activeSources.forEach(s=>{s.fadeOut=0,s.stop(i)}),this.onstop(this)}_tick(i){let s=this._clock.getTicksAtTime(i),r=s*this._grainSize;if(this.log("offset",r),!this.loop&&r>this.buffer.duration)return void this.stop(i);let o=r<this._overlap?0:this._overlap,a=new od({context:this.context,url:this.buffer,fadeIn:o,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:rR(this.detune/100)}).connect(this.output);a.start(i,this._grainSize*s),a.stop(i+this._grainSize/this.playbackRate),this._activeSources.push(a),a.onended=()=>{let i=this._activeSources.indexOf(a);-1!==i&&this._activeSources.splice(i,1)}}get playbackRate(){return this._playbackRate}set playbackRate(i){s7(i,.001),this._playbackRate=i,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(i){this.buffer.loaded&&s7(this.toSeconds(i),0,this.buffer.duration),this._loopStart=this.toSeconds(i)}get loopEnd(){return this._loopEnd}set loopEnd(i){this.buffer.loaded&&s7(this.toSeconds(i),0,this.buffer.duration),this._loopEnd=this.toSeconds(i)}get reverse(){return this.buffer.reverse}set reverse(i){this.buffer.reverse=i}get grainSize(){return this._grainSize}set grainSize(i){this._grainSize=this.toSeconds(i),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(i){let s=this.toSeconds(i);s7(s,0),this._overlap=s}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach(i=>i.dispose()),this}}class oz extends EventTarget{get trackList(){return this._tracksList}get trackVolumeControls(){return this._trackPlayers.reduce((i,s)=>(i[s.name]=s.volumeControl,i),{})}get trackVolumeOutput(){return this._trackPlayers.reduce((i,s)=>(i[s.name]=s.output,i),{})}get sections(){return this._sections}getSectionFromIndex(i){return t7(this._sections,i)}get current(){return this._current}get next(){return[this._next,this._increments]}get beginning(){return this._beginning}set state(i){this.dispatchEvent(new ec({now:i,prev:this._state})),this._state=i}get state(){return this._state}get timingInfo(){return Object.assign({},this._timingInfo)}_setMeterBeat(i){this._meterBeat=i,oW().position}updateSectionLen(){this.current&&(this._sectionLen=(this.current.region[1]-this.current.region[0])*this._timingInfo.meter[0])}updateSectionBeat(i){this.current&&(this.updateSectionLen(),this._sectionBeat=Math.round(this._getSectionProgress(this.current,i)*this._sectionLen)%this._sectionLen)}getPosition(){return{section:[this._sectionBeat,this._sectionLen],countdown:this._pending.actionRemainingBeats,transport:{beat:this._meterBeat,transport:oW().position.toString()},lastLaunchTime:this._sectionLastLaunchTime,contextTime:oB()}}getProgression(){var i,s;if(!this._current||!this._sections)return{};let r=et(this._sections,this._current.index);return{name:this._current.name,index:this._current.index,next:(null===(i=this._pending.section)||void 0===i?void 0:i.index)||(null===(s=this._next)||void 0===s?void 0:s.index),increments:this._pending.increments||this._increments,repeatCount:r.loopCurrent,repeatLimit:r.loopLimit}}getSectionProgress(){return this._sectionBeat/this._sectionLen}_getSectionProgress(i,s){if(null===this._sectionLastLaunchTime||"playing"!==this._state&&"continue"!==this._state&&"transition"!==this._state&&"queue"!==this._state)return 0;let r=s-this._playerStartToneTime-rF(this._sectionLastLaunchTime).toSeconds(),o=rF(i.region[1]-i.region[0]+"m").toSeconds();return r%o/o}addEventListener(i,s,r){super.addEventListener(i,s,r)}removeEventListener(i,s,r){super.removeEventListener(i,s,r)}_dispatchParsePhase(i){this.dispatchEvent(new ed({now:i,prev:this._parsePhaseOld})),this._parsePhaseOld=i}audioStart(){let i=new oE;i.envelope.attack=0,i.envelope.release=.05,i.volume.value=-6,i.connect(this.output),this._metronome=i}constructor(i,s){super(),this.VERSION_SUPPORT=["J/1"],this.verbose=!1,this._state=null,this._meterBeat=0,this._sectionBeat=0,this._sectionLen=0,this._sectionLastLaunchTime=null,this._playerStartToneTime=0,this._parsePhaseOld=null,this._pending={scheduleAborter:new AbortController,transportSchedule:null,scheduledEvents:[],actionRemainingBeats:0,section:null,increments:null},this.state=null,this.verbose=!0===(null==s?void 0:s.verbose),(null==s?void 0:s.context)&&rI(null==s?void 0:s.context),this.output=new r6,(null==s?void 0:s.disconnected)||this.output.toDestination();try{rD().then(()=>{this.audioStart(),i&&this.parseManifest(i).then(i=>{var r;if(!i)throw Error("[JSONg] Invalid manifest preload");this.useManifest(i),null===(r=null==s?void 0:s.onload)||void 0===r||r.call(s)}),this.verbose&&console.log("[JSONg] new jsong player created")})}catch(i){}}get audioContext(){return rE().rawContext}parseManifest(i){return t4(this,void 0,void 0,function*(){var s,r,o;if("applying"===this._state||"loading"===this._state)return;let[a,l,h]=yield function(i){return t4(this,void 0,void 0,function*(){let s,r="",o="";if("string"!=typeof i)return ei(i)?[Object.assign({},i),en("").toString(),o]:Promise.reject("Invalid manifest");try{var a;let[l,h]=(a=i).endsWith(".jsong")||a.endsWith("json")?[en(a),"file"]:(a.endsWith("/")||(a+="/"),[en(a),"folder"]),u=l.href;if("folder"===h)try{let[i,s]=yield function(i){return t4(this,void 0,void 0,function*(){let s=i.endsWith("/")?i:i+"/";for(let i of["manifest.jsong","manifest.json","audio.jsong","audio.json","song.jsong","song.json"]){let r=new URL(i,s);try{let s=yield fetch(r);return[i,(yield s.json())]}catch(i){}}throw Error("No URLs successfully fetched")})}(u);return r=u,o=i,ei(s)?[s,r,o]:Promise.reject("Invalid manifest")}catch(i){return Promise.reject("No match in folder")}else try{let i;[r,o]=(i=en(u),u.length?i.pathname.length<=1?[u,""]:[i.origin+i.pathname.substring(0,i.pathname.lastIndexOf("/"))+"/",i.pathname.substring(i.pathname.lastIndexOf("/")+1)]:["",""]);let a=yield fetch(r+o);return s=yield a.json(),ei(s)?[s,r,o]:Promise.reject("Invalid manifest")}catch(i){return Promise.reject(`JSON parse error ${r+o}`)}}catch(i){return Promise.reject("Parsing error")}})}(i);if(this._dispatchParsePhase("meta"),"jsong"!==(null==a?void 0:a.type))throw Error("[JSONg] Invalid manifest");if(!this.VERSION_SUPPORT.includes(null==a?void 0:a.version))throw Error(`[JSONg] Unsupported parser version: ${null==a?void 0:a.version}`);if(!(null===(s=null==a?void 0:a.playback)||void 0===s?void 0:s.bpm))throw Error("[JSONg] Missing bpm");if(!(null===(r=null==a?void 0:a.playback)||void 0===r?void 0:r.meter))throw Error("[JSONg] Missing meter");let u=a.meta?Object.assign({},a.meta):{title:"",author:"",version:"",createdUsing:"",created:0,modified:0,meta:""};this._dispatchParsePhase("done-meta"),this._dispatchParsePhase("timing");let c=Object.assign({},{db:-6,high:"G6",low:"G5",enabled:!1});if(a.playback.metronome&&"object"==typeof a.playback.metronome){let i=a.playback.metronome;i.db&&(c.db=i.db),i.high&&(c.high=i.high),i.low&&(c.low=i.low)}else"boolean"==typeof a.playback.metronome&&a.playback.metronome&&(c.db=-6);let d={bpm:a.playback.bpm,meter:a.playback.meter||[4,4],grain:(null===(o=a.playback)||void 0===o?void 0:o.grain)||a.playback.meter[0]/(a.playback.meter[1]/4)||1,beatDuration:function(i,s){let[r,o]=s;return 60/i*(4/o)}(a.playback.bpm,a.playback.meter),metronomeSchedule:null,metronome:c};this._dispatchParsePhase("done-timing"),this._dispatchParsePhase("sections");let p=function(i,s,r){var o;if(!Array.isArray(s[null===(o=Object.keys(s))||void 0===o?void 0:o[0]]))throw Error("[build] invalid map definition");let a=[0],l=[],h=(i,o=0)=>{let u=1/0,c=[];i.forEach(i=>{"number"==typeof i?u=i:c.push(i)});let d=((i=0,s=1/0)=>({sectionCount:i,loopCurrent:0,loopLimit:s}))(c.length,u);for(let i=0;i<c.length;i++){let u=c[i];if(a[a.length-1]=i,Array.isArray(u))a.push(0),d[i]=h(u,o+1),a.pop();else if("number"!=typeof u){let o,h;let c=r.tracks.map(i=>({name:i,type:"sync",duration:0}));function p(){o.transition=o.transition.map(i=>Object.assign(Object.assign({},i),{type:"fade",duration:0}))}function m(i){o.transition=o.transition.map(s=>Object.assign(Object.assign({},s),{type:"fade",duration:i||r.fadeDuration}))}function f(i,s){return Object.assign(Object.assign({},i),{type:"fade",duration:s||r.fadeDuration})}if(o={name:"",region:[0,0],index:[],next:[],grain:r.grain,once:!1,transition:c,transitionSync:!1},"object"==typeof u){let i=ee(u.name);o.name=i.name,o.grain=void 0!==(null==u?void 0:u.grain)?u.grain:r.grain,o.once=(null==u?void 0:u.once)||i.once||!1,o.transitionSync=(null==u?void 0:u.sync)||i.sync||!1,0===o.grain&&(o.grain=s[o.name][1]-s[o.name][0],o.grain*=r.beatsInMeasure),(null==u?void 0:u.fade)||i.fade?i.fade||"boolean"==typeof u.fade&&!0===u.fade?m():"number"==typeof u.fade?m(u.fade):Array.isArray(u.fade)&&u.fade.forEach(i=>{"object"==typeof i?o.transition=o.transition.map(s=>s.name===i.name?f(s,i.duration):s):"string"==typeof i&&(o.transition=o.transition.map(s=>s.name===i?f(s):s))}):((null==u?void 0:u.legato)||i.legato)&&p()}else h=ee(u),o.name=h.name,(null==h?void 0:h.legato)?p():h.fade&&m(),h.once&&(o.once=!0),h.sync&&(o.transitionSync=!0);o.region=s[o.name],o.index=[...a],o.grain>(o.region[1]-o.region[0])*r.beatsInMeasure&&(o.grain=(o.region[1]-o.region[0])*r.beatsInMeasure),d[i]=o,l.push(o)}}return o?d:Object.assign({},d)},u=h(i,0);for(let i=0;i<l.length;i++){let s=(i+1)%l.length;l[i].next=l[s].index}return u.loopLimit=1/0,u}(a.playback.flow,a.playback.map,{grain:d.grain,fadeDuration:d.beatDuration*d.grain/2,tracks:a.tracks.map(i=>"object"==typeof i?i.name:i),beatsInMeasure:d.meter[0]}),m=[...function(i){let s=i,r=[-1];for(;s&&s[0];)s[0].hasOwnProperty("index")&&(r=s[0].index),s=s[0];return r}(p)],f=JSON.parse(JSON.stringify(a.playback.flow));this._dispatchParsePhase("done-sections"),this._dispatchParsePhase("tracks");let _=[...a.tracks],g="string"==typeof a.sources?a.sources:".mp3";g=g.startsWith(".")?g:"."+g;let v=_.reduce((i,s)=>{try{a.sources}catch(r){i[s]="./"+s+g}return i},{}),y=(a.sources,"object"==typeof a.sources?Object.assign({},a.sources):v);return this._dispatchParsePhase("done-tracks"),this.verbose&&console.log("[JSONg] end parsing manifest"),Promise.resolve({version:a.version,meta:u,timingInfo:d,sections:p,flow:f,beginning:m,tracksList:_,paths:y,origin:l,manifest:a})})}useManifest(i,s){return t4(this,void 0,void 0,function*(){if(!this.VERSION_SUPPORT.includes(null==i?void 0:i.version))throw Error(`[JSONg] Unsupported parser version: ${null==i?void 0:i.version}`);this.audioStart(),this.state="applying",oW().position="0:0:0",oW().bpm.value=i.timingInfo.bpm,oW().timeSignature=i.timingInfo.meter,this._setMeterBeat(-1),this._stop(oB());try{for(let i of this._trackPlayers)i.a.disconnect(),i.b.disconnect(),i.output.disconnect(),i.output.dispose(),i.a.dispose(),i.b.dispose()}catch(i){}this._metronome.volume.value=i.timingInfo.metronome.db||-6,this._timingInfo=i.timingInfo,this._sections=i.sections,this._beginning=i.beginning,this._tracksList=i.tracksList.map(i=>"object"==typeof i?{name:i.name,source:i.source||i.name,db:i.db||0,audioOffsetSeconds:i.audioOffsetSeconds||0}:{name:i,source:i,db:0,audioOffsetSeconds:0}),!0===(null==s?void 0:s.click)&&(this._timingInfo.metronome.enabled=!0);let r=(null==s?void 0:s.origin)?s.origin:i.origin;try{yield this.useAudio("object"==typeof(null==s?void 0:s.loadSound)?s.loadSound:i.paths,r),this.state="stopped",this.manifest=i,this.verbose&&console.log("[JSONg] loaded",i)}catch(i){throw this.state=null,i}})}useAudio(i){return t4(this,arguments,void 0,function*(i,s="/",r){var o;this._dispatchParsePhase("audio");let a=this._state;this.state="loading";let l=()=>{this._stop(oB());try{for(let i of this._trackPlayers)i.a.disconnect(),i.b.disconnect(),i.output.disconnect(),i.output.dispose(),i.a.dispose(),i.b.dispose()}catch(i){}let s=[];for(let i of this._tracksList){let o=new oU,a=new oU,l=new r6,h=new r6;o.overlap=0,a.overlap=0,o.volume.value=i.db,a.volume.value=i.db,o.connect(l),a.connect(l),l.connect(h),h.connect(this.output);let u=r||i.audioOffsetSeconds||0;s.push(Object.assign(Object.assign({},i),{volumeLimit:i.db,a:o,b:a,output:h,volumeControl:l,current:o,lastLoopPlayerStartTime:0,offset:u}))}this._trackPlayers=s,Object.keys(i).forEach(i=>{this._trackPlayers.forEach(s=>{s.name===i&&(s.a.buffer=this._sourceBuffers[i],s.b.buffer=s.a.buffer,this.verbose&&console.log("[JSONg] buffer loaded",i))})}),this._dispatchParsePhase("done-audio"),this.verbose&&console.log("[JSONg] end loading audio "),this._abort(),this._clear(),this._stop(oB())};if(!i||!Object.keys(i).length)return this.verbose&&console.log("[JSONg] end - no sources",i),void(this.state=a);let h=!1;Object.keys(i).forEach(s=>{i[s]instanceof rA&&(h=!0)});let u=!1;if(Object.keys(i).forEach(s=>{i[s]instanceof AudioBuffer&&(u=!0)}),h)return this._sourceBuffers=i,void l();if(u){let s={};return Object.keys(i).forEach(r=>{let o=new rA;o.set(i[r]),s[r]=o}),this._sourceBuffers=s,void l()}let c=yield function(i,s){return t4(this,void 0,void 0,function*(){let r={},o=s.endsWith("/")?s:s+"/";if(!i)return null;for(let s of Object.keys(i)){let a;let l=i[s];a=l.startsWith("data:")?l:l.startsWith("./")?o+l.substring(2):en(l).toString(),r[s]=a}return r})}(i,s);if(!c)return this.verbose&&console.log("[JSONg] no sources listed in manifest",c),Promise.reject("no sources");if(null===(o=Object.keys(c))||void 0===o?void 0:o.length){this.state="loading";try{this._sourceBuffers=yield function(i){return t4(this,void 0,void 0,function*(){return new Promise((s,r)=>t4(this,void 0,void 0,function*(){let o=Object.keys(i);if(!o.length)return Error("nothing to load");rA.baseUrl="";let a=[];for(let s of o){let r=new rA;a.push(r.load(i[s]))}if(!a||!a.length)throw Error("no source buffers");try{let i=yield Promise.all(a),r={};i.forEach((i,s)=>{r[o[s]]=i}),s(r)}catch(i){r("buffer source load failure")}}))})}(c),l()}catch(i){throw this.state=null,console.error("[JSONg]",c),console.error(Error("[JSONg] error fetching data")),i}}})}play(i){return t4(this,void 0,void 0,function*(){if(rD(),"stopped"!==this.state)return;let s=i||this._beginning,r=t7(this._sections,s);if(i&&void 0===r)throw Error("[JSONg] index error for specified start point: "+i);oW().cancel(0),oW().position="0:0:0",this._setMeterBeat(-1),this._metronomeSchedule&&oW().clear(this._metronomeSchedule),this._metronomeSchedule=oW().scheduleRepeat(i=>{this._setMeterBeat((this._meterBeat+1)%this._timingInfo.meter[0]),this.updateSectionBeat(i),this.dispatchEvent(new es([this._meterBeat+1,this._timingInfo.meter[0]])),this.dispatchEvent(new er([this._sectionBeat+1,this._sectionLen],this._meterBeat+1,this._pending.actionRemainingBeats>0?this._pending.actionRemainingBeats:void 0)),this._pending.actionRemainingBeats&&(this._pending.actionRemainingBeats-=1);let s=this._timingInfo.metronome[0===this._meterBeat?"high":"low"];if(this._timingInfo.metronome&&this._timingInfo.metronome.enabled)try{this._metronome.triggerAttackRelease(s,"64n",i)}catch(i){console.error(i)}},this._timingInfo.meter[1]+"n"),oW().scheduleOnce(i=>{this._playerStartToneTime=i},"0:0:0"),oW().start("+0.5"),this._clear(),this._current=r,yield this._schedule(r,"0:0:0"),this._sectionLastLaunchTime="0:0:0",this.dispatchEvent(new el(r,void 0,!1,!1)),this._current=r,this.state="playing",this._current=r,this.verbose&&console.log("[JSONg] started from index",s),r.once&&(this.verbose&&console.log("[JSONg] starting section once, continue"),this.state="continue",yield this._continue())})}continue(){return t4(this,arguments,void 0,function*(i=!1){"playing"===this.state&&(yield this._continue(i))})}_continue(){return t4(this,arguments,void 0,function*(i=!1){var s;if(!this._current)throw Error("[JSONg] current section non-existent");let r=oW().position.toString(),o=this._current,{next:a,increments:l}=t9(this._sections,this._current.index),h=(null==i?void 0:i.hasOwnProperty("region"))?i:t7(this._sections,Array.isArray(i)?i:i?this._current.next:a);if(!h)throw Error("[JSONg] no next section available");i?(this._pending.section=t7(this._sections,this._current.next),this._pending.increments=null):(this._pending.section=h,this._pending.increments=l);let u=t6(r,this._current.grain,null===(s=this._timingInfo)||void 0===s?void 0:s.meter,this._sectionLastLaunchTime);this.verbose&&console.log("[JSONg] advancing to next:",this._current.index,">",h.index),"playing"===this.state&&(this.state="queue");let c=t5(oW().position.toString(),u,this._timingInfo.meter);this.dispatchEvent(new eo(h,o,!1!==i,this._pending.actionRemainingBeats,this.beatsCountToSeconds(c))),this.dispatchEvent(new er([this._sectionBeat+1,this._sectionLen],this._meterBeat,this._pending.actionRemainingBeats>0?this._pending.actionRemainingBeats:void 0));try{yield this._schedule(h,u)}catch(i){throw this.dispatchEvent(new ea(h,o)),i}if(this.dispatchEvent(new el(h,o,!1!==i,h.once)),this._current=h,l.length&&!i&&l.forEach(i=>{var s,r;let o=0===i.length?this._sections:et(this._sections,i);o.loopCurrent+=1,this.dispatchEvent(new eh([o.loopCurrent,o.loopLimit],o)),o.loopCurrent>=o.loopLimit&&(o.loopCurrent=0,this.dispatchEvent(new eu(o))),s=o.loopCurrent,function i(o,a,l){let h=r[a];l[a]=h,l+""==r+""?o[h]=s:i(o[h],a+1,l)}(this._sections,0,[...Array((r=[...i,"loopCurrent"]).length)]),this.verbose&&console.log("[JSONg] group repeat counter increment",`${o.loopCurrent}/${o.loopLimit}`,i)}),this._clear(),this._current.once)this.state="continue",yield this._continue();else{let{next:i,increments:s}=t9(this._sections,this._current.index),r=t7(this._sections,i);r&&(this._next=r,this._increments=s)}this.state="playing",this.verbose&&console.log("[JSONg] continue resolved")})}overrideCurrent(i){return t4(this,arguments,void 0,function*(i,s=0,r=0){if("playing"!==this.state)throw Error("state is not playing");let o=Array.isArray(i)?t7(this.sections,i):i;if(void 0===o)throw Error("invalid section index");let a=JSON.parse(JSON.stringify(this.current));a.transition=a.transition.map(i=>Object.assign(Object.assign({},i),{type:"fade",duration:s})),r&&r>0?(a.transitionSync=!0,a.grain=r):a.transitionSync=!1,this._current=a,console.log("override",i),yield this._continue(o)})}stop(){return t4(this,arguments,void 0,function*(i=!0){if(null!==this.state&&!("stopped"===this.state||i&&"stopping"===this.state))return new Promise((s,r)=>{var o;if(!this._current)return void r();this._clear(),this._abort();let{signal:a}=this._pending.scheduleAborter,l=()=>{r(),this.state="playing",this.verbose&&console.log("[JSONg] stop cancelled"),this._pending.actionRemainingBeats=0,this._pending.scheduledEvents.forEach(i=>{oW().clear(i)}),this.dispatchEvent(new ea(this._current,void 0))},h=i=>{this.dispatchEvent(new el(this._current,void 0,!1,!1)),a.removeEventListener("abort",l),this._stop(i),s()};if(i){let i=t6(oW().position.toString(),this._current.grain,null===(o=this._timingInfo)||void 0===o?void 0:o.meter,this._sectionLastLaunchTime);rF(i).toSeconds(),a.addEventListener("abort",l),this.verbose&&console.log("[JSONg] stopping at",i),this._pending.scheduledEvents.push(oW().scheduleOnce(h,i)),this.state="stopping",this._pending.actionRemainingBeats=t5(oW().position.toString(),i,this._timingInfo.meter),this.dispatchEvent(new eo(this._current,void 0,!1,this._pending.actionRemainingBeats,this.beatsCountToSeconds(this._pending.actionRemainingBeats))),this.dispatchEvent(new er([this._sectionBeat+1,this._sectionLen],this._meterBeat,this._pending.actionRemainingBeats>0?this._pending.actionRemainingBeats:void 0))}else a.addEventListener("abort",l),h(oB()),s()})})}_stop(i){try{this._trackPlayers.forEach((s,r)=>{s.a.stop(i),s.b.stop(i),s.current=s.a})}catch(i){}oW().stop(i),oW().cancel(),this.state="stopped",this._sectionLastLaunchTime=null,this._sectionBeat=0,this._pending.actionRemainingBeats=0,this._pending.scheduledEvents=[];try{this.dispatchEvent(new es([0,this._timingInfo.meter[0]])),this.dispatchEvent(new er([0,this._sectionLen],0))}catch(i){}this.verbose&&console.log("[JSONg] stopped")}cancel(){this._abort(),this._clear(),this.state="playing"}_abort(){this._pending.actionRemainingBeats=0,this._pending.scheduleAborter&&this._pending.scheduleAborter.abort(),this._pending.scheduleAborter=new AbortController}_clear(){var i;(null===(i=this._pending)||void 0===i?void 0:i.transportSchedule)&&oW().clear(this._pending.transportSchedule),this._pending.scheduledEvents.forEach(i=>{oW().clear(i)}),this._pending.scheduledEvents=[],this._pending.transportSchedule=null,this._pending.increments=null,this._pending.section=null}_schedule(i,s){let r=rF("1m").toSeconds(),o=this.current.region[1]-this.current.region[0],a=i.region[1]-i.region[0];if(i.transition.find(i=>"sync"===i.type)&&!s)throw Error("Cannot use sync type transition and not specify forWhen");return new Promise((l,h)=>{let u=this._pending.scheduleAborter.signal,c="0:0:0",d=0;this.current.region[1],this.current.region[0],i.region[1],i.region[0],this.timingInfo.meter[0],Promise.all(this._trackPlayers.map(l=>new Promise((h,p)=>{let m=l.current===l.a?l.b:l.a;m.loopStart=rF(i.region[0]+"m").toSeconds()+l.offset,m.loopEnd=rF(i.region[1]+"m").toSeconds()+l.offset,m.loop=!0;let f=i=>{l.current.stop(i),l.current=m,this.verbose&&console.log("[schedule] resolved",l),h()},_=-1,g=-1,v=()=>{if(oW().clear(_),oW().clear(g),"transition"===this.state){let i=this._current.transition.find(i=>i.name===l.name),s=(null==i?void 0:i.duration)||1;m.stop(oB()+s),m.volume.cancelScheduledValues(oB()),l.current.volume.cancelScheduledValues(oB()),m.volume.linearRampToValueAtTime(-72,oB()+s),l.current.volume.linearRampToValueAtTime(l.volumeLimit,oB()+s)}p()},y=()=>{this._pending.actionRemainingBeats=t5(oW().position.toString(),s,this._timingInfo.meter),_=oW().scheduleOnce(i=>{l.a.volume.setValueAtTime(l.volumeLimit,i),l.b.volume.setValueAtTime(l.volumeLimit,i);try{m.start(i,m.loopStart),l.lastLoopPlayerStartTime=i}catch(i){console.error(i)}c=s,d=0,f(i),u.removeEventListener("abort",v)},s),u.addEventListener("abort",v)};if(null===this._sectionLastLaunchTime)return void y();let b=this._current.transition.find(i=>i.name===l.name);if("fade"===b.type){let i=b.duration;this._pending.actionRemainingBeats=Math.floor(i/this._timingInfo.beatDuration);let h=this.current.transitionSync?rF(s).toSeconds():rF(oW().position).toSeconds()+.1;_=oW().scheduleOnce(s=>{let h=(d=function(i,s,r){let o=Math.floor(s*i);return Math.floor(r*i)+(s*i-o)}(this._getSectionProgress(this.current,s),o,a))*r+m.loopStart;m.stop(s),m.start(s,h),m.volume.setValueAtTime(-72,s),m.volume.linearRampToValueAtTime(l.volumeLimit,s+i),l.current.volume.setValueAtTime(l.volumeLimit,s),l.current.volume.linearRampToValueAtTime(-72,s+i);let p=rF(s-this._playerStartToneTime).toSeconds()-d*r;c=rF(p).toBarsBeatsSixteenths().split(":")[0]+":0:0",i?this.state="transition":(f(s),u.removeEventListener("abort",v))},h),i&&(g=oW().scheduleOnce(i=>{f(i),u.removeEventListener("abort",v)},h+i)),u.addEventListener("abort",v)}else y()}))).then(()=>{l(),this._sectionLastLaunchTime=c}).catch(()=>{h()})})}toggleMetronome(i){this._timingInfo.metronome.enabled=void 0!==i?i:!this._timingInfo.metronome.enabled}isMute(){return this.output.volume.value>=-200}mute(i=.5){this.output.volume.linearRampToValueAtTime(-120,"+"+i+"s")}unmute(i=.5){this.output.volume.linearRampToValueAtTime(0,"+"+i+"s")}audioSafeCallback(i){rE().draw.schedule(i,oB())}beatsCountToSeconds(i){return this.timingInfo.beatDuration*i}secondsToBeatCount(i){return i/this.timingInfo.beatDuration}afterBeats(i){let s=rF(oW().position).toSeconds()+i*this.timingInfo.beatDuration;return new Promise(i=>{oW().schedule(()=>this.audioSafeCallback(i),s)})}afterSectionPercentage(i){let s=i*(this.current.region[1]-this.current.region[0])*this.timingInfo.beatDuration*this.timingInfo.meter[0],r=rF(oW().position).toSeconds()+s;return new Promise(i=>{oW().schedule(()=>this.audioSafeCallback(i),r)})}}let oG=new oz,oX=!1,oY=document.querySelectorAll(".prog-bar");async function oZ(){console.log("running test"),oG.addEventListener("change",i=>{oY.forEach(s=>{s.classList.remove("active"),s.id.endsWith(i.to.name)&&s.classList.add("active")})}),oG.addEventListener("transport",i=>{oY.forEach(s=>{s.classList.contains("active")?s.style.setProperty("--value",i.progress[0]/i.progress[1]):s.style.setProperty("--value",0)})}),oG.addEventListener("repeat",i=>{console.log(i)}),oG.addEventListener("loop",i=>{console.log(i)});let i=await oG.parseManifest("jsong-examples/vanilla/gh_page/manifest.jsong");i&&(await oG.useManifest(i),console.log("ok"),console.log(oG),oX=!0)}console.log(oY),document.querySelector("#btn-play").addEventListener("click",async()=>{oX||await oZ(),oG.play()}),document.querySelector("#btn-stop").addEventListener("click",()=>{oG.stop(!1)})}();</script><style>*{box-sizing:border-box;margin:0;padding:0;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}body{color:#0a0303;background-color:#f2f8fc;place-items:center;min-height:100vh;display:grid}.heading{text-align:center;padding-block:2rem;font-size:min(max(2rem,8vw),5rem);font-weight:100}.text{color:#293236;max-width:70ch;line-height:1.5}.controls{color:#71a57c;background-color:#0000;border:3px solid;border-radius:.5rem;width:6rem;height:3rem;transition:border-radius .4s}.controls:hover{border-radius:2rem}.controls-container{flex-direction:column;justify-content:space-evenly;display:flex}.content{flex-direction:row-reverse;justify-content:space-around;max-width:90ch;margin-inline:auto;display:flex}.playback{-webkit-user-select:none;user-select:none;grid-template-columns:repeat(5,1fr);place-items:center stretch;gap:4px;max-width:80ch;margin-block:2rem;margin-inline:auto;display:grid}.prog{text-align:center;color:#627ab4;background-color:#0000;border:3px solid;border-radius:.5rem;padding:1rem;transition:border-radius .4s;position:relative}.prog-bar:after{content:"";scale:var(--value)1;background-color:currentColor;border-radius:.25rem;width:100%;height:1rem;transition:scale .2s;display:block;position:absolute;bottom:0;left:0}.prog:has(.active){color:#8754c2}@media only screen and (max-width:750px){.controls-container{flex-direction:row;padding:1rem}.content{flex-direction:column-reverse;max-width:60vw;margin-inline:auto}.playback{flex-wrap:wrap;justify-content:center;display:flex}}</style></html>